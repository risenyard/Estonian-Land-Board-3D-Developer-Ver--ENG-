System.register(["jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-for-builder","jimu-ui/basic/list-tree","jimu-arcgis","jimu-ui/advanced/data-source-selector","jimu-ui/basic/color-picker","jimu-ui/advanced/map"],(function(e,t){var s={},i={},a={},l={},o={},n={},r={},p={},h={};return{setters:[function(e){s.DataSourceManager=e.DataSourceManager,s.DataSourceTypes=e.DataSourceTypes,s.Immutable=e.Immutable,s.JimuFieldType=e.JimuFieldType,s.React=e.React,s.classNames=e.classNames,s.css=e.css,s.defaultMessages=e.defaultMessages,s.getAppStore=e.getAppStore,s.jsx=e.jsx,s.polished=e.polished,s.urlUtils=e.urlUtils},function(e){i.Alert=e.Alert,i.AlertPopup=e.AlertPopup,i.Button=e.Button,i.Checkbox=e.Checkbox,i.CollapsablePanel=e.CollapsablePanel,i.Icon=e.Icon,i.Label=e.Label,i.Loading=e.Loading,i.LoadingType=e.LoadingType,i.NumericInput=e.NumericInput,i.Option=e.Option,i.Radio=e.Radio,i.Select=e.Select,i.Switch=e.Switch,i.TextArea=e.TextArea,i.TextInput=e.TextInput,i.Tooltip=e.Tooltip,i.defaultMessages=e.defaultMessages},function(e){a.MapWidgetSelector=e.MapWidgetSelector,a.SettingRow=e.SettingRow,a.SettingSection=e.SettingSection,a.SidePopper=e.SidePopper},function(e){l.BaseWidgetSetting=e.BaseWidgetSetting},function(e){o.List=e.List,o.TreeItemActionType=e.TreeItemActionType},function(e){n.ArcGISDataSourceTypes=e.ArcGISDataSourceTypes,n.MapViewManager=e.MapViewManager,n.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){r.AllDataSourceTypes=e.AllDataSourceTypes,r.DataSourceSelector=e.DataSourceSelector,r.FieldSelector=e.FieldSelector},function(e){p.ColorPicker=e.ColorPicker},function(e){h.JimuSymbolType=e.JimuSymbolType,h.SymbolSelector=e.SymbolSelector}],execute:function(){e((()=>{var e={62560:(e,t,s)=>{var i={"./circle.svg":38629,"./dashed-line.svg":60958,"./dotted-line.svg":79620,"./rectangle.svg":69224,"./solid-line.svg":63589,"./square.svg":66793,"./triangle.svg":26449};function a(e){var t=l(e);return s(t)}function l(e){if(!s.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}a.keys=function(){return Object.keys(i)},a.resolve=l,e.exports=a,a.id=62560},38629:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="#FFF"><circle cx="6" cy="6" r="6"></circle></svg>'},60958:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 46 1"><path fill="#fff" d="M0 1h3V0H0v1ZM6 1h3V0H6v1ZM15 1h-3V0h3v1ZM18 1h3V0h-3v1ZM27 1h-3V0h3v1ZM30 1h3V0h-3v1ZM39 1h-3V0h3v1ZM42 1h4V0h-4v1Z"></path></svg>'},79620:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 46 1"><path fill="#fff" fill-rule="evenodd" d="M0 1h1V0H0v1Zm6 0h1V0H6v1Zm7 0h-1V0h1v1Zm5 0h1V0h-1v1Zm7 0h-1V0h1v1Zm5 0h1V0h-1v1Zm7 0h-1V0h1v1ZM3 1h1V0H3v1Zm7 0H9V0h1v1Zm5 0h1V0h-1v1Zm7 0h-1V0h1v1Zm5 0h1V0h-1v1Zm7 0h-1V0h1v1Zm5 0h1V0h-1v1Zm4 0h-1V0h1v1Zm2 0h1V0h-1v1Z" clip-rule="evenodd"></path></svg>'},69224:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="#FFF" viewBox="0 0 35 28"><path d="M0 0h35v28H0z"></path></svg>'},63589:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 46 1"><path fill="#fff" fill-rule="evenodd" d="M46 1H0V0h46v1Z" clip-rule="evenodd"></path></svg>'},66793:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="#FFF" viewBox="0 0 28 28"><path d="M0 0v28h28V0H0z"></path></svg>'},26449:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" viewBox="0 0 512.055 512.055"><path d="M502.893 503.853H7.96L255.427 8.919z" style="fill:#fff"></path><path d="M502.893 512.386H7.96c-2.56 0-5.973-1.707-7.68-4.267-1.707-2.56-1.707-5.973 0-8.533L247.747 4.653c2.56-5.973 11.947-5.973 15.36 0l247.467 494.933c1.707 2.56.853 5.973 0 8.533-.854 2.56-5.121 4.267-7.681 4.267zm-481.28-17.067H489.24L255.427 27.693 21.613 495.319z" style="fill:#fff"></path></svg>'},11407:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M11.347 2.146a.485.485 0 0 1 0 .708L5.76 8l5.587 5.146a.486.486 0 0 1 0 .708.538.538 0 0 1-.738 0l-5.956-5.5a.485.485 0 0 1 0-.708l5.956-5.5a.538.538 0 0 1 .738 0Z" clip-rule="evenodd"></path></svg>'},55339:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746L8.746 8Z"></path></svg>'},88866:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2ZM6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5Z"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16Zm0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14Z" clip-rule="evenodd"></path></svg>'},26826:e=>{"use strict";e.exports=n},48891:e=>{"use strict";e.exports=s},23137:e=>{"use strict";e.exports=l},30726:e=>{"use strict";e.exports=i},338:e=>{"use strict";e.exports=r},58290:e=>{"use strict";e.exports=h},77756:e=>{"use strict";e.exports=a},41362:e=>{"use strict";e.exports=p},59587:e=>{"use strict";e.exports=o}},t={};function c(s){var i=t[s];if(void 0!==i)return i.exports;var a=t[s]={exports:{}};return e[s](a,a.exports,c),a.exports}c.d=(e,t)=>{for(var s in t)c.o(t,s)&&!c.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.p="";var d={};return c.p=window.jimuConfig.baseUrl,(()=>{"use strict";c.r(d),c.d(d,{__set_webpack_public_path__:()=>re,default:()=>ne});var e=c(48891),t=c(30726),s=c(77756),i=c(23137),a=c(59587),l=c(26826);const o={sourceLabel:"Source",selectMapWidgetLabel:"Select a Map widget",warningMsgToSelectMap:"A Map widget must be selected to generate an elevation profile.",dataConfigLabel:"Map Settings",warningMsgIfDefaultDs:"The Map widget does not contain a web map or web scene. Draw on the default web map to view ground elevation.",dataConfigTooltip:"Optionally, click a map below to customize the elevation profile settings.",defaultWebMap:"Default web map",generalSettingsLabel:"General Settings",allowExportLabel:"Allow export",activateToolOnLoadLabel:"Activate when widget opens",activateToolOnLoadTooltip:"Activate the select or the draw tool automatically when the widget opens.",selectTool:"Select line",drawTool:"Draw profile",appearanceCollapsible:"Appearance",showChartGridsLabel:"Graph grids",showChartAxisTitlesLabel:"Graph axis titles",profileChart:"Profile Settings",elevationLayerLabel:"Select elevation layer",elevationLayerTooltip:"Use the elevation layer defined in the web scene or set a custom elevation layer. If no elevation layer is defined or you are using a web map, Esri's Terrain 3D elevation layer is used.",useDefaultGround:"Use ground elevation layer from web scene",useCustomElevation:"Use custom elevation layer",setServiceLabel:"Set layer",alertPopupTitle:"Enter the service URL",invalidElevationLayerURL:"Enter the URL for a valid elevation layer service.",measurementUnitsHeadingLabel:"Units",measurementUnitsHeadingTooltip:"Units used to convert and display values in the profile graph.",distanceUnitLabel:"Distance",elevationUnitLabel:"Elevation",displayGroundProfileStatsLabel:"Show profile statistics",showLegend:"Legend",groundColor:"Ground color",chooseHighlightColor:"Map selection color",volumetricObjectsLabel:"Volumetric objects",volumetricObjectsTooltip:"Generate elevation profile for Scene Layers, Integrated Mesh Layers and layers with volumetric 3D symbols. This is only supported in web scenes.",showInGraph:"Show in graph",viewLineColor:"Line color",profileSettingsLabel:"Selectable Layers",selectableLayersLabel:"Customize selectable line layers",selectableLayersTooltip:"Add line layers from the web map or scene. Click a layer from the list to open the settings pane.",selectableLayersWarning:"No selectable layers are defined. Add line layers from the map that can be selected to generate a profile.",distanceSettingLabel:"Distance Settings",distanceSettingsWarning:"These options are no longer available. The map projection is used to display and calculate an accurate topologic representation of distance values in the chart.",mapProjection:"Map Projection",sourceField:"Field",styleLineTooltip:"Customize the style to display in the profile graph for all selected lines from this layer.",assetSettingsLabel:"Intersecting Layers",intersectingLayersLabel:"Customize intersecting layers",intersectingLayersTooltip:"Add point or line layers from the web map or scene. Click a layer from the list to open the settings pane. Point or line features intersecting with the profile will be displayed on the graph.",intersectingLayersWarning:"No intersecting layers are defined. Add point and line layers to display features that intersect with the profile.",intersectingBufferSettingsLabel:"Buffer",intersectingBufferSettingsTooltip:"Features are represented on the graph at their points of intersection with the buffer area. Connected points are used to represent traversing lines and points with two-field elevation.",displayFieldLabel:"Display Field",displayFieldTooltip:"The field value to be displayed on hover for each asset from this layer represented in the graph.",stylePointTooltip:"Point features from this layer that are intersecting with the profile will be displayed on the graph as markers at the point of intersection.",symbology:"Symbology",mapLabel:"Map",customLabel:"Custom",styleColor:"Style color",styleShape:"Style shape",styleSize:"Style size",assetTriangle:"Triangle",assetRectangle:"Rectangle",assetCircle:"Circle",assetSquare:"Square",profileRendering:"Profile rendering",profileRenderingTooltip:"Display selected line features on the ground or customize selectable layers and their elevation settings",groundElevation:"Ground elevation",customizeSelectableLayersLabel:"Customize",selectableButton:"+ Add Layer",styleLabel:"Style",styleGroundTooltip:"Customize the display color for the ground and the map selection.",valueType:"Elevation value",meters:"Meters",feet:"Feet",kilometers:"Kilometers",miles:"Miles",yards:"Yards",maxDistance:"MAX Distance",minElevation:"MIN Elevation",maxElevation:"MAX Elevation",avgElevation:"AVG Elevation",elevationGain:"Elevation Gain",elevationLoss:"Elevation Loss",maxPositiveSlope:"MAX Positive Slope",maxNegativeSlope:"MAX Negative Slope",avgPositiveSlope:"AVG Positive Slope",avgNegativeSlope:"AVG Negative Slope",noElevationHint:"Hint: Features with no elevation will display on the ground.",noVerticalParamHint:"Hint: No unit defined for vertical Z value in the layer, ground spatial reference unit will be used.",elevationSettingLabel:"Elevation Settings",elevationSettingTooltip:"Select how the elevation for a selected line is calculated using the elevation layer defined in the Profile Settings or using up to two field values.",elevationSettingIntersectingTooltip:"Select how the elevation for an intersecting feature is calculated using the elevation layer defined in the Profile Settings or using up to two field values.",noElevation:"No Elevation",zValue:"Z Value",noSelectionItemLabel:"- Select -",oneField:"One Field",twoField:"Two Fields",oneFieldLabel:"Field 1",twoFieldLabel:"Field 2",valueUnit:"Units",legendLabel:"Legend",legendTooltip:"Legend",statsDisplayLabel:"Layer Statistics",statisticsListLabel:"Customize statistics",statisticsListTooltip:"Customize the display and order of the profile statistics.",deleteLayer:"Delete",backButton:"Back",alert:"Add Layer",alreadySelectedLayerMsg:"This layer is already added to the list."};function n(t){const s=(0,e.getAppStore)().getState().appContext.isRTL;return e.css`
    .popupContents {
      width: 450px;
    }

    .alertValidationContent{
      height: 42px;
    }

    .invalidServiceURL {
      display: block;
    }

    .validServiceURL {
      display: none;
    }

    .elevationErrorMessage {
      padding-top: 5px;
      color: ${t.colors.danger};
      font-weight: bold;
    }

    .elevationUrlTextInput .input-wrapper input {
      padding: ${s?"0 1px":"0"};
    }
  `}function r(t){return e.css`
    .layer-item-panel {
      .setting-header {
        padding: ${e.polished.rem(10)} ${e.polished.rem(16)} ${e.polished.rem(0)} ${e.polished.rem(16)}
      }
      .setting-title {
        font-size: ${e.polished.rem(16)};
        .layer-item-label{
          color: ${t.colors.palette.dark[600]};
        }
      }
      .setting-container {
        height: calc(100% - ${e.polished.rem(50)});
        overflow: auto;

        .title-desc {
          color: ${t.colors.palette.dark[200]};
        }

        .ep-divider-bottom {
          border-bottom: 1px solid var(--light-800)
        }
  
        .ep-divider-hide {
          border-bottom: none !important
        }

        .ep-section-title {
          max-width: 80%;
          color: var(--dark-800);
        }

        .color-label {
          color: ${t.colors.palette.dark[400]};
        }

        .cursor-pointer {
          cursor: pointer;
        }
      }
    }
  `}function p(t){return e.css`
    .hidden {
      display: none;
    }

    .color-label {
      color: ${t.colors.palette.dark[400]};
    }

    .hint {
      font-style: italic;
    }

    .cursor-pointer {
      cursor: pointer;
    }

    .fieldSelectorWidth {
      max-width: 110px;
    }
  
    .fieldLabel {
      width: 93px;
    }

    .selectOption {
      width: 110px;
    }

    .warningMsg {
      width: auto;
    }

    .ep-label {
      max-width: 80%;
      display: inline-block;
      margin-bottom: 0;
      margin-right: 20px;
    }

    .jimu-widget-setting--row-label:not(.form-inline) {
      max-width: none;
    }

    .ep-layers-list {
      width: 100%;

      .layer-data-item {
        display: flex;
        flex: 1;
        padding: ${e.polished.rem(7)} 0.25rem;
        cursor: pointer;
  
        .layer-data-item-name {
          overflow: hidden;
          text-overflow: ellipsis;
          display: -webkit-box;
          -webkit-box-orient: vertical;
          word-break: break-word;
          -webkit-line-clamp: 2;
          padding: 2px;
          line-height: ${t.typography.lineHeights.sm};
        }
      }
    }

    .ep-data-source-selector {
      .ds-item {
        display: none;
      }
    }

    .tooltip-color {
      color: var(--dark-800);
    }

    .ep-divider-top {
      border-top: 1px solid var(--light-800)
    }
  `}function h(t){return e.css`
    position: absolute;
    top: 0;
    bottom: 0;
    width: 259px;
    height: 100%;
    padding-bottom: 1px;
    border-right: 1px solid ${t.colors.white};
    border-bottom: 1px solid ${t.colors.white};

    .setting-container {
      height: calc(100% - ${e.polished.rem(50)});
      overflow: auto;
    }
`}const g=c(88866),u=c(55339),m=c(11407),v=()=>({epConfigIcon:{infoIcon:g,iconClose:u,iconBack:m}}),f=[{value:"meters"},{value:"feet"},{value:"kilometers"},{value:"miles"},{value:"yards"}],S=[{value:"no elevation",name:"noElevation"},{value:"z",name:"zValue"},{value:"one",name:"oneField"},{value:"two",name:"twoField"}],y=[{value:"no elevation",name:"noElevation"},{value:"one",name:"oneField"},{value:"two",name:"twoField"}],b=[{value:"map",name:"mapLabel"},{value:"custom",name:"customLabel"}],x=[{value:"maxDistance",label:o.maxDistance},{value:"minElevation",label:o.minElevation},{value:"maxElevation",label:o.maxElevation},{value:"avgElevation",label:o.avgElevation},{value:"elevationGain",label:o.elevationGain},{value:"elevationLoss",label:o.elevationLoss},{value:"maxPositiveSlope",label:o.maxPositiveSlope},{value:"maxNegativeSlope",label:o.maxNegativeSlope},{value:"avgPositiveSlope",label:o.avgPositiveSlope},{value:"avgNegativeSlope",label:o.avgNegativeSlope}],w={profileChartSettings:{isCustomElevationLayer:!1,elevationLayerURL:"",linearUnit:"",elevationUnit:"",displayStatistics:!0,selectedStatistics:[],groundColor:"#b54900",graphicsHighlightColor:"#00ffff",showVolumetricObjLineInGraph:!1,volumetricObjLineColor:"#cf4ccf",volumetricObjLabel:o.volumetricObjectsLabel},profileSettings:{isProfileSettingsEnabled:!1,isCustomizeOptionEnabled:!1,layers:[]},assetSettings:{isAssetSettingsEnabled:!1,layers:[],assetIntersectingBuffer:{enabled:!1,bufferDistance:10,bufferUnits:"",bufferSymbol:{type:"esriSFS",color:[239,132,38,128],outline:{type:"esriSLS",color:[184,115,59,255],width:1.5,style:"esriSLSSolid"},style:"esriSFSSolid"}}}},I={layerId:"",elevationSettings:{type:"",unit:"",field1:"",field2:""},distanceSettings:{type:"map",field:"",unit:""},style:{lineType:"solid-line",lineColor:"",lineThickness:3}},L={layerId:"",elevationSettings:{type:"",unit:"",field1:"",field2:""},displayField:"",style:{type:"custom",intersectingAssetShape:"",intersectingAssetSize:0,intersectingAssetColor:""}},j=[{value:"solid-line",label:"solid"},{value:"dotted-line",label:"dotted"},{value:"dashed-line",label:"dashed"}],C=[{value:"triangle",label:"assetTriangle"},{value:"rectangle",label:"assetRectangle"},{value:"circle",label:"assetCircle"},{value:"square",label:"assetSquare"}];var T=c(338),D=c(41362);class A extends e.React.PureComponent{constructor(e){super(e),this.nls=e=>{const s=Object.assign({},o,t.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.onLineColorChange=e=>{this.setState({lineColor:e}),this.props.onLineStyleChange(this.props.lineItem,"lineColor",e)},this.onlineTypeChange=e=>{this.setState({lineType:e.currentTarget.value}),this.props.onLineStyleChange(this.props.lineItem,"lineType",e.currentTarget.value)},this.onLineThicknessChange=e=>{null!==e&&(this.setState({lineThickness:e}),this.props.onLineStyleChange(this.props.lineItem,"lineThickness",e))};const s=this.props.config;this.state={lineColor:s.hasOwnProperty("lineColor")?s.lineColor:"#049546",lineType:s.hasOwnProperty("lineType")?s.lineType:"dashed-line",lineThickness:s.hasOwnProperty("lineThickness")?s.lineThickness:2}}render(){return(0,e.jsx)("div",null,(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(D.ColorPicker,{"aria-label":this.nls("styleColor"),className:"mr-2",width:"54px",height:"26px",offset:[0,0],placement:"top",showArrow:!0,color:this.state.lineColor?this.state.lineColor:"#FFFFFF",onChange:this.onLineColorChange}),(0,e.jsx)(t.Select,{menuRole:"menu","aria-label":this.nls("styleShape")+this.state.lineType,size:"sm",name:"linePicker",value:this.state.lineType,onChange:this.onlineTypeChange},j.map(((s,i)=>{const a=c(62560)(`./${s.value}.svg`);return(0,e.jsx)(t.Option,{role:"option","aria-label":s,key:i,value:s.value,title:this.nls(s.label)},(0,e.jsx)(t.Icon,{width:60,height:12,icon:a}))}))),(0,e.jsx)(t.NumericInput,{"aria-label":this.nls("styleSize"),size:"sm",className:"ml-2",min:1,max:20,defaultValue:this.state.lineThickness,onChange:this.onLineThicknessChange})))}}const{epConfigIcon:M}=v();class N extends e.React.PureComponent{constructor(e){super(e),this.defaultSelectedItem={name:""},this.nls=e=>{const s=Object.assign({},o,t.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.onElevationValueChange=e=>{this.setState({elevationType:e.target.value},(()=>{this.props.updateProfileSettings("elevationSettings","type",this.state.elevationType)}))},this.onElevationValueUnitChange=e=>{this.setState({elevationUnits:e.target.value},(()=>{this.props.updateProfileSettings("elevationSettings","unit",this.state.elevationUnits)}))},this.updateLineStyle=(e,t,s)=>{this.props.updateProfileSettings(e,t,s)},this.onOneFieldSelect=e=>{0===e.length?(this.setState({oneFields:[]}),this.props.updateProfileSettings("elevationSettings","field1","")):(this.setState({oneFields:[e[0].jimuName]}),this.props.updateProfileSettings("elevationSettings","field1",e[0].jimuName))},this.onTwoFieldSelect=e=>{0===e.length?(this.setState({twoFields:[]}),this.props.updateProfileSettings("elevationSettings","field2","")):(this.setState({twoFields:[e[0].jimuName]}),this.props.updateProfileSettings("elevationSettings","field2",e[0].jimuName))},this.props.hasSupportForZValue?this.elevationTypeOptions=S:this.elevationTypeOptions=y,this.defaultSelectedItem.name=this.nls("noSelectionItemLabel"),this.state={oneFields:""===this.props.config.elevationSettings.field1?[]:[this.props.config.elevationSettings.field1],twoFields:""===this.props.config.elevationSettings.field2?[]:[this.props.config.elevationSettings.field2],elevationType:this.props.config.elevationSettings.type,elevationUnits:this.props.config.elevationSettings.unit}}render(){let i;return"no elevation"===this.state.elevationType?i=this.nls("noElevationHint"):"z"===this.state.elevationType&&(i=this.nls("noVerticalParamHint")),(0,e.jsx)("div",{style:{height:"100%",width:"100%"},css:p(this.props.theme)},(0,e.jsx)(s.SettingSection,null,(0,e.jsx)(s.SettingRow,{className:"pt-1"},(0,e.jsx)(t.Label,{tabIndex:0,"aria-label":this.nls("elevationSettingLabel"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break color-label setting-text-level-1"},this.nls("elevationSettingLabel"))),(0,e.jsx)(t.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("elevationSettingTooltip"),title:this.nls("elevationSettingTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"ml-2 d-inline"},(0,e.jsx)(t.Icon,{size:14,icon:M.infoIcon})))),(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(t.Label,{tabIndex:0,"aria-label":this.nls("valueType"),className:"flex-grow-1 ep-label"},(0,e.jsx)("div",{className:"flex-grow-1 text-break setting-text-level-3"},this.nls("valueType"))),(0,e.jsx)(t.Select,{menuRole:"menu","aria-label":this.state.elevationType,className:"selectOption",name:"elevationValueType",size:"sm",value:this.state.elevationType,onChange:this.onElevationValueChange},this.elevationTypeOptions.map(((s,i)=>(0,e.jsx)(t.Option,{role:"option",key:i,"aria-label":s.value,value:s.value},this.nls(s.name)))))),(0,e.jsx)(s.SettingRow,{className:"one"===this.state.elevationType||"two"===this.state.elevationType?"":"hidden"},(0,e.jsx)(t.Label,{tabIndex:0,"aria-label":this.nls("oneFieldLabel"),className:"flex-grow-1 ep-label"},(0,e.jsx)("div",{className:"flex-grow-1 text-break setting-text-level-3"},this.nls("oneFieldLabel"))),(0,e.jsx)(T.FieldSelector,{className:"fieldSelectorWidth",dataSources:[this.props.selectedLayerDataSource.layer],isSearchInputHidden:!0,onChange:this.onOneFieldSelect.bind(this),isDataSourceDropDownHidden:!0,useDropdown:!0,selectedFields:(0,e.Immutable)(this.state.oneFields),isMultiple:!1,types:(0,e.Immutable)([e.JimuFieldType.Number]),noSelectionItem:this.defaultSelectedItem})),(0,e.jsx)(s.SettingRow,{className:"two"===this.state.elevationType?"":"hidden"},(0,e.jsx)(t.Label,{tabIndex:0,"aria-label":this.nls("twoFieldLabel"),className:"flex-grow-1 ep-label"},(0,e.jsx)("div",{className:"flex-grow-1 text-break setting-text-level-3"},this.nls("twoFieldLabel"))),(0,e.jsx)(T.FieldSelector,{className:"fieldSelectorWidth",dataSources:[this.props.selectedLayerDataSource.layer],isSearchInputHidden:!0,onChange:this.onTwoFieldSelect.bind(this),isDataSourceDropDownHidden:!0,useDropdown:!0,selectedFields:(0,e.Immutable)(this.state.twoFields),types:(0,e.Immutable)([e.JimuFieldType.Number]),isMultiple:!1,noSelectionItem:this.defaultSelectedItem})),(0,e.jsx)(s.SettingRow,{className:"no elevation"===this.state.elevationType||"z"===this.state.elevationType&&!this.props.hasVerticalUnit?"hint":"hidden"},(0,e.jsx)(t.Label,{tabIndex:0,"aria-label":i,className:"w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break setting-text-level-3"},i))),(0,e.jsx)(s.SettingRow,{className:"no elevation"===this.state.elevationType||"z"===this.state.elevationType?"hidden":""},(0,e.jsx)(t.Label,{tabIndex:0,"aria-label":this.nls("valueUnit"),className:"flex-grow-1 ep-label"},(0,e.jsx)("div",{className:"flex-grow-1 text-break setting-text-level-3"},this.nls("valueUnit"))),(0,e.jsx)(t.Select,{menuRole:"menu","aria-label":this.state.elevationUnits,className:"selectOption",name:"valueunit",size:"sm",value:this.state.elevationUnits,onChange:this.onElevationValueUnitChange},f.map(((s,i)=>(0,e.jsx)(t.Option,{role:"option","aria-label":s.value,key:i,value:s.value},this.nls(s.value)))))),"map"!==this.props.config.distanceSettings.type&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(s.SettingRow,{className:"pt-3 ep-divider-top"},(0,e.jsx)(t.Label,{tabIndex:0,"aria-label":this.nls("distanceSettingLabel"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break color-label setting-text-level-1"},this.nls("distanceSettingLabel")))),(0,e.jsx)(s.SettingRow,null,(0,e.jsx)("div",{title:this.nls("distanceSettingsWarning")},(0,e.jsx)(t.Alert,{tabIndex:0,className:"warningMsg",text:this.nls("distanceSettingsWarning"),type:"warning"})))),(0,e.jsx)(s.SettingRow,{className:"pt-3 ep-divider-top"},(0,e.jsx)(t.Label,{tabIndex:0,"aria-label":this.nls("styleLabel"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break color-label setting-text-level-1"},this.nls("styleLabel"))),(0,e.jsx)(t.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("styleLineTooltip"),title:this.nls("styleLineTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"ml-2 d-inline"},(0,e.jsx)(t.Icon,{size:14,icon:M.infoIcon})))),(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(A,{intl:this.props.intl,lineItem:"style",onLineStyleChange:this.updateLineStyle,config:this.props.config.style}))))}}const{epConfigIcon:P}=v();class O extends e.React.PureComponent{constructor(){super(...arguments),this.backRef=e.React.createRef(),this.nls=s=>{const i=Object.assign({},o,t.defaultMessages,e.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:s,defaultMessage:i[s]}):i[s]},this.backRefFocus=()=>{setTimeout((()=>{var e,t;null===(t=null===(e=this.backRef)||void 0===e?void 0:e.current)||void 0===t||t.focus()}),50)}}getStyle(t){var s,i,a;return e.css`
      .setting-header {
        padding: ${e.polished.rem(18)} ${e.polished.rem(16)} ${e.polished.rem(0)} ${e.polished.rem(16)}
      }

      .setting-title {
        font-size: ${e.polished.rem(16)};
        color: ${null===(a=null===(i=null===(s=null==t?void 0:t.colors)||void 0===s?void 0:s.palette)||void 0===i?void 0:i.dark)||void 0===a?void 0:a[600]}
      }
    `}render(){return(0,e.jsx)("div",{tabIndex:-1,className:"w-100 h-100",css:this.getStyle(this.props.theme)},(0,e.jsx)("div",{tabIndex:-1,className:"w-100 d-flex align-items-center justify-content-between setting-header border-0",style:{height:"38px"}},this.props.hideBackArrow?(0,e.jsx)("div",{"aria-label":this.props.title,tabIndex:0,className:"setting-title mt-1",style:{maxWidth:"190px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:this.props.title},this.props.title):(0,e.jsx)("div",{tabIndex:-1,className:"h-100"},(0,e.jsx)("div",{ref:this.backRef,tabIndex:0,className:"d-flex align-items-center h-100",style:{cursor:"pointer"},onClick:this.props.onBack,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.props.onBack()}},(0,e.jsx)("div",{className:"d-flex align-items-center",title:this.nls("backButton"),"aria-label":this.nls("backButton")},(0,e.jsx)(t.Icon,{icon:P.iconBack,autoFlip:!0,size:"14",className:"text-dark"})),(0,e.jsx)("div",{"aria-label":this.props.title,className:"pl-2 setting-title",style:{maxWidth:"190px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:this.props.title},this.props.title))),(0,e.jsx)(t.Button,{role:"button","aria-label":this.nls("close"),title:this.nls("close"),size:"sm",icon:!0,type:"tertiary",onClick:this.props.onClose},(0,e.jsx)(t.Icon,{icon:P.iconClose,size:"16"}))),this.props.children)}}var R;function k(t){var s;const i=e.DataSourceManager.getInstance(),a=null===(s=null==i?void 0:i.getDataSource(t))||void 0===s?void 0:s.getChildDataSources(),l=[];return null==a||a.forEach((e=>{if("GROUP_LAYER"===e.type){const t=e.getChildDataSources();t&&t.forEach((e=>{l.push(e)}))}else l.push(e)})),l}function U(e,t){let s=null==e?void 0:e.profileChartSettings.elevationUnit,i=null==e?void 0:e.profileChartSettings.linearUnit;return(null==e?void 0:e.profileChartSettings.elevationUnit)||(s="english"===(null==t?void 0:t.units)?"feet":"meters"),(null==e?void 0:e.profileChartSettings.linearUnit)||(i="english"===(null==t?void 0:t.units)?"miles":"kilometers"),[s,i]}function E(){return"#"+Math.floor(16777215*Math.random()).toString(16).padStart(6,"0")}!function(e){e[e.Feet=528e4]="Feet",e[e.Miles=1e3]="Miles",e[e.Kilometers=1609.344]="Kilometers",e[e.Meters=1609344]="Meters",e[e.Yards=176e4]="Yards"}(R||(R={}));const F=e=>{switch(e){case"feet":return R.Feet;case"miles":return R.Miles;case"kilometers":return R.Kilometers;case"meters":return R.Meters;case"yards":return R.Yards;default:return 1e3}},V=e=>"english"===(null==e?void 0:e.units)?"feet":"meters",{epConfigIcon:B}=v(),G=(0,e.getAppStore)().getState().portalSelf;class z extends e.React.PureComponent{constructor(s){super(s),this.supportedDsTypes=(0,e.Immutable)([T.AllDataSourceTypes.FeatureLayer,T.AllDataSourceTypes.SceneLayer]),this.mvManager=l.MapViewManager.getInstance(),this.selectedLayerDataSource=null,this.layerSidePopperTrigger=e.React.createRef(),this.backRef=e.React.createRef(),this.allSelectedLayers=[],this.nls=e=>{const s=Object.assign({},o,t.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidMount=()=>{var e;(null===(e=this.props.config)||void 0===e?void 0:e.layers)&&(this.props.config.layers.forEach(((e,t)=>{this.getLayerListProperty(e.layerId)})),this.setState({selectedLayers:this.allSelectedLayers}))},this.componentDidUpdate=e=>{},this.getLayerListProperty=t=>{const s=e.DataSourceManager.getInstance().getDataSource(t);if(s){const e={label:s.getLabel(),layer:{id:s.id}};this.allSelectedLayers.push(e)}},this.getDsRootIdsByWidgetId=()=>{var t,s;const i=[],a=(null===(s=null===(t=(0,e.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===s?void 0:s.appConfig).dataSources[this.props.activeDataSource];return(null==a?void 0:a.type)!==l.ArcGISDataSourceTypes.WebMap&&(null==a?void 0:a.type)!==l.ArcGISDataSourceTypes.WebScene||i.push(this.props.activeDataSource),i.length>0?(0,e.Immutable)(i):void 0},this.dataSourceChangeSave=e=>{if(!e)return;let t=!1;if(this.allSelectedLayers.some((s=>{if(s.layer.id===e[0].dataSourceId)return t=!0,this.setState({isAlertMsgPopupOpen:!0}),!0})),!t){e.forEach(((e,t)=>{this.getLayerListProperty(e.dataSourceId)})),this.setState({selectedLayers:this.allSelectedLayers},(()=>{setTimeout((()=>{this.layerSidePopperTrigger.current.focus()}),50)})),this.updateLayersConfig=this.getLayersDefaultSettings(this.allSelectedLayers);const t=[...this.props.config.layers,this.updateLayersConfig[0]];this.props.onProfileSettingsUpdated("profileSettings",this.props.activeDataSource,null,null,t,!0)}},this.getLayersDefaultSettings=e=>{let t=[];return 0===this.props.config.layers.length?e.forEach(((e,s)=>{t=this.getProfileDefaultConfigOnAdd(e.layer)})):e.forEach((e=>{this.isLayerAlreadyConfigured(e.layer.id)||(t=this.getProfileDefaultConfigOnAdd(e.layer))})),t},this.isLayerAlreadyConfigured=e=>{let t=!1;return this.props.config.layers.forEach((s=>{if(e===s.layerId)return t=!0,!0})),t},this.showLayerData=(t,s)=>{var i,a,l,o;this.setState({showLayerDataItemPanel:!0,layerName:t.label},(()=>{var e;null===(e=this.backRef.current)||void 0===e||e.backRefFocus()}));const n=e.DataSourceManager.getInstance().getDataSource(t.layer.id);this.selectedLayerDataSource={dataSourceId:n.id,rootDataSourceId:n.parentDataSource.id,layer:n},this.selectedLayerConfig=this.getSelectedLayerConfig(n.id);const r=this.mapView.view.map.findLayerById(n.jimuChildId);this.hasSupportForZValue=r.hasZ,this.hasVerticalUnitParam=(null===(a=null===(i=null==r?void 0:r.sourceJSON)||void 0===i?void 0:i.sourceSpatialReference)||void 0===a?void 0:a.vcsWkid)||(null===(o=null===(l=r.sourceJSON)||void 0===l?void 0:l.sourceSpatialReference)||void 0===o?void 0:o.vcsWkt)},this.getSelectedLayerConfig=e=>{var t,s;let i;return null===(s=null===(t=this.props.config)||void 0===t?void 0:t.layers)||void 0===s||s.forEach((t=>{e===t.layerId&&(i=t)})),i},this.removeLayerDataItem=(e,t,s)=>{var i,a;e.stopPropagation();const l=this.state.selectedLayers;l.splice(t,1),this.allSelectedLayers=l,this.setState({selectedLayers:this.allSelectedLayers},(()=>{this.layerSidePopperTrigger.current.focus()})),null===(a=null===(i=this.props.config)||void 0===i?void 0:i.layers)||void 0===a||a.forEach(((e,t)=>{if((null==e?void 0:e.layerId)===s){const e=this.props.config.layers.asMutable({deep:!0});e.splice(t,1),this.updateLayersConfig=e,this.props.onProfileSettingsUpdated("profileSettings",this.props.activeDataSource,null,null,this.updateLayersConfig,!0)}}))},this.createLayerElement=(s,i)=>(0,e.jsx)("div",{ref:this.layerSidePopperTrigger,"aria-label":s.label,tabIndex:0,key:i+Date.now(),className:"layer-data-item align-items-center"},(0,e.jsx)("div",{className:"layer-data-item-name flex-grow-1",title:s.label},s.label),(0,e.jsx)(t.Button,{role:"button",title:this.nls("deleteLayer"),"aria-label":this.nls("deleteLayer"),size:"sm",type:"tertiary",icon:!0,className:"p-0",key:i+Date.now(),onClick:e=>{this.removeLayerDataItem(e,i,s.layer.id)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.removeLayerDataItem(e,i,s.layer.id)}},(0,e.jsx)(t.Icon,{icon:B.iconClose,size:12}))),this.getLayerIndex=e=>{let t=-1;return this.props.config.layers.forEach(((s,i)=>{e===s.layerId&&(t=i)})),t},this.updateConfig=(e,t,s)=>{const i={parentKey:e,childKey:t,value:s},a=this.getLayerIndex(this.selectedLayerConfig.layerId);this.props.onProfileSettingsUpdated("profileSettings",this.props.activeDataSource,a,i,null,!1)},this.backForwardPanel=()=>{this.setState({showLayerDataItemPanel:!1},(()=>{this.layerSidePopperTrigger.current.focus()}))},this.closePanel=()=>{this.setState({showLayerDataItemPanel:!1},(()=>{this.layerSidePopperTrigger.current.focus()})),this.index=0},this.disableSelection=e=>!1,this.hideMessage=()=>{this.setState({isAlertMsgPopupOpen:!1})},this.index=0,this.updateLayersConfig=this.props.config.layers;const i=this.mvManager.jimuMapViewGroups[this.props.mapWidgetId];for(const e in i.jimuMapViews)i.jimuMapViews[e].dataSourceId===this.props.activeDataSource&&(this.mapView=i.jimuMapViews[e]);this.state={selectedLayers:[],showLayerDataItemPanel:!1,layerName:null,isAlertMsgPopupOpen:!1}}getProfileDefaultConfigOnAdd(t){var s,i,a;const l=e.DataSourceManager.getInstance().getDataSource(t.id),o=l,n=U(this.props.activeDsConfig,G),r=[];if(o&&o.layerDefinition&&o.layerDefinition.geometryType&&"esriGeometryPolyline"===o.layerDefinition.geometryType){let t="no elevation";o.layerDefinition.hasZ&&(t="z");const p=Object.assign({},I);(null===(s=null==o?void 0:o.layerDefinition)||void 0===s?void 0:s.hasGeometryProperties)&&(null===(a=null===(i=null==o?void 0:o.layerDefinition)||void 0===i?void 0:i.geometryProperties)||void 0===a?void 0:a.shapeLengthFieldName)?p.distanceSettings.field=o.layerDefinition.geometryProperties.shapeLengthFieldName:p.distanceSettings.field="",p.style.lineColor=E(),p.elevationSettings.unit=n[0],p.distanceSettings.unit=n[1],p.layerId=l.id,p.elevationSettings.type=t,r.push((0,e.Immutable)(p))}return r}render(){var i;const l=e.DataSourceManager.getInstance().getDataSource(this.props.activeDataSource),o=null==l?void 0:l.getChildDataSources(),n=[];null==o||o.forEach((e=>{var t;if("GROUP_LAYER"===e.type){const t=e.getChildDataSources();t&&t.forEach((e=>{var t;"esriGeometryPolyline"===(null===(t=e.layerDefinition)||void 0===t?void 0:t.geometryType)&&n.push(e.id)}))}else"esriGeometryPolyline"===(null===(t=e.layerDefinition)||void 0===t?void 0:t.geometryType)&&n.push(e.id)}));const r={fromRootDsIds:this.getDsRootIdsByWidgetId(),fromDsIds:(0,e.Immutable)(n)};return(0,e.jsx)("div",{css:p(this.props.theme),style:{height:"100%",width:"100%",marginTop:5}},(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(t.Label,{tabIndex:0,"aria-label":this.nls("selectableLayersLabel"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break color-label"},this.nls("selectableLayersLabel"))),(0,e.jsx)(t.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("selectableLayersTooltip"),title:this.nls("selectableLayersTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"ml-2 d-inline color-label"},(0,e.jsx)(t.Icon,{size:14,icon:B.infoIcon})))),(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(T.DataSourceSelector,{className:"ep-data-source-selector",types:this.supportedDsTypes,buttonLabel:this.nls("selectableButton"),fromRootDsIds:r.fromRootDsIds,fromDsIds:r.fromDsIds,mustUseDataSource:!0,onChange:this.dataSourceChangeSave,disableDataView:!0,enableToSelectOutputDsFromSelf:!1,closeDataSourceListOnChange:!0,hideTypeDropdown:!1,disableAddData:!0,disableRemove:()=>!0,disableSelection:this.disableSelection,widgetId:this.props.widgetId,hideDataView:!0})),0===this.state.selectedLayers.length&&(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(t.Label,{tabIndex:0,"aria-label":this.nls("selectableLayersWarning"),className:"hint w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break setting-text-level-3"},this.nls("selectableLayersWarning")))),(0,e.jsx)(s.SettingRow,{className:this.state.selectedLayers.length>0?"":"hidden"},(0,e.jsx)(a.List,{className:"ep-layers-list",itemsJson:Array.from(this.state.selectedLayers).map(((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`}))),dndEnabled:!1,onClickItemBody:(e,t)=>{const{itemJsons:s}=t.props,i=s[0],a=s[1];this.showLayerData(i.itemStateDetailContent,a.indexOf(i))},overrideItemBlockInfo:()=>({name:a.TreeItemActionType.RenderOverrideItem,children:[{name:a.TreeItemActionType.RenderOverrideItemBody,children:[{name:a.TreeItemActionType.RenderOverrideItemMainLine}]}]}),renderOverrideItemMainLine:(e,t)=>{const{itemJsons:s}=t.props,i=s[0],a=s[1];return this.createLayerElement(i.itemStateDetailContent,a.indexOf(i))}})),(0,e.jsx)(s.SidePopper,{isOpen:this.state.showLayerDataItemPanel&&!e.urlUtils.getAppIdPageIdFromUrl().pageId,position:"right",toggle:this.closePanel,trigger:null===(i=this.layerSidePopperTrigger)||void 0===i?void 0:i.current},(0,e.jsx)("div",{className:"bg-light-300 border-color-gray-400",css:h(this.props.theme)},(0,e.jsx)(O,{theme:this.props.theme,intl:this.props.intl,title:this.state.layerName,ref:this.backRef,onBack:this.backForwardPanel,onClose:this.closePanel},(0,e.jsx)("div",{className:"setting-container"},(0,e.jsx)(N,{config:this.selectedLayerConfig,hasVerticalUnit:this.hasVerticalUnitParam,hasSupportForZValue:this.hasSupportForZValue,selectedLayerDataSource:this.selectedLayerDataSource,intl:this.props.intl,theme:this.props.theme,updateProfileSettings:this.updateConfig.bind(this)}))))),this.state.isAlertMsgPopupOpen&&(0,e.jsx)(t.AlertPopup,{"aria-expanded":this.state.isAlertMsgPopupOpen,hideCancel:!0,isOpen:this.state.isAlertMsgPopupOpen&&!e.urlUtils.getAppIdPageIdFromUrl().pageId,onClickOk:this.hideMessage.bind(this),onClickClose:this.hideMessage.bind(this),title:this.nls("alert")},(0,e.jsx)("div",{className:"p-2"},this.nls("alreadySelectedLayerMsg"))))}}const{epConfigIcon:W}=v();class H extends e.React.PureComponent{constructor(i){super(i),this.nls=e=>{const s=Object.assign({},o,t.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidMount=()=>{const e=[];this.props.availableStatistics.forEach((t=>{const s={name:t.name,label:t.label,enabled:t.enabled};e.push(s)})),e.length>0&&this._statistics.length!==e.length&&(this._statistics=e),this.props.onStatsListUpdated(this._statistics)},this.componentDidUpdate=e=>{this.isStatsPropsChange(e)&&(this._statistics=this.props.availableStatistics)},this.isStatsPropsChange=e=>{let t=!1;return e.availableStatistics.length>0&&e.availableStatistics.some((e=>this.props.availableStatistics.some((s=>e.name===s.name&&e.enabled!==s.enabled&&(t=!0,!0))))),t},this.createOptionElement=(i,a)=>(0,e.jsx)("div",{style:{width:180}},(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(t.Checkbox,{role:"çheckbox",className:"cursor-pointer mr-2 font-13","aria-label":i.label,checked:i.enabled,onChange:e=>{this.onCheckBoxChange(e,a)}}),(0,e.jsx)("div",{className:"text-truncate",title:i.label},this.nls(i.name)))),this.onCheckBoxChange=(e,t)=>{let s;this._statistics.some(((i,a)=>t===a&&(s={name:i.name,label:i.label,enabled:e.currentTarget.checked},!0))),e.stopPropagation(),this.updateItem(t,s)},this.updateItem=(e,t)=>{e>-1&&(this._statistics=[...this._statistics.slice(0,e),Object.assign({},this._statistics[e],t),...this._statistics.slice(e+1)],this.props.onStatsListUpdated(this._statistics))},this._statistics=[]}render(){return(0,e.jsx)("div",{css:(i=this.props.theme,e.css`
    .color-label {
      color: ${i.colors.palette.dark[400]};
    }

    .ep-statistics-list-items {
      flex: 1;
      max-height: 215px;
      overflow-y: auto;

      .jimu-tree-item [data-dndzone-droppable=true] {
        border: 1px solid transparent;
      }

      .jimu-tree-item.jimu-tree-item_dnd-true {
        height: auto;
        padding-top: 0rem;

        .jimu-tree-item__body {
          padding: 8px 0px 8px 0px;
        }
      }
    }
  `),className:"pt-3 pb-2"},(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(t.Label,{tabIndex:0,"aria-label":this.nls("statisticsListLabel"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break color-label"},this.nls("statisticsListLabel"))),(0,e.jsx)(t.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("statisticsListTooltip"),title:this.nls("statisticsListTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"ml-2 d-inline color-label"},(0,e.jsx)(t.Icon,{size:14,icon:W.infoIcon})))),(0,e.jsx)("div",{className:"pt-2"},(0,e.jsx)(a.List,{size:"sm",className:this.props.availableStatistics&&0===this.props.availableStatistics.length?"hidden":"ep-statistics-list-items",itemsJson:Array.from(this.props.availableStatistics).map(((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`}))),dndEnabled:!0,onUpdateItem:(e,t)=>{const{itemJsons:s}=t.props,[,i]=s,a=i.map((e=>e.itemStateDetailContent));this._statistics=a,this.props.onStatsListUpdated(a)},overrideItemBlockInfo:()=>({name:a.TreeItemActionType.RenderOverrideItem,children:[{name:a.TreeItemActionType.RenderOverrideItemDroppableContainer,withListGroupItemWrapper:!1,children:[{name:a.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:a.TreeItemActionType.RenderOverrideItemBody,children:[{name:a.TreeItemActionType.RenderOverrideItemDragHandle},{name:a.TreeItemActionType.RenderOverrideItemMainLine}]}]}]}]}),renderOverrideItemMainLine:(e,t)=>{const{itemJsons:s}=t.props,i=s[0],a=s[1];return this.createOptionElement(i.itemStateDetailContent,a.indexOf(i))}})));var i}}var J=function(e,t,s,i){return new(s||(s=Promise))((function(a,l){function o(e){try{r(i.next(e))}catch(e){l(e)}}function n(e){try{r(i.throw(e))}catch(e){l(e)}}function r(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,n)}r((i=i.apply(e,t||[])).next())}))};const{epConfigIcon:Z}=v(),_=/^(http:\/\/www\.|https:\/\/www\.|http:\/\/|https:\/\/)?[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(:[0-9]{1,5})?(\/.*)?$/,$=(0,e.getAppStore)().getState().portalSelf;class K extends e.React.PureComponent{constructor(s){super(s),this.elevationTextBox=e.React.createRef(),this.setLinearUnit=e=>{""===e&&(e="english"===(null==$?void 0:$.units)?"miles":"kilometers"),this.setState({linearUnit:e})},this.setElevationUnit=e=>{""===e&&(e="english"===(null==$?void 0:$.units)?"feet":"meters"),this.setState({elevationUnit:e})},this.nls=e=>{const s=Object.assign({},o,t.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidMount=()=>{this.state.apiLoaded||this.loadAPIModule()},this.componentDidUpdate=e=>{e.config.elevationUnit!==this.props.config.elevationUnit&&this.setElevationUnit(this.props.config.elevationUnit),e.config.linearUnit!==this.props.config.linearUnit&&this.setLinearUnit(this.props.config.linearUnit)},this.loadAPIModule=()=>J(this,void 0,void 0,(function*(){if(this.state.apiLoaded)return Promise.resolve();yield(0,l.loadArcGISJSAPIModules)(["esri/request"]).then((e=>{[this.esriRequest]=e,this.setState({apiLoaded:!0})}))})),this.onLinearUnitChange=e=>{this.setState({linearUnit:e.target.value},(()=>{this.props.onProfileChartSettingsUpdated("linearUnit",this.state.linearUnit)}))},this.onElevationUnitChange=e=>{this.setState({elevationUnit:e.target.value},(()=>{this.props.onProfileChartSettingsUpdated("elevationUnit",this.state.elevationUnit)}))},this.onSetButtonClicked=()=>{this.setState({isAlertPopupOpen:!0,isInvalidValue:!1},(()=>{setTimeout((()=>{const e=window.jimuUA.browser?(window.jimuUA.browser.name+"").toLowerCase():"";"chrome"===e||"microsoft edge"===e?(this.elevationTextBox.current.selectionStart=this.elevationTextBox.current.selectionEnd=0,this.elevationTextBox.current.focus()):(this.props.isRTL||(this.elevationTextBox.current.selectionStart=this.elevationTextBox.current.selectionEnd=0),this.elevationTextBox.current.focus())}),1e3)})),setTimeout((()=>{const e=this.state.elevationLayerURL;this.setState({updateElevationLayerURL:e})}),500)},this.onAlertOkButtonClicked=()=>{""!==this.elevationTextBox.current.value&&(this.state.isInvalidValue||(this.setState({elevationLayerURL:this.elevationTextBox.current.value}),this.props.onProfileChartSettingsUpdated("elevationLayerURL",this.elevationTextBox.current.value),this.onAlertCloseButtonClicked()))},this.onAlertCloseButtonClicked=()=>{this.setState({isAlertPopupOpen:!1})},this.onInputChange=e=>new Promise((t=>{this.setState({updateElevationLayerURL:e}),e&&_.test(e)?this._validateElevationService(e).then((e=>{this.setState({isInvalidValue:e},(()=>{t(this.state.isInvalidValue)}))})):this.setState({isInvalidValue:!0},(()=>{t(this.state.isInvalidValue)}))})),this._validateElevationService=e=>J(this,void 0,void 0,(function*(){return new Promise((t=>{try{this.esriRequest(e,{query:{f:"json"},responseType:"json"}).then((e=>{var s;let i=!0;"Elevation"===(null===(s=null==e?void 0:e.data)||void 0===s?void 0:s.cacheType)&&(i=!1),t(i)}),(e=>{console.error(e),t(!0)}))}catch(e){console.error(e),t(!0)}}))})),this.ondisplayGroundProfileStatsChange=e=>{this.props.onProfileChartSettingsUpdated("displayStatistics",e.target.checked)},this.onGroundColorChange=e=>{this.props.onProfileChartSettingsUpdated("groundColor",e)},this.onVolumetricObjLineColorChange=e=>{this.props.onProfileChartSettingsUpdated("volumetricObjLineColor",e)},this.onshowVolumetricObjLineInGraphChange=e=>{this.props.onProfileChartSettingsUpdated("showVolumetricObjLineInGraph",e.target.checked)},this.onVolumetricObjLabelChange=e=>{const t=e.target.value;this.setState({volumetricObjectsLabel:t})},this.onVolumetricObjLabelAcceptValue=e=>{this.setState({volumetricObjectsLabel:e.trim()},(()=>{this.props.onProfileChartSettingsUpdated("volumetricObjLabel",this.state.volumetricObjectsLabel)}))},this.onHighlightGraphicsColorChange=e=>{this.props.onProfileChartSettingsUpdated("graphicsHighlightColor",e)},this.handleIsUseCustomElevation=e=>{e?setTimeout((()=>{this.props.onProfileChartSettingsUpdated("elevationLayerURL",this.state.updateElevationLayerURL)}),50):setTimeout((()=>{this.props.onProfileChartSettingsUpdated("elevationLayerURL",this.state.groundElevationLayer)}),50),this.props.onProfileChartSettingsUpdated("isCustomElevationLayer",e)},this.updateStatistics=e=>{this.props.onProfileChartSettingsUpdated("selectedStatistics",e)},this.elevationTextBox=e.React.createRef();let i=this.props.config.elevationUnit,a=this.props.config.linearUnit;""===this.props.config.elevationUnit&&(i=V($)),""===this.props.config.linearUnit&&(a=(e=>"english"===(null==e?void 0:e.units)?"miles":"kilometers")($));let n="",r=!1;this.props.groundLayerInfo.forEach((e=>{e.dataSourceId===this.props.currentDs&&(r=e.isGroundElevationLayerExists,n=e.groundElevationLayerUrl)})),this.state={apiLoaded:!1,elevationLayerURL:this.props.config.elevationLayerURL,updateElevationLayerURL:this.props.config.elevationLayerURL,isGroundDisabled:!r,groundElevationLayer:n,elevationUnit:i,linearUnit:a,isInvalidValue:!1,isAlertPopupOpen:!1,isActiveWebscene:r,volumetricObjectsLabel:this.props.config.volumetricObjLabel?this.props.config.volumetricObjLabel:this.nls("volumetricObjectsLabel")}}render(){return(0,e.jsx)("div",{style:{height:"100%",width:"100%",marginTop:5},css:(i=this.props.theme,e.css`
    .selectOption {
      width: 114px;
    }

    .color-label {
      color: ${i.colors.palette.dark[400]};
    }

    .hidden {
      display: none;
    }

    .cursor-pointer {
      cursor: pointer;
    }

    .disabled-label{
      color: ${i.colors.palette.light[800]};
    }

    .ep-tooltip {
      margin-right: 0.30rem!important;
    }

    .ep-divider-top {
      border-top: 1px solid var(--light-800)
    }
  `)},(0,e.jsx)("div",null,(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(t.Label,{tabIndex:0,"aria-label":this.nls("elevationLayerLabel"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break color-label setting-text-level-1"},this.nls("elevationLayerLabel"))),(0,e.jsx)(t.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("elevationLayerTooltip"),title:this.nls("elevationLayerTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"ml-2 d-inline"},(0,e.jsx)(t.Icon,{size:14,icon:Z.infoIcon})))),(0,e.jsx)(s.SettingRow,null,(0,e.jsx)("div",{className:"d-flex justify-content-between w-100 align-items-center"},(0,e.jsx)("div",{className:"align-items-center d-flex"},(0,e.jsx)(t.Radio,{role:"radio",disabled:this.state.isGroundDisabled,className:"cursor-pointer",onChange:()=>{this.handleIsUseCustomElevation(!1)},checked:!this.props.config.isCustomElevationLayer,title:this.nls("useDefaultGround"),"aria-label":this.nls("useDefaultGround")}),(0,e.jsx)("label",{className:(0,e.classNames)("m-0 ml-2 text-break cursor-pointer",this.state.isGroundDisabled?"disabled-label":" color-label"),onClick:()=>{!this.state.isGroundDisabled&&this.handleIsUseCustomElevation(!1)}},this.nls("useDefaultGround"))))),(0,e.jsx)(s.SettingRow,null,(0,e.jsx)("div",{className:"d-flex justify-content-between w-100 align-items-center"},(0,e.jsx)("div",{className:"align-items-center d-flex"},(0,e.jsx)(t.Radio,{role:"radio",className:"cursor-pointer",onChange:()=>{this.handleIsUseCustomElevation(!0)},checked:this.props.config.isCustomElevationLayer,"aria-expanded":this.props.config.isCustomElevationLayer,title:this.nls("useCustomElevation"),"aria-label":this.nls("useCustomElevation")}),(0,e.jsx)("label",{className:"m-0 ml-2 text-break cursor-pointer color-label",onClick:()=>{this.handleIsUseCustomElevation(!0)}},this.nls("useCustomElevation"))))),this.props.config.isCustomElevationLayer&&(0,e.jsx)("div",{className:"pb-3 pt-3"},(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(t.TextArea,{role:"textarea","aria-label":this.state.elevationLayerURL,height:76,className:"w-100",spellCheck:!1,value:this.state.elevationLayerURL,onClick:e=>{e.currentTarget.select()},readOnly:!0})),(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(t.Button,{role:"button","aria-label":this.nls("setServiceLabel"),className:"w-100 text-dark text-break",type:"primary",onClick:this.onSetButtonClicked.bind(this)},this.nls("setServiceLabel")))),(0,e.jsx)(s.SettingRow,{className:"pt-3 ep-divider-top"},(0,e.jsx)(t.Label,{tabIndex:0,"aria-label":this.nls("measurementUnitsHeadingLabel"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break color-label setting-text-level-1"},this.nls("measurementUnitsHeadingLabel"))),(0,e.jsx)(t.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("measurementUnitsHeadingTooltip"),title:this.nls("measurementUnitsHeadingTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"ml-2 d-inline"},(0,e.jsx)(t.Icon,{size:14,icon:Z.infoIcon})))),(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(t.Label,{tabIndex:0,"aria-label":this.nls("elevationUnitLabel"),style:{width:108},className:"d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break setting-text-level-3"},this.nls("elevationUnitLabel"))),(0,e.jsx)(t.Select,{menuRole:"menu","aria-label":this.state.elevationUnit,className:"selectOption",size:"sm",name:"elevationUnit",value:this.state.elevationUnit,onChange:this.onElevationUnitChange},f.map(((s,i)=>(0,e.jsx)(t.Option,{role:"option","aria-label":s.value,key:i,value:s.value},this.nls(s.value)))))),(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(t.Label,{tabIndex:0,"aria-label":this.nls("distanceUnitLabel"),style:{width:108},className:"d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break setting-text-level-3"},this.nls("distanceUnitLabel"))),(0,e.jsx)(t.Select,{menuRole:"menu","aria-label":this.state.linearUnit,className:"selectOption",size:"sm",name:"linearUnit",value:this.state.linearUnit,onChange:this.onLinearUnitChange},f.map(((s,i)=>(0,e.jsx)(t.Option,{role:"option","aria-label":s.value,key:i,value:s.value},this.nls(s.value)))))),(0,e.jsx)(s.SettingRow,{className:"pt-3 ep-divider-top"},(0,e.jsx)(t.Label,{tabIndex:0,"aria-label":this.nls("styleLabel"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break color-label setting-text-level-1"},this.nls("styleLabel"))),(0,e.jsx)(t.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("styleGroundTooltip"),title:this.nls("styleGroundTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"ml-2 d-inline"},(0,e.jsx)(t.Icon,{size:14,icon:Z.infoIcon})))),(0,e.jsx)(s.SettingRow,{label:this.nls("groundColor")},(0,e.jsx)(D.ColorPicker,{"aria-label":this.nls("groundColor"),title:this.nls("groundColor"),placement:"top",offset:[0,0],showArrow:!0,color:this.props.config.groundColor?this.props.config.groundColor:"#b54900",onChange:this.onGroundColorChange})),(0,e.jsx)(s.SettingRow,{label:this.nls("chooseHighlightColor")},(0,e.jsx)(D.ColorPicker,{"aria-label":this.nls("chooseHighlightColor"),title:this.nls("chooseHighlightColor"),placement:"top",offset:[0,0],showArrow:!0,color:this.props.config.graphicsHighlightColor?this.props.config.graphicsHighlightColor:"#b54900",onChange:this.onHighlightGraphicsColorChange})),this.state.isActiveWebscene&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(s.SettingRow,{className:"pt-3 ep-divider-top"},(0,e.jsx)(t.Label,{tabIndex:0,"aria-label":this.nls("volumetricObjectsLabel"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break color-label setting-text-level-1"},this.nls("volumetricObjectsLabel"))),(0,e.jsx)(t.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("volumetricObjectsTooltip"),title:this.nls("volumetricObjectsTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"ml-2 d-inline"},(0,e.jsx)(t.Icon,{size:14,icon:Z.infoIcon})))),(0,e.jsx)(s.SettingRow,{label:this.nls("showInGraph")},(0,e.jsx)(t.Switch,{role:"switch","aria-label":this.nls("showInGraph"),title:this.nls("showInGraph"),checked:this.props.config.showVolumetricObjLineInGraph,onChange:this.onshowVolumetricObjLineInGraphChange})),this.props.config.showVolumetricObjLineInGraph&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(s.SettingRow,{label:this.nls("viewLineColor")},(0,e.jsx)(D.ColorPicker,{"aria-label":this.nls("viewLineColor"),title:this.nls("viewLineColor"),placement:"top",offset:[0,0],showArrow:!0,color:this.props.config.volumetricObjLineColor?this.props.config.volumetricObjLineColor:"#b54900",onChange:this.onVolumetricObjLineColorChange})),(0,e.jsx)(s.SettingRow,{label:this.nls("label"),flow:"wrap"},(0,e.jsx)(t.TextInput,{role:"textbox","aria-label":this.nls("volumetricObjectsLabel"),size:"sm",className:"w-100",value:this.state.volumetricObjectsLabel,onAcceptValue:this.onVolumetricObjLabelAcceptValue,onChange:this.onVolumetricObjLabelChange})))),(0,e.jsx)(s.SettingRow,{className:"pt-3 ep-divider-top",label:this.nls("displayGroundProfileStatsLabel")},(0,e.jsx)(t.Switch,{role:"switch","aria-label":this.nls("displayGroundProfileStatsLabel"),title:this.nls("displayGroundProfileStatsLabel"),checked:this.props.config.displayStatistics,onChange:this.ondisplayGroundProfileStatsChange})),this.props.config.displayStatistics&&(0,e.jsx)("div",null,(0,e.jsx)(H,{intl:this.props.intl,theme:this.props.theme,availableStatistics:this.props.config.selectedStatistics,onStatsListUpdated:this.updateStatistics}))),(0,e.jsx)(t.AlertPopup,{isOpen:this.state.isAlertPopupOpen,css:n(this.props.theme),onClickOk:this.onAlertOkButtonClicked.bind(this),onClickClose:this.onAlertCloseButtonClicked,title:this.props.intl?this.nls("alertPopupTitle"):""},(0,e.jsx)("div",{className:"popupContents"},(0,e.jsx)("div",{className:"alertValidationContent"},(0,e.jsx)(t.TextInput,{className:this.state.isInvalidValue?"elevationUrlTextInput w-100 is-invalid":"elevationUrlTextInput w-100 is-valid",size:"sm",type:"text",ref:this.elevationTextBox,value:this.state.updateElevationLayerURL,onChange:e=>this.onInputChange(e.currentTarget.value)}),(0,e.jsx)("div",{className:this.state.isInvalidValue?"invalidServiceURL elevationErrorMessage text-truncate":"validServiceURL text-truncate"},this.nls("invalidElevationLayerURL"))))));var i}}const{epConfigIcon:q}=v();class Y extends e.React.PureComponent{constructor(e){super(e),this.nls=e=>{const s=Object.assign({},o,t.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidMount=()=>{this.props.onGeneralSettingsUpdated("allowExport",!!this.props.config.allowExport&&this.props.config.allowExport)},this.componentDidUpdate=e=>{e.config.isSelectToolActive!==this.props.config.isSelectToolActive&&this.setSelectTool(this.props.config.isSelectToolActive),e.config.isDrawToolActive!==this.props.config.isDrawToolActive&&this.setDrawTool(this.props.config.isDrawToolActive)},this.allowExportOptionChange=e=>{this.props.onGeneralSettingsUpdated("allowExport",e.target.checked)},this.setSelectTool=e=>{this.setState({selectToggleTool:e},(()=>{this.props.onGeneralSettingsUpdated("isDrawToolActive",this.state.drawToggleTool)}))},this.setDrawTool=e=>{this.setState({drawToggleTool:e},(()=>{this.props.onGeneralSettingsUpdated("isSelectToolActive",this.state.selectToggleTool)}))},this.selectToolStateChange=e=>{e.target.checked?this.setState({drawToggleTool:!1,selectToggleTool:!0},(()=>{this.props.onGeneralSettingsUpdated("isSelectToolActive",this.state.selectToggleTool)})):this.setState({drawToggleTool:this.state.drawToggleTool,selectToggleTool:!1},(()=>{this.props.onGeneralSettingsUpdated("isSelectToolActive",this.state.selectToggleTool)}))},this.drawToolStateChange=e=>{e.target.checked?this.setState({selectToggleTool:!1,drawToggleTool:!0},(()=>{this.props.onGeneralSettingsUpdated("isDrawToolActive",this.state.drawToggleTool)})):this.setState({drawToggleTool:!1,selectToggleTool:this.state.selectToggleTool},(()=>{this.props.onGeneralSettingsUpdated("isDrawToolActive",this.state.drawToggleTool)}))},this.onToggleAppearance=()=>{this.setState({isAppearanceSettingsOpen:!this.state.isAppearanceSettingsOpen})},this.onShowGridChange=e=>{this.props.onGeneralSettingsUpdated("showGridAxis",e.target.checked)},this.onShowAxisTitlesChange=e=>{this.props.onGeneralSettingsUpdated("showAxisTitles",e.target.checked)},this.legendStateChange=e=>{this.props.onGeneralSettingsUpdated("showLegend",e.target.checked)},this.state={selectToggleTool:this.props.config.isSelectToolActive,drawToggleTool:this.props.config.isDrawToolActive,isAppearanceSettingsOpen:!1}}render(){return(0,e.jsx)("div",{style:{height:"100%",width:"100%",marginTop:5},css:(this.props.theme,e.css`
    .hidden {
      display: none;
    }

    .cursor-pointer {
      cursor: pointer;
    }

    .ep-tooltip {
      margin-right: 0.30rem!important;
    }
  `)},(0,e.jsx)(s.SettingRow,{label:this.nls("allowExportLabel")},(0,e.jsx)(t.Switch,{role:"switch","aria-label":this.nls("allowExportLabel"),title:this.nls("allowExportLabel"),checked:!!this.props.config.allowExport&&this.props.config.allowExport,onChange:this.allowExportOptionChange})),(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(t.Label,{tabIndex:0,"aria-label":this.nls("activateToolOnLoadLabel"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break"},this.nls("activateToolOnLoadLabel"))),(0,e.jsx)(t.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("activateToolOnLoadTooltip"),title:this.nls("activateToolOnLoadTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"ml-2 d-inline"},(0,e.jsx)(t.Icon,{size:14,icon:q.infoIcon})))),(0,e.jsx)(s.SettingRow,{label:this.nls("selectTool")},(0,e.jsx)(t.Switch,{role:"switch","aria-label":this.nls("selectTool"),title:this.nls("selectTool"),checked:this.state.selectToggleTool,onChange:this.selectToolStateChange})),(0,e.jsx)(s.SettingRow,{label:this.nls("drawTool")},(0,e.jsx)(t.Switch,{role:"switch","aria-label":this.nls("drawTool"),title:this.nls("drawTool"),checked:this.state.drawToggleTool,onChange:this.drawToolStateChange})),(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(t.CollapsablePanel,{label:this.nls("appearanceCollapsible"),isOpen:this.state.isAppearanceSettingsOpen,onRequestOpen:()=>{this.onToggleAppearance()},onRequestClose:()=>{this.onToggleAppearance()}},(0,e.jsx)("div",{style:{height:"100%",marginTop:10}},(0,e.jsx)(s.SettingRow,{label:this.nls("showChartGridsLabel")},(0,e.jsx)(t.Switch,{role:"switch","aria-label":this.nls("showChartGridsLabel"),title:this.nls("showChartGridsLabel"),checked:this.props.config.showGridAxis,onChange:this.onShowGridChange})),(0,e.jsx)(s.SettingRow,{label:this.nls("showChartAxisTitlesLabel")},(0,e.jsx)(t.Switch,{role:"switch","aria-label":this.nls("showChartAxisTitlesLabel"),title:this.nls("showChartAxisTitlesLabel"),checked:this.props.config.showAxisTitles,onChange:this.onShowAxisTitlesChange})),(0,e.jsx)(s.SettingRow,{label:this.nls("showLegend")},(0,e.jsx)(t.Switch,{role:"switch","aria-label":this.nls("showLegend"),title:this.nls("showLegend"),checked:this.props.config.showLegend,onChange:this.legendStateChange}))))))}}class X extends e.React.PureComponent{constructor(e){super(e),this.nls=e=>{const s=Object.assign({},o,t.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidMount=()=>{this.props.onIntersectingAssetStyleChange(this.props.intersectingAssetItem,"intersectingAssetShape",this.state.intersectingAssetShape)},this.onIntersectingAssetColorChange=e=>{this.setState({intersectingAssetColor:e}),this.props.onIntersectingAssetStyleChange(this.props.intersectingAssetItem,"intersectingAssetColor",e)},this.onIntersectingAssetShapeChange=e=>{this.setState({intersectingAssetShape:e.currentTarget.value}),this.props.onIntersectingAssetStyleChange(this.props.intersectingAssetItem,"intersectingAssetShape",e.currentTarget.value)},this.onIntersectingAssetSizeChange=e=>{null!==e&&(this.setState({intersectingAssetSize:e}),this.props.onIntersectingAssetStyleChange(this.props.intersectingAssetItem,"intersectingAssetSize",e))};const s="esriGeometryPoint"===this.props.layerGeometryType?6:4,i="esriGeometryPoint"===this.props.layerGeometryType?"circle":"solid-line";this.state={intersectingAssetColor:this.props.config.intersectingAssetColor?this.props.config.intersectingAssetColor:"#049546",intersectingAssetShape:this.props.config.intersectingAssetShape?this.props.config.intersectingAssetShape:i,intersectingAssetSize:this.props.config.intersectingAssetSize?this.props.config.intersectingAssetSize:s}}render(){return(0,e.jsx)("div",{className:"pt-4 pb-3"},(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(D.ColorPicker,{"aria-label":this.nls("styleColor"),className:"mr-2",width:"54px",height:"26px",offset:[0,0],placement:"top",showArrow:!0,color:this.state.intersectingAssetColor?this.state.intersectingAssetColor:"#FFFFFF",onChange:this.onIntersectingAssetColorChange}),(0,e.jsx)(t.Select,{menuRole:"menu","aria-label":this.nls("styleShape")+this.state.intersectingAssetShape,size:"sm",name:"symbolPicker",onChange:this.onIntersectingAssetShapeChange,value:this.state.intersectingAssetShape},"esriGeometryPoint"===this.props.layerGeometryType&&C.map(((s,i)=>{const a=c(62560)(`./${s.value}.svg`);return(0,e.jsx)(t.Option,{role:"option","aria-label":s,key:i,value:s.value,title:this.nls(s.label)},(0,e.jsx)(t.Icon,{size:12,icon:a}))})),"esriGeometryPolyline"===this.props.layerGeometryType&&j.map(((s,i)=>{const a=c(62560)(`./${s.value}.svg`);return(0,e.jsx)(t.Option,{role:"option","aria-label":s,key:i,value:s.value,title:this.nls(s.label)},(0,e.jsx)(t.Icon,{width:60,height:12,icon:a}))}))),(0,e.jsx)(t.NumericInput,{"aria-label":this.nls("styleSize"),size:"sm",className:"ml-2",min:1,max:20,defaultValue:this.state.intersectingAssetSize,onChange:this.onIntersectingAssetSizeChange})))}}const{epConfigIcon:Q}=v();class ee extends e.React.PureComponent{constructor(e){super(e),this.defaultSelectedItem={name:""},this.nls=e=>{const s=Object.assign({},o,t.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.onElevationValueChange=e=>{this.setState({elevationType:e.target.value},(()=>{this.props.updateAssetSettings("elevationSettings","type",this.state.elevationType)}))},this.onElevationValueUnitChange=e=>{this.setState({elevationUnits:e.target.value},(()=>{this.props.updateAssetSettings("elevationSettings","unit",this.state.elevationUnits)}))},this.onSymbologyChange=e=>{"map"===e.target.value?this.setState({isIntersectingAssetStylePickerOpen:!1}):this.setState({isIntersectingAssetStylePickerOpen:!0}),this.setState({symbology:e.target.value},(()=>{this.props.updateAssetSettings("style","type",this.state.symbology)}))},this.onIntersectingAssetStyleChange=(e,t,s)=>{this.props.updateAssetSettings(e,t,s)},this.onOneFieldSelect=e=>{0===e.length?(this.setState({oneFields:[]}),this.props.updateAssetSettings("elevationSettings","field1","")):(this.setState({oneFields:[e[0].jimuName]}),this.props.updateAssetSettings("elevationSettings","field1",e[0].jimuName))},this.onTwoFieldSelect=e=>{0===e.length?(this.setState({twoFields:[]}),this.props.updateAssetSettings("elevationSettings","field2","")):(this.setState({twoFields:[e[0].jimuName]}),this.props.updateAssetSettings("elevationSettings","field2",e[0].jimuName))},this.onDisplayFieldSelect=e=>{0===e.length?(this.setState({displayField:[]}),this.props.updateAssetSettings("displayField","","")):(this.setState({displayField:[e[0].jimuName]}),this.props.updateAssetSettings("displayField","",e[0].jimuName))},this.props.hasSupportForZValue?this.elevationTypeOptions=S:this.elevationTypeOptions=y,this.defaultSelectedItem.name=this.nls("noSelectionItemLabel");let s=!1;"map"!==this.props.config.style.type&&(s=!0),this.state={isIntersectingAssetStylePickerOpen:s,oneFields:""===this.props.config.elevationSettings.field1?[]:[this.props.config.elevationSettings.field1],twoFields:""===this.props.config.elevationSettings.field2?[]:[this.props.config.elevationSettings.field2],displayField:""===this.props.config.displayField?[]:[this.props.config.displayField],elevationType:this.props.config.elevationSettings.type,elevationUnits:this.props.config.elevationSettings.unit,symbology:this.props.config.style.type}}render(){var i;let a;"no elevation"===this.state.elevationType?a=this.nls("noElevationHint"):"z"===this.state.elevationType&&(a=this.nls("noVerticalParamHint"));const l=null===(i=this.props.selectedLayerDataSource)||void 0===i?void 0:i.layer.layerDefinition.geometryType;return(0,e.jsx)("div",{style:{height:"100%",width:"100%"},css:p(this.props.theme)},(0,e.jsx)(s.SettingSection,null,(0,e.jsx)(s.SettingRow,{className:"pt-1"},(0,e.jsx)(t.Label,{tabIndex:0,"aria-label":this.nls("elevationSettingLabel"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break color-label setting-text-level-1"},this.nls("elevationSettingLabel"))),(0,e.jsx)(t.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("elevationSettingIntersectingTooltip"),title:this.nls("elevationSettingIntersectingTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"ml-2 d-inline"},(0,e.jsx)(t.Icon,{size:14,icon:Q.infoIcon})))),(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(t.Label,{tabIndex:0,"aria-label":this.nls("valueType"),className:"flex-grow-1 ep-label"},(0,e.jsx)("div",{className:"flex-grow-1 text-break setting-text-level-3"},this.nls("valueType"))),(0,e.jsx)(t.Select,{menuRole:"menu","aria-label":this.state.elevationType,className:"selectOption",size:"sm",name:"elevationValueType",value:this.state.elevationType,onChange:this.onElevationValueChange},this.elevationTypeOptions.map(((s,i)=>(0,e.jsx)(t.Option,{role:"option","aria-label":s.value,key:i,value:s.value},this.nls(s.name)))))),(0,e.jsx)(s.SettingRow,{className:"one"===this.state.elevationType||"two"===this.state.elevationType?"":"hidden"},(0,e.jsx)("div",{className:"left-and-right d-flex justify-content-between w-100"},(0,e.jsx)(t.Label,{tabIndex:0,"aria-label":this.nls("oneFieldLabel"),className:"flex-grow-1 ep-label"},(0,e.jsx)("div",{className:"flex-grow-1 text-break setting-text-level-3"},this.nls("oneFieldLabel"))),(0,e.jsx)(T.FieldSelector,{className:"fieldSelectorWidth",dataSources:[this.props.selectedLayerDataSource.layer],isSearchInputHidden:!0,onChange:this.onOneFieldSelect.bind(this),isDataSourceDropDownHidden:!0,useDropdown:!0,selectedFields:(0,e.Immutable)(this.state.oneFields),isMultiple:!1,types:(0,e.Immutable)([e.JimuFieldType.Number]),noSelectionItem:this.defaultSelectedItem}))),(0,e.jsx)(s.SettingRow,{className:"two"===this.state.elevationType?"":"hidden"},(0,e.jsx)("div",{className:"left-and-right d-flex justify-content-between w-100"},(0,e.jsx)(t.Label,{tabIndex:0,"aria-label":this.nls("twoFieldLabel"),className:"flex-grow-1 ep-label"},(0,e.jsx)("div",{className:"flex-grow-1 text-break setting-text-level-3"},this.nls("twoFieldLabel"))),(0,e.jsx)(T.FieldSelector,{className:"fieldSelectorWidth",dataSources:[this.props.selectedLayerDataSource.layer],isSearchInputHidden:!0,onChange:this.onTwoFieldSelect.bind(this),isDataSourceDropDownHidden:!0,useDropdown:!0,selectedFields:(0,e.Immutable)(this.state.twoFields),types:(0,e.Immutable)([e.JimuFieldType.Number]),isMultiple:!1,noSelectionItem:this.defaultSelectedItem}))),(0,e.jsx)(s.SettingRow,{className:"no elevation"===this.state.elevationType||"z"===this.state.elevationType&&!this.props.hasVerticalUnit?"hint":"hidden"},(0,e.jsx)(t.Label,{tabIndex:0,"aria-label":a,className:"w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break setting-text-level-3"},a))),(0,e.jsx)(s.SettingRow,{className:"no elevation"===this.state.elevationType||"z"===this.state.elevationType?"hidden":""},(0,e.jsx)(t.Label,{tabIndex:0,"aria-label":this.nls("valueUnit"),className:"flex-grow-1 ep-label"},(0,e.jsx)("div",{className:"flex-grow-1 text-break setting-text-level-3"},this.nls("valueUnit"))),(0,e.jsx)(t.Select,{menuRole:"menu","aria-label":this.state.elevationUnits,className:"selectOption",name:"valueunit",size:"sm",value:this.state.elevationUnits,onChange:this.onElevationValueUnitChange},f.map(((s,i)=>(0,e.jsx)(t.Option,{role:"option","aria-label":s.value,key:i,value:s.value},this.nls(s.value)))))),(0,e.jsx)(s.SettingRow,{className:"pt-3 ep-divider-top"},(0,e.jsx)(t.Label,{tabIndex:0,"aria-label":this.nls("styleLabel"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break color-label setting-text-level-1"},this.nls("displayFieldLabel"))),(0,e.jsx)(t.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("displayFieldTooltip"),title:this.nls("displayFieldTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"ml-2 d-inline"},(0,e.jsx)(t.Icon,{size:14,icon:Q.infoIcon})))),(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(T.FieldSelector,{dataSources:[this.props.selectedLayerDataSource.layer],isSearchInputHidden:!0,onChange:this.onDisplayFieldSelect.bind(this),isDataSourceDropDownHidden:!0,useDropdown:!0,selectedFields:(0,e.Immutable)(this.state.displayField),isMultiple:!1,noSelectionItem:this.defaultSelectedItem})),(0,e.jsx)(s.SettingRow,{className:"pt-3 ep-divider-top"},(0,e.jsx)(t.Label,{tabIndex:0,"aria-label":this.nls("styleLabel"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break color-label setting-text-level-1"},this.nls("styleLabel"))),(0,e.jsx)(t.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("stylePointTooltip"),title:this.nls("stylePointTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"ml-2 d-inline"},(0,e.jsx)(t.Icon,{size:14,icon:Q.infoIcon})))),(0,e.jsx)(s.SettingRow,{className:"hidden"},(0,e.jsx)(t.Label,{tabIndex:0,"aria-label":this.nls("symbology"),className:"flex-grow-1 ep-label"},(0,e.jsx)("div",{className:"flex-grow-1 text-break setting-text-level-3"},this.nls("symbology"))),(0,e.jsx)(t.Select,{menuRole:"menu","aria-label":this.state.symbology,className:"selectOption",size:"sm",name:"symbology",value:this.state.symbology,onChange:this.onSymbologyChange},b.map(((s,i)=>(0,e.jsx)(t.Option,{role:"option","aria-label":s.value,key:i,value:s.value},this.nls(s.name)))))),(0,e.jsx)(X,{intl:this.props.intl,intersectingAssetItem:"style",config:this.props.config.style,layerGeometryType:l,onIntersectingAssetStyleChange:this.onIntersectingAssetStyleChange})))}}var te=c(58290);const{epConfigIcon:se}=v(),ie=(0,e.getAppStore)().getState().portalSelf,ae={tags:["semi-opaque"],title:"Orange",style:"esriSFSSolid",color:[239,132,38,128],name:"Orange 1",type:"esriSFS",outline:{style:"esriSLSSolid",color:[184,115,59,255],width:1.5,type:"esriSLS"}};class le extends e.React.PureComponent{constructor(s){var i,a,n,r,p;super(s),this.supportedDsTypes=(0,e.Immutable)([T.AllDataSourceTypes.FeatureLayer,T.AllDataSourceTypes.SceneLayer]),this.mvManager=l.MapViewManager.getInstance(),this.selectedLayerDataSource=null,this.layerSidePopperTrigger=e.React.createRef(),this.backRef=e.React.createRef(),this.allSelectedLayers=[],this.jsonUtils=null,this.nls=e=>{const s=Object.assign({},o,t.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidMount=()=>{var e,t,s,i;this.state.apiLoaded||(0,l.loadArcGISJSAPIModules)(["esri/symbols/support/jsonUtils"]).then((e=>{var t,s;[this.jsonUtils]=e,this.setState({apiLoaded:!0,bufferSymbol:(null===(t=this.props.config.assetIntersectingBuffer)||void 0===t?void 0:t.bufferSymbol)?this.jsonUtils.fromJSON(null===(s=this.props.config.assetIntersectingBuffer)||void 0===s?void 0:s.bufferSymbol):this.jsonUtils.fromJSON(ae)},(()=>{var e;this.props.onAssetBufferSettingsUpdated("bufferSymbol",null===(e=this.state.bufferSymbol)||void 0===e?void 0:e.toJSON())}))})),0===(null===(t=null===(e=this.props.config)||void 0===e?void 0:e.layers)||void 0===t?void 0:t.length)?this.setState({selectedLayers:[]}):null===(i=null===(s=this.props.config)||void 0===s?void 0:s.layers)||void 0===i||i.forEach((e=>{this.getLayerListProperty(e.layerId),this.setState({selectedLayers:this.allSelectedLayers})}))},this.getLayerListProperty=t=>{const s=e.DataSourceManager.getInstance().getDataSource(t);if(s){const e={label:s.getLabel(),layer:{id:s.id}};this.allSelectedLayers.push(e)}},this.getDsRootIdsByWidgetId=()=>{var t,s;const i=[],a=(null===(s=null===(t=(0,e.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===s?void 0:s.appConfig).dataSources[this.props.activeDataSource];return(null==a?void 0:a.type)!==l.ArcGISDataSourceTypes.WebMap&&(null==a?void 0:a.type)!==l.ArcGISDataSourceTypes.WebScene||i.push(this.props.activeDataSource),i.length>0?(0,e.Immutable)(i):void 0},this.dataSourceChangeSave=e=>{var t;if(!e)return;let s=!1;if(this.allSelectedLayers.some((t=>{if(t.layer.id===e[0].dataSourceId)return s=!0,this.setState({isAlertMsgPopupOpen:!0}),!0})),!s){let s;e.forEach(((e,t)=>{this.getLayerListProperty(e.dataSourceId)})),this.setState({selectedLayers:this.allSelectedLayers},(()=>{setTimeout((()=>{this.layerSidePopperTrigger.current.focus()}),50)})),this.updateLayersConfig=this.getLayersDefaultSettings(this.allSelectedLayers),s=(null===(t=this.props.config)||void 0===t?void 0:t.layers)?[...this.props.config.layers,this.updateLayersConfig[0]]:[this.updateLayersConfig[0]],this.props.onAssetSettingsUpdated("assetSettings",this.props.activeDataSource,null,null,s,!0)}},this.getLayersDefaultSettings=e=>{var t,s;let i=[];return 0===(null===(s=null===(t=this.props.config)||void 0===t?void 0:t.layers)||void 0===s?void 0:s.length)?e.forEach(((e,t)=>{i=this.getAssetDefaultConfigOnAdd(e.layer)})):e.forEach((e=>{this.isLayerAlreadyConfigured(e.layer.id)||(i=this.getAssetDefaultConfigOnAdd(e.layer))})),i},this.isLayerAlreadyConfigured=e=>{var t,s;let i=!1;return null===(s=null===(t=this.props.config)||void 0===t?void 0:t.layers)||void 0===s||s.forEach((t=>{if(e===t.layerId)return i=!0,!0})),i},this.showLayerData=(t,s)=>{var i,a,l,o;this.setState({showLayerDataItemPanel:!0,layerName:t.label},(()=>{var e;null===(e=this.backRef.current)||void 0===e||e.backRefFocus()}));const n=e.DataSourceManager.getInstance().getDataSource(t.layer.id);this.selectedLayerDataSource={dataSourceId:n.id,rootDataSourceId:n.parentDataSource.id,layer:n},this.selectedLayerConfig=this.getSelectedLayerConfig(n.id);const r=this.mapView.view.map.findLayerById(n.jimuChildId);this.hasSupportForZValue=r.hasZ,this.hasVerticalUnitParam=(null===(a=null===(i=null==r?void 0:r.sourceJSON)||void 0===i?void 0:i.sourceSpatialReference)||void 0===a?void 0:a.vcsWkid)||(null===(o=null===(l=r.sourceJSON)||void 0===l?void 0:l.sourceSpatialReference)||void 0===o?void 0:o.vcsWkt)},this.getSelectedLayerConfig=e=>{let t;return this.props.config.layers.forEach((s=>{e===s.layerId&&(t=s)})),t},this.removeLayerDataItem=(e,t,s)=>{var i,a;e.stopPropagation();const l=this.state.selectedLayers;l.splice(t,1),this.allSelectedLayers=l,this.setState({selectedLayers:this.allSelectedLayers},(()=>{this.layerSidePopperTrigger.current.focus()})),null===(a=null===(i=this.props.config)||void 0===i?void 0:i.layers)||void 0===a||a.forEach(((e,t)=>{if(e.layerId===s){const e=this.props.config.layers.asMutable({deep:!0});e.splice(t,1),this.updateLayersConfig=e,this.props.onAssetSettingsUpdated("assetSettings",this.props.activeDataSource,null,null,this.updateLayersConfig,!0)}}))},this.createLayerElement=(s,i)=>(0,e.jsx)("div",{ref:this.layerSidePopperTrigger,"aria-label":s.label,tabIndex:0,key:i+Date.now(),className:"layer-data-item align-items-center"},(0,e.jsx)("div",{className:"layer-data-item-name flex-grow-1",title:s.label},s.label),(0,e.jsx)(t.Button,{role:"button",title:this.nls("deleteLayer"),"aria-label":this.nls("deleteLayer"),size:"sm",type:"tertiary",icon:!0,className:"p-0",key:i+Date.now(),onClick:e=>{this.removeLayerDataItem(e,i,s.layer.id)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.removeLayerDataItem(e,i,s.layer.id)}},(0,e.jsx)(t.Icon,{icon:se.iconClose,size:12}))),this.getLayerIndex=e=>{let t=-1;return this.props.config.layers.forEach(((s,i)=>{e===s.layerId&&(t=i)})),t},this.updateConfig=(e,t,s)=>{const i={parentKey:e,childKey:t,value:s},a=this.getLayerIndex(this.selectedLayerConfig.layerId);this.props.onAssetSettingsUpdated("assetSettings",this.props.activeDataSource,a,i,null,!1)},this.backForwardPanel=()=>{this.setState({showLayerDataItemPanel:!1},(()=>{this.layerSidePopperTrigger.current.focus()}))},this.closePanel=()=>{this.setState({showLayerDataItemPanel:!1},(()=>{this.layerSidePopperTrigger.current.focus()})),this.index=0},this.onIntersectingBufferChange=e=>{this.props.onAssetBufferSettingsUpdated("enabled",e.currentTarget.checked)},this.onBufferDistanceChange=e=>{this.setState({bufferDistanceInput:null!=e?e:0},(()=>{this.props.onAssetBufferSettingsUpdated("bufferDistance",this.state.bufferDistanceInput)}))},this.onBufferUnitsChange=e=>{const t=((e,t)=>{const s=F(t);return e>s?s:e})(this.state.bufferDistanceInput,e.target.value);this.props.onAssetBufferSettingsUpdated("bufferDistance",t),this.setState({bufferUnit:e.target.value,bufferDistanceInput:t},(()=>{setTimeout((()=>{this.props.onAssetBufferSettingsUpdated("bufferUnits",this.state.bufferUnit)}),50)}))},this.onBufferSymbolChanged=e=>{let t=e;null===e&&(t=this.jsonUtils.fromJSON(ae)),this.setState({bufferSymbol:t},(()=>{this.props.onAssetBufferSettingsUpdated("bufferSymbol",null==t?void 0:t.toJSON())}))},this.disableSelection=e=>!1,this.hideMessage=()=>{this.setState({isAlertMsgPopupOpen:!1})},this.index=0,this.updateLayersConfig=this.props.config.layers;const h=this.mvManager.jimuMapViewGroups[this.props.mapWidgetId];for(const e in h.jimuMapViews)h.jimuMapViews[e].dataSourceId===this.props.activeDataSource&&(this.mapView=h.jimuMapViews[e]);let c;(null===(i=this.props.config.assetIntersectingBuffer)||void 0===i?void 0:i.hasOwnProperty("bufferUnits"))?(c=null===(a=this.props.config.assetIntersectingBuffer)||void 0===a?void 0:a.bufferUnits,""===(null===(n=this.props.config.assetIntersectingBuffer)||void 0===n?void 0:n.bufferUnits)&&(c=V(ie))):c=V(ie),this.state={selectedLayers:[],showLayerDataItemPanel:!1,layerName:null,bufferDistanceInput:(null===(r=this.props.config.assetIntersectingBuffer)||void 0===r?void 0:r.bufferDistance)?null===(p=this.props.config.assetIntersectingBuffer)||void 0===p?void 0:p.bufferDistance:10,bufferUnit:c,bufferSymbol:null,isAlertMsgPopupOpen:!1,apiLoaded:!1}}getAssetDefaultConfigOnAdd(t){const s=e.DataSourceManager.getInstance().getDataSource(t.id),i=U(this.props.activeDsConfig,ie),a=[];if(s&&s.layerDefinition&&s.layerDefinition.geometryType&&("esriGeometryPolyline"===s.layerDefinition.geometryType||"esriGeometryPoint"===s.layerDefinition.geometryType)){let t="no elevation";s.layerDefinition.hasZ&&(t="z");const l=Object.assign({},L);l.style.intersectingAssetColor=E(),l.elevationSettings.unit=i[0],l.layerId=s.id,l.elevationSettings.type=t,a.push((0,e.Immutable)(l))}return a}render(){var i,l,o,n;const r=e.DataSourceManager.getInstance().getDataSource(this.props.activeDataSource),c=null==r?void 0:r.getChildDataSources(),d=[];null==c||c.forEach((e=>{var t,s;if("GROUP_LAYER"===e.type){const t=e.getChildDataSources();t&&t.forEach((e=>{var t,s;"esriGeometryPolyline"!==(null===(t=e.layerDefinition)||void 0===t?void 0:t.geometryType)&&"esriGeometryPoint"!==(null===(s=e.layerDefinition)||void 0===s?void 0:s.geometryType)||d.push(e.id)}))}else"esriGeometryPolyline"!==(null===(t=e.layerDefinition)||void 0===t?void 0:t.geometryType)&&"esriGeometryPoint"!==(null===(s=e.layerDefinition)||void 0===s?void 0:s.geometryType)||d.push(e.id)}));const g={fromRootDsIds:this.getDsRootIdsByWidgetId(),fromDsIds:(0,e.Immutable)(d)};return(0,e.jsx)("div",{css:p(this.props.theme),style:{height:"100%",width:"100%",marginTop:5}},(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(t.Label,{tabIndex:0,"aria-label":this.nls("intersectingLayersLabel"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break color-label"},this.nls("intersectingLayersLabel"))),(0,e.jsx)(t.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("intersectingLayersTooltip"),title:this.nls("intersectingLayersTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"ml-2 d-inline color-label"},(0,e.jsx)(t.Icon,{size:14,icon:se.infoIcon})))),(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(T.DataSourceSelector,{className:"ep-data-source-selector",types:this.supportedDsTypes,buttonLabel:this.nls("selectableButton"),fromRootDsIds:g.fromRootDsIds,fromDsIds:g.fromDsIds,mustUseDataSource:!0,onChange:this.dataSourceChangeSave,disableDataView:!0,enableToSelectOutputDsFromSelf:!1,closeDataSourceListOnChange:!0,hideTypeDropdown:!1,hideAddDataButton:!0,disableRemove:()=>!0,disableSelection:this.disableSelection,widgetId:this.props.widgetId,hideDataView:!0})),0===this.state.selectedLayers.length&&(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(t.Label,{tabIndex:0,"aria-label":this.nls("intersectingLayersWarning"),className:"hint w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break setting-text-level-3"},this.nls("intersectingLayersWarning")))),(0,e.jsx)(s.SettingRow,{className:this.state.selectedLayers.length>0?"":"hidden"},(0,e.jsx)(a.List,{className:"ep-layers-list",itemsJson:Array.from(this.state.selectedLayers).map(((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`}))),dndEnabled:!1,onClickItemBody:(e,t)=>{const{itemJsons:s}=t.props,i=s[0],a=s[1];this.showLayerData(i.itemStateDetailContent,a.indexOf(i))},overrideItemBlockInfo:()=>({name:a.TreeItemActionType.RenderOverrideItem,children:[{name:a.TreeItemActionType.RenderOverrideItemBody,children:[{name:a.TreeItemActionType.RenderOverrideItemMainLine}]}]}),renderOverrideItemMainLine:(e,t)=>{const{itemJsons:s}=t.props,i=s[0],a=s[1];return this.createLayerElement(i.itemStateDetailContent,a.indexOf(i))}})),(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(t.Label,{className:"w-100 d-flex cursor-pointer"},(0,e.jsx)(t.Checkbox,{className:"mr-2 font-13",checked:null===(i=this.props.config.assetIntersectingBuffer)||void 0===i?void 0:i.enabled,onChange:this.onIntersectingBufferChange,role:"checkbox","aria-label":this.nls("intersectingBufferSettingsLabel")}),(0,e.jsx)("div",{className:"flex-grow-1 text-break"},this.nls("intersectingBufferSettingsLabel"))),(0,e.jsx)(t.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("intersectingBufferSettingsTooltip"),title:this.nls("intersectingBufferSettingsTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"ml-2 d-inline"},(0,e.jsx)(t.Icon,{size:14,icon:se.infoIcon})))),(null===(l=this.props.config.assetIntersectingBuffer)||void 0===l?void 0:l.enabled)&&(0,e.jsx)("div",{className:"pt-2 pb-2","aria-expanded":null===(o=this.props.config.assetIntersectingBuffer)||void 0===o?void 0:o.enabled},(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(t.NumericInput,{style:{width:55},"aria-label":this.state.bufferUnit,title:this.state.bufferDistanceInput+"",size:"sm",defaultValue:this.state.bufferDistanceInput,min:0,max:F(this.state.bufferUnit),value:this.state.bufferDistanceInput,showHandlers:!1,onChange:this.onBufferDistanceChange}),(0,e.jsx)(t.Select,{menuRole:"menu","aria-label":this.state.bufferUnit,style:{width:141},className:"pl-2 pr-2",size:"sm",name:"bufferUnits",value:this.state.bufferUnit,onChange:this.onBufferUnitsChange},f.map(((s,i)=>(0,e.jsx)(t.Option,{role:"option","aria-label":s.value,key:i,value:s.value},this.nls(s.value))))),this.state.bufferSymbol&&(0,e.jsx)(te.SymbolSelector,{jimuSymbolType:te.JimuSymbolType.Polygon,symbol:this.state.bufferSymbol,onPolygonSymbolChanged:this.onBufferSymbolChanged.bind(this)}))),(0,e.jsx)(s.SidePopper,{isOpen:this.state.showLayerDataItemPanel&&!e.urlUtils.getAppIdPageIdFromUrl().pageId,position:"right",toggle:this.closePanel,trigger:null===(n=this.layerSidePopperTrigger)||void 0===n?void 0:n.current},(0,e.jsx)("div",{className:"bg-light-300 border-color-gray-400",css:h(this.props.theme)},(0,e.jsx)(O,{theme:this.props.theme,intl:this.props.intl,title:this.state.layerName,ref:this.backRef,onBack:this.backForwardPanel,onClose:this.closePanel},(0,e.jsx)("div",{className:"setting-container"},(0,e.jsx)(ee,{intl:this.props.intl,theme:this.props.theme,config:this.selectedLayerConfig,hasSupportForZValue:this.hasSupportForZValue,selectedLayerDataSource:this.selectedLayerDataSource,hasVerticalUnit:this.hasVerticalUnitParam,updateAssetSettings:this.updateConfig.bind(this)}))))),this.state.isAlertMsgPopupOpen&&(0,e.jsx)(t.AlertPopup,{"aria-expanded":this.state.isAlertMsgPopupOpen,hideCancel:!0,isOpen:this.state.isAlertMsgPopupOpen&&!e.urlUtils.getAppIdPageIdFromUrl().pageId,onClickOk:this.hideMessage.bind(this),onClickClose:this.hideMessage.bind(this),title:this.nls("alert")},(0,e.jsx)("div",{className:"p-2"},this.nls("alreadySelectedLayerMsg"))))}}const{epConfigIcon:oe}=v();class ne extends i.BaseWidgetSetting{constructor(s){var i;super(s),this.mvManager=l.MapViewManager.getInstance(),this.dataSourceOptions=[],this.groundData=[],this._mapLoadedTimer=null,this._mapViewGroupLoad=null,this.sidePopperTrigger=e.React.createRef(),this.sidePopperDsHeader=e.React.createRef(),this.dsRef=e.React.createRef(),this.componentDidMount=()=>{var t,s;let i;if(this.props.useMapWidgetIds&&this.props.useMapWidgetIds.length>0){const a=null===(t=this.props.useMapWidgetIds)||void 0===t?void 0:t[0];if(null===(s=(0,e.getAppStore)().getState().appStateInBuilder.appConfig.widgets)||void 0===s?void 0:s[a]){i=!1;const e=[this.getInitOutDataSource()];setTimeout((()=>{this.props.onSettingChange({id:this.props.id,useDataSources:[]},e)}),100),this.createStatistics(),this.getAvailableDataSources(this.props.useMapWidgetIds)}else this.resetConfig(),i=!0}else i=!0;this.updateConfigForMapWidget(i)},this.componentDidUpdate=e=>{if(e.label!==this.props.label){const e=[this.getInitOutDataSource()];setTimeout((()=>{this.props.onSettingChange({id:this.props.id,useDataSources:[]},e)}),100)}},this.nls=s=>{const i=Object.assign({},o,t.defaultMessages,e.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:s,defaultMessage:i[s]}):i[s]},this.updateConfigForMapWidget=e=>{setTimeout((()=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("useMapWidget",!e)})}),50),this.setState({mapWidgetExists:!e,isNoMapSelected:e})},this.onMapWidgetSelected=e=>{this.resetConfig();const t=[this.getInitOutDataSource()];let s;setTimeout((()=>{this.props.onSettingChange({id:this.props.id,useDataSources:[]},t),this.props.onSettingChange({id:this.props.id,useMapWidgetIds:e})}),100),e.length>0?(s=!1,this.createStatistics(),this.getAvailableDataSources(e)):s=!0,this.updateConfigForMapWidget(s)},this.createStatistics=()=>{const e=[];x.forEach((t=>{const s={name:t.value,label:this.nls(t.value),enabled:!0};e.push(s)})),e.sort(((e,t)=>e.label.localeCompare(t.label))),this.setState({availableStats:e})},this.resetConfig=()=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("configInfo",{})})},this.getConfigForSelectedDs=(e,t)=>{if(!this.props.config.configInfo.hasOwnProperty(e)){const t=w;t.profileChartSettings.isCustomElevationLayer=this.state.isUseCustomElevationLayer;let s="https://elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer";this.state.isUseCustomElevationLayer||(s=this.state.useElevationLayer),t.profileChartSettings.elevationLayerURL=s,t.profileChartSettings.selectedStatistics=this.state.availableStats,t.profileChartSettings.volumetricObjLabel=this.nls("volumetricObjectsLabel"),t.profileSettings.layers="default"!==this.state.activeDataSource?this.populateDefaultProfileSettings(e):[],this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["configInfo",e],t)})}},this.getInitOutDataSource=()=>{const s=Object.assign({},t.defaultMessages),i=this.props.intl.formatMessage({id:"outputStatistics",defaultMessage:s.outputStatistics},{name:this.props.label}),a=`${this.props.widgetId}-output`,l=this.getInitSchema(i);return{id:a,type:e.DataSourceTypes.FeatureLayer,label:i,originDataSources:[],isOutputFromWidget:!0,isDataInDataSourceInstance:!1,schema:l,geometryType:"esriGeometryPoint"}},this.getInitSchema=(t="")=>{const s={},i=[];i.push({alias:"OBJECTID",type:e.JimuFieldType.Number,jimuName:"OBJECTID",name:"OBJECTID"}),x.forEach((t=>{i.push({alias:this.nls(t.value).replace(/ /g,""),type:e.JimuFieldType.String,jimuName:this.nls(t.value).replace(/ /g,""),name:this.nls(t.value).replace(/ /g,"")})}));const a={alias:"OBJECTID",type:e.JimuFieldType.Number,jimuName:"OBJECTID",name:"OBJECTID"};return null==i||i.forEach(((e,t)=>{s[null==e?void 0:e.jimuName]=e,0===t&&(s.OBJECTID=a)})),{label:t,idField:"OBJECTID",fields:s}},this.populateDefaultProfileSettings=t=>{const s=[],i=k(t),a=U(this.props.config.configInfo[t],this.props.portalSelf);return null==i||i.forEach((t=>{var i,l,o;if(t&&t.layerDefinition&&t.layerDefinition.geometryType&&"esriGeometryPolyline"===t.layerDefinition.geometryType){let n="no elevation";t.layerDefinition.hasZ&&(n="z");const r=Object.assign({},I);(null===(i=null==t?void 0:t.layerDefinition)||void 0===i?void 0:i.hasGeometryProperties)&&(null===(o=null===(l=null==t?void 0:t.layerDefinition)||void 0===l?void 0:l.geometryProperties)||void 0===o?void 0:o.shapeLengthFieldName)&&(r.distanceSettings.field=t.layerDefinition.geometryProperties.shapeLengthFieldName);const p=Object.assign({},r);p.layerId=t.id,p.elevationSettings.type=n,p.elevationSettings.unit=a[0],p.distanceSettings.unit=a[1],p.style.lineColor=E(),s.push((0,e.Immutable)(p))}})),s},this.getDataSourceLabel=t=>t?e.DataSourceManager.getInstance().getDataSource(t).getLabel()||t:"",this.updateConfigAsPerNewWebMap=()=>{var t,s;const i=[];if(this.props.useMapWidgetIds&&this.props.useMapWidgetIds.length>0){const a=this.getMapViewGroupInstance(this.props.useMapWidgetIds[0]),l=a[0],o=a[1];let n=this.props.config.configInfo.asMutable({deep:!0});if(l&&l.jimuMapViews)for(const e in l.jimuMapViews)l.jimuMapViews[e].dataSourceId?i.push(l.jimuMapViews[e].dataSourceId):i.push("default");if(2!==(null===(s=null===(t=null==o?void 0:o.props)||void 0===t?void 0:t.useDataSources)||void 0===s?void 0:s.length))for(const e in n)"useMapWidgetIds"===e||"activeDataSource"===e||i.includes(e)?n=this.updateLayersFromConfig(e,n):delete n[e];this.props.onSettingChange({id:this.props.id,config:this.props.config.set("configInfo",(0,e.Immutable)(n))})}},this.updateLayersFromConfig=(e,t)=>{var s,i,a,l;const o=[],n=[],r=[],p=[],h=k(e);return null==h||h.forEach((e=>{e&&e.layerDefinition&&e.layerDefinition.geometryType&&("esriGeometryPoint"===e.layerDefinition.geometryType?o.push(e.id):"esriGeometryPolyline"===e.layerDefinition.geometryType&&n.push(e.id))})),null===(i=null===(s=this.props.config.configInfo[e].profileSettings)||void 0===s?void 0:s.layers)||void 0===i||i.forEach(((s,i)=>{n.includes(s.layerId)?p.push(s.layerId):t[e].profileSettings.layers.splice(i,1)})),null===(l=null===(a=this.props.config.configInfo[e].assetSettings)||void 0===a?void 0:a.layers)||void 0===l||l.forEach(((s,i)=>{o.includes(s.layerId)||n.includes(s.layerId)?r.push(s.layerId):t[e].assetSettings.layers.splice(i,1)})),t},this.getMapViewGroupInstance=e=>{var t,s,i,a,l;const o=this.mvManager.getJimuMapViewGroup(e);let n=o,r=null==n?void 0:n.mapWidgetInstance;if(this._mapViewGroupLoad&&clearInterval(this._mapViewGroupLoad),o){const e=o.mapWidgetId+"-"+(null===(s=null===(t=r.props.useDataSources)||void 0===t?void 0:t[0])||void 0===s?void 0:s.dataSourceId),p=o.mapWidgetId+"-"+(null===(a=null===(i=r.props.useDataSources)||void 0===i?void 0:i[1])||void 0===a?void 0:a.dataSourceId);2===(null===(l=r.props.useDataSources)||void 0===l?void 0:l.length)&&(o.jimuMapViews.hasOwnProperty(e)&&o.jimuMapViews.hasOwnProperty(p)?(n=o,r=n.mapWidgetInstance):this._mapViewGroupLoad=setTimeout((()=>{this.getAvailableDataSources(this.props.useMapWidgetIds)}),50))}return[n,r]},this.getAvailableDataSources=t=>{let s="";this.dataSourceOptions=[],this.groundData=[],this.dataSourceOptions.push({label:this.nls("defaultWebMap"),value:"default"}),this._mapViewGroupLoad&&clearInterval(this._mapViewGroupLoad);const i=this.getMapViewGroupInstance(t)[0];if(i&&i.jimuMapViews){this._mapLoadedTimer&&clearInterval(this._mapLoadedTimer);for(const e in i.jimuMapViews)this.mapView=i.jimuMapViews[e];(r=this.mapView,a=void 0,l=void 0,o=void 0,n=function*(){yield null==r?void 0:r.whenAllJimuLayerViewLoaded();const t=e.DataSourceManager.getInstance().getDataSource(null==r?void 0:r.dataSourceId);return(null==t?void 0:t.isDataSourceSet)&&!t.areChildDataSourcesCreated()?t.childDataSourcesReady().then((()=>t)).catch((e=>t)):Promise.resolve(t)},new(o||(o=Promise))((function(e,t){function s(e){try{r(n.next(e))}catch(e){t(e)}}function i(e){try{r(n.throw(e))}catch(e){t(e)}}function r(t){var a;t.done?e(t.value):(a=t.value,a instanceof o?a:new o((function(e){e(a)}))).then(s,i)}r((n=n.apply(a,l||[])).next())}))).finally((()=>{var e,a;this.setState({showLoadingIndicator:!1});for(const a in i.jimuMapViews)if(i.jimuMapViews[a].dataSourceId){const l=i.jimuMapViews[a].view.map.ground.layers;let o=!1;if(l.length>0&&(o=!0),l.length>0){const t=i.jimuMapViews[a].view.map.ground.layers;s=null===(e=null==t?void 0:t.items[0])||void 0===e?void 0:e.url}this.groundData.push({dataSourceId:i.jimuMapViews[a].dataSourceId,isGroundElevationLayerExists:o,groundElevationLayerUrl:s}),setTimeout((()=>{this.setState({useElevationLayer:s,isUseCustomElevationLayer:!o},(()=>{this.getConfigForSelectedDs(i.jimuMapViews[a].dataSourceId,t),this.checkBackwardForAdvanceOption()}))}),50),(i.jimuMapViews[a].isActive||void 0===i.jimuMapViews[a].isActive)&&(setTimeout((()=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("activeDataSource",i.jimuMapViews[a].dataSourceId)})}),50),this.setState({activeDataSource:i.jimuMapViews[a].dataSourceId})),this.canAddDataSource(i.jimuMapViews[a].dataSourceId)&&this.dataSourceOptions.push({label:this.getDataSourceLabel(i.jimuMapViews[a].dataSourceId),value:i.jimuMapViews[a].dataSourceId})}if(this.dataSourceOptions.length>1)this.dataSourceOptions.forEach(((e,t)=>{e.label===this.nls("defaultWebMap")&&this.dataSourceOptions.splice(t,1)}));else if(i&&i.jimuMapViews)for(const e in i.jimuMapViews){let l=!1;if(i.jimuMapViews[e].view.map.ground.layers.length>0){const t=i.jimuMapViews[e].view.map.ground.layers;s=null===(a=null==t?void 0:t.items[0])||void 0===a?void 0:a.url,l=!0}setTimeout((()=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("activeDataSource","default")})}),50),this.groundData.push({dataSourceId:"default",isGroundElevationLayerExists:l,groundElevationLayerUrl:s}),this.setState({activeDataSource:"default",useElevationLayer:s,isUseCustomElevationLayer:!l},(()=>{this.getConfigForSelectedDs(this.state.activeDataSource,t)}))}this.setState({dataSources:this.dataSourceOptions}),this.updateConfigAsPerNewWebMap()}))}else this._mapLoadedTimer=setTimeout((()=>{this.getAvailableDataSources(t)}),50);var a,l,o,n,r},this.canAddDataSource=e=>{let t=!0;return this.dataSourceOptions.some((s=>{s.value===e&&(t=!1)})),t},this.checkBackwardForAdvanceOption=()=>{var e,t,s,i,a,l,o;if((null===(t=null===(e=this.props.config)||void 0===e?void 0:e.configInfo)||void 0===t?void 0:t[this.state.activeDataSource])&&(null===(i=null===(s=this.props.config)||void 0===s?void 0:s.configInfo)||void 0===i?void 0:i[this.state.activeDataSource].hasOwnProperty("advanceOptions"))){this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["configInfo",this.state.activeDataSource,"profileSettings","isProfileSettingsEnabled"],!0)});const e=null===(o=null===(l=null===(a=this.props.config)||void 0===a?void 0:a.configInfo)||void 0===l?void 0:l[this.state.activeDataSource])||void 0===o?void 0:o.advanceOptions;setTimeout((()=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["configInfo",this.state.activeDataSource,"profileSettings","isCustomizeOptionEnabled"],e)}),setTimeout((()=>{const e=this.props.config.configInfo[this.state.activeDataSource],t=Object.assign({},e);delete t.advanceOptions,this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["configInfo",this.state.activeDataSource],t)})}),50)}),50)}},this.updateAssetOrProfileLayersSettings=(t,s,i,a,l,o)=>{let n,r,p;if(o&&null===i)this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["configInfo",s,t,"layers"],(0,e.Immutable)(l))});else if(null!==i){r=this.props.config.configInfo[s][t].layers[i].asMutable({deep:!0}),a.childKey?r[a.parentKey][a.childKey]=a.value:r[a.parentKey]=a.value,p=this.props.config.configInfo[s][t].layers.asMutable({deep:!0}),p.splice(i,1,r),n=(0,e.Immutable)(p);const l=n.filter(((e,t)=>t===n.findIndex((t=>t.layerId===e.layerId))));this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["configInfo",s,t,"layers"],l)})}},this.showDsPanel=(e,t)=>{t===this.index?(this.setState({showDataItemPanel:!this.state.showDataItemPanel},(()=>{setTimeout((()=>{this.sidePopperDsHeader.current.focus()}),1e3)})),this.maintainStatesOnDsClick(e)):(this.setState({showDataItemPanel:!0},(()=>{setTimeout((()=>{this.sidePopperDsHeader.current.focus()}),1e3)})),this.maintainStatesOnDsClick(e),this.index=t),this.getConfigForSelectedDs(e.value,this.props.useMapWidgetIds)},this.maintainStatesOnDsClick=e=>{this.setState({dataSourceName:e.label,activeDataSource:e.value,isProfileChartSettingsOpen:!1})},this.createDsElement=(t,s)=>(0,e.jsx)("div",{ref:this.dsRef,tabIndex:0,"aria-label":t.label,key:s,className:"data-item align-items-center"},(0,e.jsx)("div",{className:"data-item-name",title:t.label},t.label)),this.onCloseDataItemPanel=()=>{this.setState({showDataItemPanel:!1},(()=>{var e,t;null===(t=null===(e=this.dsRef)||void 0===e?void 0:e.current)||void 0===t||t.focus()})),this.index=0},this.onToggleProfileChartSettings=()=>{this.setState({isProfileChartSettingsOpen:!this.state.isProfileChartSettingsOpen})},this.handleProfileRendering=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["configInfo",this.state.activeDataSource,"profileSettings","isCustomizeOptionEnabled"],e)})},this.profileSettingsChange=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["configInfo",this.state.activeDataSource,"profileSettings","isProfileSettingsEnabled"],e.target.checked)})},this.assetSettingsChange=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["configInfo",this.state.activeDataSource,"assetSettings","isAssetSettingsEnabled"],e.target.checked)})},this.updateAssetBufferSettings=(e,t)=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["configInfo",this.state.activeDataSource,"assetSettings","assetIntersectingBuffer",e],t)})},this.updateProfileChartSettings=(e,t)=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["configInfo",this.state.activeDataSource,"profileChartSettings",e],t)})},this.updateGeneralSettings=(e,t)=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["generalSettings",e],t)})},this.index=0,this.state={dataSources:[],showDataItemPanel:!1,dataSourceName:"",isProfileChartSettingsOpen:!1,activeDataSource:this.props.config.activeDataSource?this.props.config.activeDataSource:null,useElevationLayer:"",isUseCustomElevationLayer:!1,availableStats:[],isNoMapSelected:!0,mapWidgetExists:!0,showLoadingIndicator:!0},this.isRTL=!1;const a=(0,e.getAppStore)().getState();this.isRTL=null===(i=null==a?void 0:a.appContext)||void 0===i?void 0:i.isRTL}render(){var i,l,o,n,p,h,c,d,g,u,m,v,f,S;return(0,e.jsx)("div",{css:(S=this.props.theme,e.css`
    .widget-setting-elevation-profile {

      .map-selector-section .component-map-selector .form-control {
        width: 100%;
      }
      
      .hidden {
        display: none;
      }
      
      .jimu-tree {
        width: 100%;
      }

      .data-item {
        display: flex;
        flex: 1;
        padding: 0.5rem 0.6rem;
        line-height: 23px;
        cursor: pointer;

        .data-item-name {
          word-break: break-word;
        }
      }

      .warningMsg {
        padding: 0.25rem!important;
        margin-top: -7px;
      }

      .warningMsg .left-part {
        margin-right: 0 !important;
      }

      .color-label {
        color: ${S.colors.palette.dark[400]};
      }

      .ep-tooltip {
        margin-right: 0.30rem!important;
      }

      .ep-section-title {
        color: var(--dark-800);
      }

      .mapSettingsHint {
        color: var(--dark-500);
        font-size: ${e.polished.rem(13)};
      }
    }
  `)},(0,e.jsx)("div",{className:"widget-setting-elevation-profile"},(0,e.jsx)(s.SettingSection,{className:"map-selector-section",title:this.nls("sourceLabel")},(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(t.Label,{tabIndex:0,"aria-label":this.nls("selectMapWidgetLabel"),title:this.nls("selectMapWidgetLabel"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"text-truncate flex-grow-1 setting-text-level-3"},this.nls("selectMapWidgetLabel")))),(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(s.MapWidgetSelector,{onSelect:this.onMapWidgetSelected.bind(this),useMapWidgetIds:this.props.useMapWidgetIds})),this.state.isNoMapSelected&&(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(t.Alert,{tabIndex:0,className:"warningMsg",onClose:function(){},open:this.state.isNoMapSelected,text:this.nls("warningMsgToSelectMap"),type:"warning"}))),this.props.useMapWidgetIds&&this.props.useMapWidgetIds.length>0&&this.state.mapWidgetExists&&(0,e.jsx)("div",null,(0,e.jsx)(s.SettingSection,null,(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(t.Label,{tabIndex:0,"aria-label":this.nls("dataConfigLabel"),title:this.nls("dataConfigLabel"),className:"w-100 d-flex",style:{maxWidth:"88%"}},(0,e.jsx)("div",{className:"text-truncate flex-grow-1 color-label setting-text-level-1"},this.nls("dataConfigLabel")))),(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(t.Label,{tabIndex:0,"aria-label":this.nls("dataConfigTooltip"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break mapSettingsHint"},this.nls("dataConfigTooltip")))),(0,e.jsx)(s.SettingRow,null,this.state.showLoadingIndicator&&(0,e.jsx)(t.Loading,{type:t.LoadingType.Secondary}),!this.state.showLoadingIndicator&&(0,e.jsx)(a.List,{itemsJson:Array.from(this.state.dataSources).map(((e,t)=>({itemStateDetailContent:e,itemStateChecked:this.state.showDataItemPanel&&this.index===t,itemKey:`${t}`}))),dndEnabled:!1,onClickItemBody:(e,t)=>{const{itemJsons:s}=t.props,i=s[0],a=s[1];this.showDsPanel(i.itemStateDetailContent,a.indexOf(i))},overrideItemBlockInfo:()=>({name:a.TreeItemActionType.RenderOverrideItem,children:[{name:a.TreeItemActionType.RenderOverrideItemBody,children:[{name:a.TreeItemActionType.RenderOverrideItemMainLine}]}]}),renderOverrideItemMainLine:(e,t)=>{const{itemJsons:s}=t.props,i=s[0],a=s[1];return this.createDsElement(i.itemStateDetailContent,a.indexOf(i))}})),"default"===this.state.activeDataSource&&(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(t.Alert,{tabIndex:0,className:"warningMsg",onClose:function(){},open:"default"===this.state.activeDataSource,text:this.nls("warningMsgIfDefaultDs"),type:"warning"}))),this.state.activeDataSource&&(0,e.jsx)(s.SettingSection,null,(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(t.Label,{tabIndex:0,"aria-label":this.nls("generalSettingsLabel"),title:this.nls("generalSettingsLabel"),className:"w-100 d-flex",style:{maxWidth:"88%"}},(0,e.jsx)("div",{className:"text-truncate flex-grow-1 color-label setting-text-level-1"},this.nls("generalSettingsLabel")))),(0,e.jsx)(s.SettingRow,{flow:"wrap"},(0,e.jsx)(Y,{intl:this.props.intl,theme:this.props.theme,config:this.props.config.generalSettings,onGeneralSettingsUpdated:this.updateGeneralSettings})))),(0,e.jsx)(s.SidePopper,{isOpen:this.state.showDataItemPanel&&!e.urlUtils.getAppIdPageIdFromUrl().pageId,position:"right",toggle:this.onCloseDataItemPanel,trigger:null===(i=this.sidePopperTrigger)||void 0===i?void 0:i.current},(0,e.jsx)("div",{className:"w-100 h-100",css:r(this.props.theme)},(0,e.jsx)("div",{className:"w-100 h-100 layer-item-panel"},(0,e.jsx)("div",{tabIndex:0,ref:this.sidePopperDsHeader,className:"w-100 d-flex align-items-center justify-content-between setting-header setting-title"},(0,e.jsx)("h5",{title:this.state.dataSourceName,className:"text-truncate layer-item-label mt-2"},this.state.dataSourceName),(0,e.jsx)(t.Button,{role:"button","aria-label":this.nls("close"),title:this.nls("close"),className:"ml-2",icon:!0,type:"tertiary",size:"sm",onClick:this.onCloseDataItemPanel.bind(this)},(0,e.jsx)(t.Icon,{icon:oe.iconClose,size:16}))),this.state.activeDataSource&&this.props.config.configInfo[this.state.activeDataSource]&&(0,e.jsx)("div",{className:"setting-container"},(0,e.jsx)(s.SettingSection,null,(0,e.jsx)(t.CollapsablePanel,{label:this.nls("profileChart"),"aria-label":this.nls("profileChart"),isOpen:this.state.isProfileChartSettingsOpen,onRequestOpen:()=>{this.onToggleProfileChartSettings()},onRequestClose:()=>{this.onToggleProfileChartSettings()}},(0,e.jsx)(s.SettingRow,{flow:"wrap"},(0,e.jsx)(K,{intl:this.props.intl,theme:this.props.theme,currentDs:this.state.activeDataSource,config:this.props.config.configInfo[this.state.activeDataSource].profileChartSettings,groundLayerInfo:this.groundData,isRTL:this.isRTL,onProfileChartSettingsUpdated:this.updateProfileChartSettings})))),(0,e.jsx)(s.SettingSection,null,(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(t.Label,{className:"pr-2 w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break setting-text-level-0"},this.nls("profileSettingsLabel"))),(0,e.jsx)(t.Switch,{role:"switch","aria-label":this.nls("profileSettingsLabel"),title:this.nls("profileSettingsLabel"),checked:null===(l=this.props.config.configInfo[this.state.activeDataSource])||void 0===l?void 0:l.profileSettings.isProfileSettingsEnabled,"aria-expanded":null===(o=this.props.config.configInfo[this.state.activeDataSource])||void 0===o?void 0:o.profileSettings.isProfileSettingsEnabled,onChange:this.profileSettingsChange})),(null===(n=this.props.config.configInfo[this.state.activeDataSource])||void 0===n?void 0:n.profileSettings.isProfileSettingsEnabled)&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(s.SettingRow,{label:this.nls("profileRendering")},(0,e.jsx)(t.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("profileRenderingTooltip"),title:this.nls("profileRenderingTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"ml-2 d-inline color-label"},(0,e.jsx)(t.Icon,{size:14,icon:oe.infoIcon})))),(0,e.jsx)(s.SettingRow,{flow:"wrap"},(0,e.jsx)(t.Label,{className:"m-0 color-label",centric:!0},(0,e.jsx)(t.Radio,{role:"radio","aria-label":this.nls("groundElevation"),className:"cursor-pointer",value:"groundElevation",onChange:()=>{this.handleProfileRendering(!1)},checked:!(null===(p=this.props.config.configInfo[this.state.activeDataSource])||void 0===p?void 0:p.profileSettings.isCustomizeOptionEnabled)}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 text-break cursor-pointer",onClick:()=>{this.handleProfileRendering(!0)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.handleProfileRendering(!1)}},this.nls("groundElevation")))),(0,e.jsx)(s.SettingRow,{flow:"wrap"},(0,e.jsx)(t.Label,{className:"m-0 color-label",centric:!0},(0,e.jsx)(t.Radio,{role:"radio","aria-label":this.nls("customizeSelectableLayersLabel"),className:"cursor-pointer",value:"customizeSelectableLayersLabel",onChange:()=>{this.handleProfileRendering(!0)},checked:null===(h=this.props.config.configInfo[this.state.activeDataSource])||void 0===h?void 0:h.profileSettings.isCustomizeOptionEnabled}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 text-break cursor-pointer",onClick:()=>{this.handleProfileRendering(!1)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.handleProfileRendering(!0)}},this.nls("customizeSelectableLayersLabel")))),(null===(c=this.props.config.configInfo[this.state.activeDataSource])||void 0===c?void 0:c.profileSettings.isCustomizeOptionEnabled)&&(0,e.jsx)(s.SettingRow,{flow:"wrap"},(0,e.jsx)(z,{widgetId:this.props.widgetId,intl:this.props.intl,theme:this.props.theme,activeDsConfig:this.props.config.configInfo[this.state.activeDataSource],config:this.props.config.configInfo[this.state.activeDataSource].profileSettings,onProfileSettingsUpdated:this.updateAssetOrProfileLayersSettings,activeDataSource:this.state.activeDataSource,mapWidgetId:this.props.useMapWidgetIds[0]}))))),(0,e.jsx)(s.SettingSection,null,(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(t.Label,{className:"pr-2 w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break setting-text-level-0"},this.nls("assetSettingsLabel"))),(0,e.jsx)(t.Switch,{role:"switch","aria-label":this.nls("assetSettingsLabel"),title:this.nls("assetSettingsLabel"),checked:(null===(g=null===(d=this.props.config.configInfo[this.state.activeDataSource])||void 0===d?void 0:d.assetSettings)||void 0===g?void 0:g.isAssetSettingsEnabled)||!1,"aria-expanded":(null===(m=null===(u=this.props.config.configInfo[this.state.activeDataSource])||void 0===u?void 0:u.assetSettings)||void 0===m?void 0:m.isAssetSettingsEnabled)||!1,onChange:this.assetSettingsChange})),(null===(f=null===(v=this.props.config.configInfo[this.state.activeDataSource])||void 0===v?void 0:v.assetSettings)||void 0===f?void 0:f.isAssetSettingsEnabled)&&(0,e.jsx)(s.SettingRow,{flow:"wrap"},(0,e.jsx)(le,{widgetId:this.props.widgetId,intl:this.props.intl,theme:this.props.theme,activeDsConfig:this.props.config.configInfo[this.state.activeDataSource],config:this.props.config.configInfo[this.state.activeDataSource].assetSettings,activeDataSource:this.state.activeDataSource,mapWidgetId:this.props.useMapWidgetIds[0],onAssetSettingsUpdated:this.updateAssetOrProfileLayersSettings,onAssetBufferSettingsUpdated:this.updateAssetBufferSettings}))))))))))}}function re(e){c.p=e}})(),d})())}}}));