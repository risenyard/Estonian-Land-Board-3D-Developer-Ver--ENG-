System.register(["jimu-core","jimu-ui","jimu-arcgis","jimu-ui/advanced/setting-components","esri/widgets/support/chartUtils","esri/intl","esri/core/lang","esri/geometry/geometryEngine","esri/geometry/geometryEngineAsync","esri/geometry/Polyline","esri/geometry/Point","esri/geometry/SpatialReference","esri/core/unitUtils","esri/Graphic","esri/Color","esri/widgets/Sketch/SketchViewModel","esri/layers/GraphicsLayer","esri/geometry/Extent","esri/rest/support/Query","esri/widgets/ElevationProfile/ElevationProfileViewModel","esri/core/reactiveUtils","esri/layers/ElevationLayer","esri/symbols/support/jsonUtils","esri/layers/FeatureLayer","esri/core/promiseUtils"],(function(e,t){var i={},s={},o={},n={},a={},r={},l={},d={},h={},c={},p={},u={},g={},v={},f={},m={},y={},S={},b={},x={},w={},L={},C={},I={},E={};return{setters:[function(e){i.AppMode=e.AppMode,i.BaseWidget=e.BaseWidget,i.DataSourceManager=e.DataSourceManager,i.DataSourceStatus=e.DataSourceStatus,i.Immutable=e.Immutable,i.React=e.React,i.WidgetState=e.WidgetState,i.classNames=e.classNames,i.css=e.css,i.geometryUtils=e.geometryUtils,i.getAppStore=e.getAppStore,i.jsx=e.jsx,i.lodash=e.lodash},function(e){s.Alert=e.Alert,s.Button=e.Button,s.Card=e.Card,s.CardBody=e.CardBody,s.Checkbox=e.Checkbox,s.Collapse=e.Collapse,s.Icon=e.Icon,s.Label=e.Label,s.Loading=e.Loading,s.LoadingType=e.LoadingType,s.MultiSelect=e.MultiSelect,s.NumericInput=e.NumericInput,s.Option=e.Option,s.Popper=e.Popper,s.Select=e.Select,s.Switch=e.Switch,s.Tooltip=e.Tooltip,s.WidgetPlaceholder=e.WidgetPlaceholder,s.defaultMessages=e.defaultMessages},function(e){o.JimuMapViewComponent=e.JimuMapViewComponent},function(e){n.SettingRow=e.SettingRow},function(e){a.default=e.default},function(e){r.default=e.default},function(e){l.default=e.default},function(e){d.default=e.default},function(e){h.default=e.default},function(e){c.default=e.default},function(e){p.default=e.default},function(e){u.default=e.default},function(e){g.default=e.default},function(e){v.default=e.default},function(e){f.default=e.default},function(e){m.default=e.default},function(e){y.default=e.default},function(e){S.default=e.default},function(e){b.default=e.default},function(e){x.default=e.default},function(e){w.default=e.default},function(e){L.default=e.default},function(e){C.default=e.default},function(e){I.default=e.default},function(e){E.default=e.default}],execute:function(){e((()=>{var e={59857:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M19.5 20a.5.5 0 0 0 0-1H1V1.5a.5.5 0 0 0-1 0V19a1 1 0 0 0 1 1h18.5ZM14 4a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm-.581 1.956a2.008 2.008 0 0 1-.88-.01L9.366 11.54a2 2 0 1 1-3.06.395l-1.639-2.05a2 2 0 1 1 .831-.562l1.538 1.923a1.991 1.991 0 0 1 1.452-.186l3.165-5.581a2 2 0 1 1 2.66.03l2.267 4.535a2 2 0 1 1-.894.448l-2.268-4.536ZM5 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm3 6a1 1 0 1 0 0-2 1 1 0 0 0 0 2Zm9-1a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z" clip-rule="evenodd"></path></svg>'},18371:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m6.036 12.157 8.01-8.01a.5.5 0 1 1 .707.707l-8.01 8.01a1 1 0 0 1-1.415 0L1.146 8.682a.5.5 0 1 1 .708-.707l4.182 4.182Z"></path></svg>'},41553:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M9.438.994c.213 0 .397.146.44.35.151.722.257 1.34.316 1.852.374.16.725.362 1.048.599l1.728-.676a.455.455 0 0 1 .556.188l1.42 2.394a.43.43 0 0 1-.091.547 21.98 21.98 0 0 1-1.49 1.194 5.17 5.17 0 0 1-.007 1.183l1.464 1.119a.43.43 0 0 1 .111.563l-1.42 2.394a.454.454 0 0 1-.53.197 22.445 22.445 0 0 1-1.807-.66c-.325.233-.679.43-1.055.586l-.263 1.794a.446.446 0 0 1-.445.376H6.574a.446.446 0 0 1-.44-.35 21.019 21.019 0 0 1-.317-1.853 5.34 5.34 0 0 1-1.047-.598l-1.728.675a.455.455 0 0 1-.556-.187l-1.42-2.395a.43.43 0 0 1 .091-.546c.567-.49 1.063-.888 1.49-1.194a5.167 5.167 0 0 1 .008-1.183L1.19 6.243a.43.43 0 0 1-.112-.562l1.42-2.395a.455.455 0 0 1 .531-.196c.719.233 1.321.453 1.807.66.324-.233.679-.43 1.056-.587l.262-1.794A.446.446 0 0 1 6.6.994h2.839Zm-.365 1H6.985l-.28 1.866-.467.19c-.235.095-.46.21-.672.34l-.207.136-.42.293-.476-.197c-.328-.137-.718-.281-1.169-.433l-.221-.074-1.045 1.719L3.59 6.999l-.06.479a4.127 4.127 0 0 0-.021.816l.014.144.058.492-.419.294c-.288.203-.615.451-.979.746l-.177.145 1.043 1.72 1.845-.703.406.29c.204.146.42.274.645.384l.228.103.474.199.059.49c.04.338.103.731.19 1.177l.043.219h2.088l.282-1.867.466-.19c.236-.095.46-.21.672-.34l.207-.136.419-.293.476.198c.33.136.72.28 1.17.433l.22.072 1.044-1.718-1.56-1.165.06-.479a4.131 4.131 0 0 0 .02-.815l-.013-.144-.06-.492.42-.295a18.1 18.1 0 0 0 .98-.746l.176-.146-1.043-1.72-1.844.705-.406-.29a4.496 4.496 0 0 0-.646-.385l-.228-.103-.474-.199-.058-.49c-.032-.27-.08-.576-.14-.916l-.094-.48Zm-1.067 3a3 3 0 1 1 0 6 3 3 0 0 1 0-6Zm0 1a2 2 0 1 0 0 4 2 2 0 0 0 0-4Z" clip-rule="evenodd"></path></svg>'},31356:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M2 1a1 1 0 0 0-1 1v17a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H2Zm2 1H2v17h2V2ZM9 6a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1H9Zm2 1H9v12h2V7ZM15 11a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1v-8Zm1 0h2v8h-2v-8Z" clip-rule="evenodd"></path></svg>'},33869:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M15 7.5a.522.522 0 0 1-.516.527H2.976L6.473 11.6a.535.535 0 0 1 0 .746.508.508 0 0 1-.73 0L1 7.5l4.743-4.846a.508.508 0 0 1 .73 0 .535.535 0 0 1 0 .746L2.976 6.973h11.508c.285 0 .516.236.516.527Z"></path></svg>'},59788:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .538.538 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.538.538 0 0 1 0-.738Z" clip-rule="evenodd"></path></svg>'},25940:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M14.497 7c.277 0 .501-.224.502-.5v-.001A.499.499 0 0 0 14.5 6h-12l2.604-3.135a.528.528 0 0 0-.805-.682L1.243 5.718A1 1 0 0 0 1 6.372V6.5a.5.5 0 0 0 .5.5h12.997ZM1.503 9c-.277 0-.501.224-.502.5v.001c0 .276.224.499.499.499h12l-2.604 3.135a.528.528 0 0 0 .805.682l3.056-3.535A1 1 0 0 0 15 9.628V9.5a.5.5 0 0 0-.5-.5H1.503Z" clip-rule="evenodd"></path></svg>'},59216:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M11.226 1.312c-.403-.404-1.044-.417-1.431-.03L2.49 8.587l-.48 2.674a.637.637 0 0 0 .73.73l2.673-.48 7.305-7.306c.387-.387.374-1.028-.03-1.431l-1.462-1.462Zm-8.113 9.575.32-1.781 4.991-4.992 1.462 1.462-4.992 4.991-1.781.32Zm7.473-6.012 1.402-1.4-1.462-1.463-1.401 1.402 1.461 1.461Z" clip-rule="evenodd"></path><path fill="#000" d="M1.5 14a.5.5 0 0 0 0 1h13a.5.5 0 0 0 0-1h-13Z"></path></svg>'},99395:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M6.973 11.484c0 .285.236.516.527.516a.522.522 0 0 0 .527-.516V1.976L10.6 4.473c.206.202.54.202.746 0a.508.508 0 0 0 0-.73L7.5 0 3.654 3.743a.508.508 0 0 0 0 .73c.206.202.54.202.746 0l2.573-2.497v9.508ZM1 8v7h13V8h1v8H0V8h1Z" clip-rule="evenodd"></path></svg>'},54357:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M6 6.5a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0v-6ZM9.5 6a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 1 0v-6a.5.5 0 0 0-.5-.5Z"></path><path fill="#000" fill-rule="evenodd" d="M11 0H5a1 1 0 0 0-1 1v2H.5a.5.5 0 0 0 0 1h1.6l.81 11.1a1 1 0 0 0 .995.9h8.19a1 1 0 0 0 .995-.9L13.9 4h1.6a.5.5 0 0 0 0-1H12V1a1 1 0 0 0-1-1Zm0 3V1H5v2h6Zm1.895 1h-9.79l.8 11h8.19l.8-11Z" clip-rule="evenodd"></path></svg>'},46475:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="m10.308.302-.589.808 3.84 2.796L9 6.555l5.013 3.736.597-.801-3.796-2.832 4.576-2.657-5.081-3.7ZM.25 3l8.642 4.969-3.423.738 2.724 5.45-2.887 1.667-2.724-5.45-2.35 2.595L.25 3Zm.996 1.726-.01 5.644 1.527-1.684 2.909 5.771 1.155-.667-2.91-5.77 2.222-.48-4.893-2.814Z" clip-rule="evenodd"></path></svg>'},88866:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2ZM6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5Z"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16Zm0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14Z" clip-rule="evenodd"></path></svg>'},11639:e=>{"use strict";e.exports=f},94129:e=>{"use strict";e.exports=v},77970:e=>{"use strict";e.exports=l},57780:e=>{"use strict";e.exports=E},135:e=>{"use strict";e.exports=w},93761:e=>{"use strict";e.exports=g},55606:e=>{"use strict";e.exports=S},8294:e=>{"use strict";e.exports=p},24920:e=>{"use strict";e.exports=c},75443:e=>{"use strict";e.exports=u},24942:e=>{"use strict";e.exports=d},61339:e=>{"use strict";e.exports=h},3498:e=>{"use strict";e.exports=r},17465:e=>{"use strict";e.exports=L},99818:e=>{"use strict";e.exports=I},23852:e=>{"use strict";e.exports=y},37902:e=>{"use strict";e.exports=b},45818:e=>{"use strict";e.exports=C},22443:e=>{"use strict";e.exports=x},97878:e=>{"use strict";e.exports=m},3476:e=>{"use strict";e.exports=a},26826:e=>{"use strict";e.exports=o},48891:e=>{"use strict";e.exports=i},30726:e=>{"use strict";e.exports=s},77756:e=>{"use strict";e.exports=n}},t={};function M(i){var s=t[i];if(void 0!==s)return s.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,M),o.exports}M.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return M.d(t,{a:t}),t},M.d=(e,t)=>{for(var i in t)M.o(t,i)&&!M.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},M.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),M.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},M.p="";var D={};return M.p=window.jimuConfig.baseUrl,(()=>{"use strict";M.r(D),M.d(D,{__set_webpack_public_path__:()=>Se,default:()=>ye});var e,t=M(48891),i=M(30726);!function(e){e.IconText="ICONTEXT"}(e||(e={}));var s=M(26826);function o(e){const i=e.surfaces[1].bg;return t.css`
    overflow: auto;
    background-color: ${i};
    .widget-elevation-profile {
      width: 100%;
      height: 100%;
      min-height: 200px;

      .userGuideInfo {
        font-weight: 400;
        overflow-y: auto;
        height: 65px;
      }

      .front-section {
        min-width: 200px;
        min-height: 200px;
        max-height: 250px;
        max-width: 220px;
      }

      .front-cards {
        border-radius: 7px;
      }

      .hidden {
        display: none;
      }

      .mainSection {
        padding: 20px;
      }

      .adjust-cards {
        gap: 2px 35px;
        width: 100%;
        max-height: -webkit-fill-available;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
      }
  `}function n(e){let i="3px 8px 2px 12px";return"125%"===e.typography.fontSizeRoot?i="0px 8px 2px 10px":"87.5%"===e.typography.fontSizeRoot?i="4px 8px 2px 13px":"75%"===e.typography.fontSizeRoot&&(i="5px 8px 2px 14px"),t.css`
    .actionButton {
      margin: 2px 0px 2px 5px;
    }

    .exportHintStyle {
      font-style: italic;
    }

    .exportLabel {
      margin: 0 !important;
      font-weight: 500;
    }

    .showCustomizeEdit {
      display: block;
    }

    .hideCustomizeEdit {
      display: none;
    }

    .style-setting--unit-selector {
      width: 50px;
      margin-left: 0px;
      background: var(--light-200);
      color: var(--black);
      height: 26px;
    }

    .unitsLabel {
      margin: ${i};
      border-radius: 0px;
      color: var(--black);
    }

    .invalidRange {
      font-style: italic;
      color: ${e.colors.danger};
    }

    .invalidValue {
      height: 28px!important;
      border: 1px solid  ${e.colors.danger};
      box-shadow: 0 0 1px  ${e.colors.danger};
    }
  `}function a(e){let i="calc(100% - 83px)";return"125%"===e.typography.fontSizeRoot?i="calc(100% - 92px)":"87.5%"===e.typography.fontSizeRoot?i="calc(100% - 78px)":"75%"===e.typography.fontSizeRoot&&(i="calc(100% - 73px)"),t.css`
    .ep-widget-header {
      .chart-actions {
        float: right;
        width: 32px;
        height: 32px;
        margin: 2px 5px 2px 5px;
      }
    }

    .ep-widget-bodyContainer {
      height: ${i};

      .alignInfo {
        padding-right: 40px;
        padding-left: 40px;
      }

      .userInfo .left-part {
        font-weight: 400;
      }
    }

    .floatingInfoMsg {
      .alignDismissibleInfo {
        position: absolute;
        left: 53px;
        width: calc(100% - 109px);
        z-index: 1;
        bottom: 55px;
        margin: 0 auto;
      }

      .alignDismissibleInfo .left-part .text-left {
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        display: -webkit-box;
        font-weight: 400;
      }

      .showMessage {
        display: flex;
      }

      .hideMessage {
        display: none;
      }
    }

    .ep-widget-footer {
      line-height: 1.3;
      background-color: unset;
      border: 1px solid ${e.colors.palette.light[200]};
      width: calc(100% - 9px);
      margin-left: 4px;

      .hidden {
        display: none;
      }

      .footer-display {
        display: inline-block;
      }

      .actionButton {
        float: right;
      }
    }
  `}var r=M(77756);const l={_widgetLabel:"Elevation Profile",_action_select_label:"Select line",selectLinesLabel:"Select line",selectLinesDesc:"Select a line to view the elevation.",selectButtonLabel:"Select",drawProfileLabel:"Draw profile",drawProfileDesc:"Draw a line to view the ground elevation.",drawButtonLabel:"Draw",backButtonLabel:"Reset",doneButtonLabel:"Done",clearButtonLabel:"Clear",newProfileButtonLabel:"New profile",drawUserInfo:"Click the map to place the first point and double-click to finish.",selectUserInfo:"Click a line on the map to begin.",emptyDrawStateWarning:"Draw on the map to generate an elevation profile.",emptySelectStateWarning:"Select a line on the map to generate an elevation profile.",infoMsgWhileDrawing:"Double-click or click Done to finish.",infoMsgWhileSelecting:"Select a connected line (yellow dotted) or click Done to finish.",addToSelectionWarning:"There are no additional connected lines to select.",chartRender:"Elevation Profile for the selected or drawn lines.",noFeaturesFound:"No selectable line in this location. Click a line from the selectable layers.",unknownError:"There was an unknown error generating the profile.",noProfileError:"No elevation information is available for this location.",tooComplexError:"Profile could not be generated. Input line is too complex.",tooComplexAnalysisError:"Analysis could not be performed for this line. Input line is too complex.",invalidGeometryError:"Profile could not be generated. Invalid geometry.",invalidElevationInfoError:"Profile could not be generated. Elevation options of the line are not supported.",chartStatistics:"Profile Statistics",chartFlip:"Reverse Direction",chartExport:"Export Profiles",settingsOptions:"Settings",exportHint:"Values will be exported to a CSV file.",customizeIntervalTooltip:"Customize at which distance interval values are extracted. This interval is only applied to ground and profile elevation values.",customizeIntervalLabel:"Customize interval",exportLabel:"Export",intervalErrorHint:"This value is out of range [{xMin} - {xMax}].",intervalHintForInvalidEntry:"This value is out of range.",layerName:"Layer Name",intersectingLayerDisplayFieldLabel:"Attribute (Display Field)",oneFieldLabelForExport:"Field 1",twoFieldLabelForExport:"Field 2",statisticsLabel:"Profile Statistics",elevationUnitLabel:"Elevation units",distanceUnitLabel:"Distance units",selectableLayersLabel:"Selectable layers",selectLayerLabel:"Select layers",selectedLayerCount:"{selectedLayerCount} enabled",intersectingLayersLabel:"Intersecting layers",bufferSelectorLabel:"Intersection buffer",groundElevation:"Ground Elevation",uniformChartScaling:"Uniform scaling",uniformChartScalingInfo:"Use a uniform scale for the Distance and Elevation axes.",selectLayerWarning:"At least one layer should be enabled for selection",volumetricObj:"Volumetric objects",meters:"Meters",metersAbbreviation:"m",feet:"Feet",feetAbbreviation:"ft",kilometers:"Kilometers",kilometersAbbreviation:"km",miles:"Miles",milesAbbreviation:"mi",yards:"Yards",yardsAbbreviation:"yd",noStatsValue:"No value",distanceLabel:"Distance",elevationLabel:"Elevation",graphDistanceLabel:"Distance - {unit}",graphElevationLabel:"Elevation - {unit}",expandLegend:"Expand Legend",maxDistance:"MAX Distance",minElevation:"MIN Elevation",maxElevation:"MAX Elevation",avgElevation:"AVG Elevation",elevationGain:"Elevation Gain",elevationLoss:"Elevation Loss",maxPositiveSlope:"MAX Positive Slope",maxNegativeSlope:"MAX Negative Slope",avgPositiveSlope:"AVG Positive Slope",avgNegativeSlope:"AVG Negative Slope"},d=M(59857),h=M(46475),c=M(88866),p=M(59216),u=M(33869),g=M(18371),v=M(54357),f=M(31356),m=M(25940),y=M(41553),S=M(59788),b=()=>({epIcon:{elevationIcon:d,selectIcon:h,infoIcon:c,drawIcon:p,arrowNavBack:u,doneIcon:g,clearIcon:v,chartIcon:f,flipIcon:m,settingsIcon:y,iconExpandCollapse:S}}),x=[{value:"meters",abbreviation:"metersAbbreviation"},{value:"feet",abbreviation:"feetAbbreviation"},{value:"kilometers",abbreviation:"kilometersAbbreviation"},{value:"miles",abbreviation:"milesAbbreviation"},{value:"yards",abbreviation:"yardsAbbreviation"}],w=[{value:"maxDistance",label:l.maxDistance},{value:"minElevation",label:l.minElevation},{value:"maxElevation",label:l.maxElevation},{value:"avgElevation",label:l.avgElevation},{value:"elevationGain",label:l.elevationGain},{value:"elevationLoss",label:l.elevationLoss},{value:"maxPositiveSlope",label:l.maxPositiveSlope},{value:"maxNegativeSlope",label:l.maxNegativeSlope},{value:"avgPositiveSlope",label:l.avgPositiveSlope},{value:"avgNegativeSlope",label:l.avgNegativeSlope}];var L,C;!function(e){e.NoVisibleProfiles="no-visible-profiles",e.InvalidGeometry="invalid-geometry",e.TooComplex="too-complex",e.InvalidElevationInfo="invalid-elevation-info",e.UnknownError="unknown-error",e.RefinedButNoChartData="refined-but-no-chart-data",e.None="none"}(L||(L={})),function(e){e.MaxDistance="maxDistance",e.MinElevation="minElevation",e.MaxElevation="maxElevation",e.AvgElevation="avgElevation",e.ElevationGain="elevationGain",e.ElevationLoss="elevationLoss",e.MaxPositiveSlope="maxPositiveSlope",e.MaxNegativeSlope="maxNegativeSlope",e.AvgPositiveSlope="avgPositiveSlope",e.AvgNegativeSlope="avgNegativeSlope"}(C||(C={}));const I=e=>{switch(e){case C.MaxPositiveSlope:return C.MaxNegativeSlope;case C.MaxNegativeSlope:return C.MaxPositiveSlope;case C.AvgPositiveSlope:return C.AvgNegativeSlope;case C.AvgNegativeSlope:return C.AvgPositiveSlope;case C.ElevationLoss:return C.ElevationGain;case C.ElevationGain:return C.ElevationLoss}return e};var E;function A(e){var i;const s=t.DataSourceManager.getInstance(),o=null===(i=null==s?void 0:s.getDataSource(e))||void 0===i?void 0:i.getChildDataSources(),n=[];return null==o||o.forEach((e=>{if("GROUP_LAYER"===e.type){const t=e.getChildDataSources();t&&t.forEach((e=>{n.push(e)}))}else n.push(e)})),n}function F(e,t){let i=null==e?void 0:e.profileChartSettings.elevationUnit,s=null==e?void 0:e.profileChartSettings.linearUnit;return(null==e?void 0:e.profileChartSettings.elevationUnit)||(i="english"===(null==t?void 0:t.units)?"feet":"meters"),(null==e?void 0:e.profileChartSettings.linearUnit)||(s="english"===(null==t?void 0:t.units)?"miles":"kilometers"),[i,s]}!function(e){e[e.Feet=528e4]="Feet",e[e.Miles=1e3]="Miles",e[e.Kilometers=1609.344]="Kilometers",e[e.Meters=1609344]="Meters",e[e.Yards=176e4]="Yards"}(E||(E={}));const P=e=>{switch(e){case"feet":return E.Feet;case"miles":return E.Miles;case"kilometers":return E.Kilometers;case"meters":return E.Meters;case"yards":return E.Yards;default:return 1e3}},O=e=>"english"===(null==e?void 0:e.units)?"feet":"meters";var V=M(3476);function j(e,t,i){return R(e,t,i)}function R(e,t,i){return t===i?+e:+e/k(t)*k(i)}function k(e){let t=1;switch(e){case"meters":t=1;break;case"kilometers":t=.001;break;case"feet":t=1/.3048;break;case"yards":t=1/.9144;break;case"miles":t=1/1609.344}return t}function U(e,t){const i=Math.floor(Math.log10(e)),s=e/Math.pow(10,i);let o;return o=t?s<1.5?1:s<3?2:s<5?2.5:s<7?5:10:s<=1?1:s<=2?2:s<=3?2.5:s<=5?5:10,o*Math.pow(10,i)}var T=M(3498),N=M(77970),B=M(24942),z=M(61339),G=M(24920),_=M(8294),W=M(75443),H=M(93761),Z=M(94129),Y=M(11639);const X=(e,t)=>{let i,s,o;return t.hasOwnProperty("height")&&t.hasOwnProperty("width")&&(i=t.height,s=t.width,o=i>s?i:s,o+=10,e.size=o),t.hasOwnProperty("size")&&(!o||o<t.size)&&(e.size=t.size+10),t.hasOwnProperty("xoffset")&&(e.xoffset=t.xoffset),t.hasOwnProperty("yoffset")&&(e.yoffset=t.yoffset),e};var K=function(e,t,i,s){return new(i||(i=Promise))((function(o,n){function a(e){try{l(s.next(e))}catch(e){n(e)}}function r(e){try{l(s.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((s=s.apply(e,t||[])).next())}))};const J="meters";class q extends t.React.PureComponent{constructor(e){var s,o,n;super(e),this._chartContainer=t.React.createRef(),this.nls=e=>{const t=Object.assign({},l,i.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:t[e]}):t[e]},this.componentDidUpdate=e=>{var t,i,s,o,n,a,r,l,d,h,c,p,u,g,v,f,m,y,S,b,x,w,L,C,I,E,M,D,A,F,P,O,V,j,R,k,U,T,N,B,z,G,_,W,H,Z,Y,X,K,J,q,$,Q,ee,te,ie,se,oe,ne,ae,re,le,de,he,ce;if((null===(t=e.commonGeneralSettings)||void 0===t?void 0:t.showGridAxis)!==(null===(i=this.props.commonGeneralSettings)||void 0===i?void 0:i.showGridAxis)&&(null===(s=this.chart)||void 0===s?void 0:s.xAxes.values.length)>0&&this.chart.yAxes.values.length>0||e.elevationGraphColor!==this.props.elevationGraphColor){if(this.chart){this.xAxis.renderer.grid.template.disabled=!(null===(o=this.props.commonGeneralSettings)||void 0===o?void 0:o.showGridAxis),this.yAxis.renderer.grid.template.disabled=!(null===(n=this.props.commonGeneralSettings)||void 0===n?void 0:n.showGridAxis);const{am4core:e}=this.amchart4;this.chartSeries.stroke=e.color(this.props.elevationGraphColor),this.chartSeries.fill=e.color(this.props.elevationGraphColor)}return}if((null===(a=e.commonGeneralSettings)||void 0===a?void 0:a.showLegend)!==(null===(r=this.props.commonGeneralSettings)||void 0===r?void 0:r.showLegend)||(null===(l=e.commonGeneralSettings)||void 0===l?void 0:l.showAxisTitles)!==(null===(d=this.props.commonGeneralSettings)||void 0===d?void 0:d.showAxisTitles))return this.xAxis.title.visible=null===(h=this.props.commonGeneralSettings)||void 0===h?void 0:h.showAxisTitles,this.xAxis.title.textAlign="middle",this.yAxis.title.visible=null===(c=this.props.commonGeneralSettings)||void 0===c?void 0:c.showAxisTitles,this.yAxis.title.textAlign="middle",this.isRTL?this.chart.padding(0,(null===(p=this.props.commonGeneralSettings)||void 0===p?void 0:p.showAxisTitles)?5:-10,(null===(u=this.props.commonGeneralSettings)||void 0===u?void 0:u.showAxisTitles)&&(null===(g=this.props.commonGeneralSettings)||void 0===g?void 0:g.showLegend)?4:(null===(v=this.props.commonGeneralSettings)||void 0===v?void 0:v.showAxisTitles)&&!(null===(f=this.props.commonGeneralSettings)||void 0===f?void 0:f.showLegend)?-2:!(null===(m=this.props.commonGeneralSettings)||void 0===m?void 0:m.showAxisTitles)&&(null===(y=this.props.commonGeneralSettings)||void 0===y?void 0:y.showLegend)||(null===(S=this.props.commonGeneralSettings)||void 0===S?void 0:S.showAxisTitles)||(null===(b=this.props.commonGeneralSettings)||void 0===b?void 0:b.showLegend)?0:-25,5):this.chart.padding(0,5,(null===(x=this.props.commonGeneralSettings)||void 0===x?void 0:x.showAxisTitles)&&(null===(w=this.props.commonGeneralSettings)||void 0===w?void 0:w.showLegend)?4:(null===(L=this.props.commonGeneralSettings)||void 0===L?void 0:L.showAxisTitles)&&!(null===(C=this.props.commonGeneralSettings)||void 0===C?void 0:C.showLegend)?-2:!(null===(I=this.props.commonGeneralSettings)||void 0===I?void 0:I.showAxisTitles)&&(null===(E=this.props.commonGeneralSettings)||void 0===E?void 0:E.showLegend)||(null===(M=this.props.commonGeneralSettings)||void 0===M?void 0:M.showAxisTitles)||(null===(D=this.props.commonGeneralSettings)||void 0===D?void 0:D.showLegend)?0:-25,(null===(A=this.props.commonGeneralSettings)||void 0===A?void 0:A.showAxisTitles)?5:-10),this.xAxis.invalidateLabels(),this.yAxis.invalidateLabels(),void this.setState({showLegend:null===(F=this.props.commonGeneralSettings)||void 0===F?void 0:F.showLegend},(()=>{var e;this.state.showLegend?this.chart.legend?this.chart.legend.visible=this.state.showLegend:this.displayChartLegend(this.accessChartParams):(null===(e=this.chart)||void 0===e?void 0:e.legend)&&(this.chart.legend.visible=this.state.showLegend)}));if(e.volumetricObjLineColor!==this.props.volumetricObjLineColor){if(this.chart){const{am4core:e}=this.amchart4;this.volumetricObjLineSeries.stroke=e.color(this.props.volumetricObjLineColor),this.volumetricObjLineSeries.fill=e.color(this.props.volumetricObjLineColor)}return}if(e.volumetricObjLabel!==this.props.volumetricObjLabel)return void(this.chart&&(this.volumetricObjLineSeries.name=this.props.volumetricObjLabel?this.props.volumetricObjLabel:this.nls("volumetricObj")));const pe=this.didProfileLayersSettingsChanged(null===(P=e.currentConfig)||void 0===P?void 0:P.profileSettings.layers,null===(O=this.props.currentConfig)||void 0===O?void 0:O.profileSettings.layers),ue=this.didIntersectingLayersSettingsChanged(null===(j=null===(V=e.currentConfig)||void 0===V?void 0:V.assetSettings)||void 0===j?void 0:j.layers,null===(k=null===(R=this.props.currentConfig)||void 0===R?void 0:R.assetSettings)||void 0===k?void 0:k.layers);(pe||ue||e.assetIntersectionResult!==this.props.assetIntersectionResult||e.selectedLinearUnit!==this.props.selectedLinearUnit||e.selectedElevationUnit!==this.props.selectedElevationUnit||e.chartDataUpdateTime!==this.props.chartDataUpdateTime||e.theme!==this.props.theme||e.isFlip!==this.props.isFlip||e.isUniformChartScalingEnable!==this.props.isUniformChartScalingEnable||(null===(U=e.currentConfig)||void 0===U?void 0:U.advanceOptions)!==(null===(T=this.props.currentConfig)||void 0===T?void 0:T.advanceOptions)||(null===(B=null===(N=e.currentConfig)||void 0===N?void 0:N.profileSettings)||void 0===B?void 0:B.isProfileSettingsEnabled)!==(null===(G=null===(z=this.props.currentConfig)||void 0===z?void 0:z.profileSettings)||void 0===G?void 0:G.isProfileSettingsEnabled)||(null===(W=null===(_=e.currentConfig)||void 0===_?void 0:_.profileSettings)||void 0===W?void 0:W.isCustomizeOptionEnabled)!==(null===(Z=null===(H=this.props.currentConfig)||void 0===H?void 0:H.profileSettings)||void 0===Z?void 0:Z.isCustomizeOptionEnabled)||(null===(X=null===(Y=e.currentConfig)||void 0===Y?void 0:Y.assetSettings)||void 0===X?void 0:X.isAssetSettingsEnabled)!==(null===(J=null===(K=this.props.currentConfig)||void 0===K?void 0:K.assetSettings)||void 0===J?void 0:J.isAssetSettingsEnabled)||e.showVolumetricObj!==this.props.showVolumetricObj&&!this.props.showVolumetricObj)&&((e.showVolumetricObj!==this.props.showVolumetricObj&&!this.props.showVolumetricObj||e.chartDataUpdateTime!==this.props.chartDataUpdateTime||e.selectedLinearUnit!==this.props.selectedLinearUnit||e.selectedElevationUnit!==this.props.selectedElevationUnit)&&this.chart&&(this.chart.dispose(),this.chart=null),(pe||ue||e.assetIntersectionResult!==this.props.assetIntersectionResult||e.theme.darkTheme!==this.props.theme.darkTheme||e.theme.colors.palette.primary[600]!==this.props.theme.colors.palette.primary[600]||e.theme.typography.fontSizeRoot!==this.props.theme.typography.fontSizeRoot||(null===(q=e.currentConfig)||void 0===q?void 0:q.advanceOptions)!==(null===($=this.props.currentConfig)||void 0===$?void 0:$.advanceOptions)||(null===(ee=null===(Q=e.currentConfig)||void 0===Q?void 0:Q.profileSettings)||void 0===ee?void 0:ee.isProfileSettingsEnabled)!==(null===(ie=null===(te=this.props.currentConfig)||void 0===te?void 0:te.profileSettings)||void 0===ie?void 0:ie.isProfileSettingsEnabled)||(null===(oe=null===(se=e.currentConfig)||void 0===se?void 0:se.profileSettings)||void 0===oe?void 0:oe.isCustomizeOptionEnabled)!==(null===(ae=null===(ne=this.props.currentConfig)||void 0===ne?void 0:ne.profileSettings)||void 0===ae?void 0:ae.isCustomizeOptionEnabled)||(null===(le=null===(re=e.currentConfig)||void 0===re?void 0:re.assetSettings)||void 0===le?void 0:le.isAssetSettingsEnabled)!==(null===(he=null===(de=this.props.currentConfig)||void 0===de?void 0:de.assetSettings)||void 0===he?void 0:he.isAssetSettingsEnabled))&&this.chart&&(this.chart.dispose(),this.chart=null),ue&&(this.props.assetIntersectionResult.forEach((e=>{var t,i;null===(i=null===(t=this.props.currentConfig)||void 0===t?void 0:t.assetSettings)||void 0===i||i.layers.forEach((t=>{var i;t.layerId===(null===(i=null==e?void 0:e.settings)||void 0===i?void 0:i.layerId)&&(e.settings=t)}))})),this.chart&&(this.chart.dispose(),this.chart=null)),this.updatedProfileLayers=null===(ce=this.props.currentConfig)||void 0===ce?void 0:ce.profileSettings.layers,this.createOrUpdateChartDefinition()),e.isExportEnable!==this.props.isExportEnable&&this.props.isExportEnable&&(this.props.setExportButton(!1),this.performExportOperation())},this.resetExportingInfo=()=>{this.groundExportingInfo={xCoordinate:"X",yCoordinate:"Y",x:this.nls("distanceLabel")+" ("+this.props.selectedLinearUnit+")",y:this.nls("groundElevation")+" ("+this.props.selectedElevationUnit+")"},this.intersectingLayersExportingInfo={}},this.exportDataForIntersectingLayers=()=>{const e={};Object.entries(this.intersectionSeriesKey).forEach((([t,i])=>{const s=this.chart.data[t];Object.entries(i).forEach((([t,i])=>{var o;(null===(o=this.intersectingLayersExportingInfo)||void 0===o?void 0:o[t])&&i.forEach((i=>{const o={xCoordinate:s.xCoordinate,yCoordinate:s.yCoordinate,x:s.x,intersectingLayerY:i.value,intersectingLayerY2:void 0,intersectingLayerDisplayField:i.displayField,layerName:this.intersectingLayersExportingInfo[t].layerName};i.hasOwnProperty("y2")&&(o.intersectingLayerY2=i.y2),e[t]||(e[t]=[]),e[t].push(o)}))}))})),Object.keys(e).forEach((t=>{const i=e[t];this.props.isFlip&&i.reverse(),this.chart.exporting.adapter.add("data",(()=>({data:i})));const s=N.default.clone(this.intersectingLayersExportingInfo[t]);s.layerName=this.nls("layerName"),this.chart.exporting.dataFields=s,this.chart.exporting.export("csv"),this.chart.exporting.adapter.remove("data")}))},this.performExportOperation=()=>{try{const e=new Date;this.chart.exporting.filePrefix=this.nls("_widgetLabel")+"-"+e.toDateString()+" "+e.toLocaleTimeString(),this.chart.exporting.dataFields=this.groundExportingInfo,this.chart.exporting.adapter.add("data",(e=>{let t=[];if(e){const i=e.data;if(this.props.isCustomIntervalEnabled&&!isNaN(this.props.customDistanceInterval)){let e=0;i.forEach((i=>{i.x>=e&&(t.push(i),e+=this.props.customDistanceInterval)}))}else t=[...i];return t=t.filter(((e,i)=>0===i||e.x!==t[i-1].x)),this.props.isFlip&&t.reverse(),{data:t}}return e})),this.chart.exporting.export("csv"),this.chart.exporting.adapter.remove("data"),this.exportDataForIntersectingLayers()}catch(e){console.log(e)}},this.didProfileLayersSettingsChanged=(e,t)=>{let i=!1;return(null==t?void 0:t.length)!==(null==e?void 0:e.length)||(null==t||t.some(((t,s)=>{if(t.style.lineType!==e[s].style.lineType||t.style.lineColor!==e[s].style.lineColor||t.style.lineThickness!==e[s].style.lineThickness||t.elevationSettings.type!==e[s].elevationSettings.type||t.elevationSettings.unit!==e[s].elevationSettings.unit||t.elevationSettings.field1!==e[s].elevationSettings.field1||t.elevationSettings.field2!==e[s].elevationSettings.field2||t.distanceSettings.type!==e[s].distanceSettings.type||t.distanceSettings.field!==e[s].distanceSettings.field||t.distanceSettings.unit!==e[s].distanceSettings.unit)return i=!0,!0})),i)},this.didIntersectingLayersSettingsChanged=(e,t)=>{let i=!1;return(null==t?void 0:t.length)===(null==e?void 0:e.length)&&(null==t||t.some(((t,s)=>{var o,n,a,r,l,d,h,c,p,u,g,v,f,m,y,S,b,x,w,L,C,I,E,M,D;if((null===(o=null==t?void 0:t.style)||void 0===o?void 0:o.type)!==(null===(a=null===(n=e[s])||void 0===n?void 0:n.style)||void 0===a?void 0:a.type)||(null==t?void 0:t.displayField)!==(null===(r=e[s])||void 0===r?void 0:r.displayField)||(null===(l=null==t?void 0:t.style)||void 0===l?void 0:l.intersectingAssetShape)!==(null===(h=null===(d=e[s])||void 0===d?void 0:d.style)||void 0===h?void 0:h.intersectingAssetShape)||(null===(c=null==t?void 0:t.style)||void 0===c?void 0:c.intersectingAssetSize)!==(null===(u=null===(p=e[s])||void 0===p?void 0:p.style)||void 0===u?void 0:u.intersectingAssetSize)||(null===(g=null==t?void 0:t.style)||void 0===g?void 0:g.intersectingAssetColor)!==(null===(f=null===(v=e[s])||void 0===v?void 0:v.style)||void 0===f?void 0:f.intersectingAssetColor)||(null===(m=null==t?void 0:t.elevationSettings)||void 0===m?void 0:m.type)!==(null===(S=null===(y=e[s])||void 0===y?void 0:y.elevationSettings)||void 0===S?void 0:S.type)||(null===(b=null==t?void 0:t.elevationSettings)||void 0===b?void 0:b.unit)!==(null===(w=null===(x=e[s])||void 0===x?void 0:x.elevationSettings)||void 0===w?void 0:w.unit)||(null===(L=null==t?void 0:t.elevationSettings)||void 0===L?void 0:L.field1)!==(null===(I=null===(C=e[s])||void 0===C?void 0:C.elevationSettings)||void 0===I?void 0:I.field1)||(null===(E=null==t?void 0:t.elevationSettings)||void 0===E?void 0:E.field2)!==(null===(D=null===(M=e[s])||void 0===M?void 0:M.elevationSettings)||void 0===D?void 0:D.field2))return i=!0,!0}))),i},this.createOrUpdateChartDefinition=()=>{var e,t;if((null===(t=null===(e=this.props.profileResult)||void 0===e?void 0:e.lines)||void 0===t?void 0:t.length)>0&&this.props.selectedLinearUnit&&this.props.selectedElevationUnit&&this.props.theme){const e=this.props.profileResult.lines[0].samples;if(this.viewOutput=null,this.props.profileResult.lines.length>1&&this.props.showVolumetricObj&&"3d"===this.props.mapView.view.type&&(this.viewOutput=this.props.profileResult.lines[1].samples),e.length>0){const t=[];this.allDistances=[],e.length>0?(e.forEach(((e,i)=>{const s={xCoordinate:e.x,yCoordinate:e.y,x:R(e.distance,this.props.profileResult.effectiveUnits.distance,this.props.selectedLinearUnit),y:R(e.elevation,this.props.profileResult.effectiveUnits.elevation,this.props.selectedElevationUnit),esriCTViewY:null,pathIdx:0,pointIdx:i};this.viewOutput&&(s.esriCTViewY=R(this.viewOutput[i].elevation,this.props.profileResult.effectiveUnits.elevation,this.props.selectedElevationUnit)),t.push(s),this.allDistances.push(e.distance)})),this.minMaxOfEachProfile={},this.seriesKey=[],this.seriesValue=[],this.createDataForProfileLines(t).then((()=>{this.createDataForIntersectingAssets(t).then((()=>{let e=[];if(this.props.isFlip){const i=t[t.length-1].x;e=[...t],e.forEach((e=>{e.x=i-e.x}))}const i=this.getSelectedUnits(),s=this.props.intl.formatMessage({id:"graphDistanceLabel",defaultMessage:l.graphDistanceLabel},{unit:i[0]}),o=this.props.intl.formatMessage({id:"graphElevationLabel",defaultMessage:l.graphElevationLabel},{unit:i[1]}),n={data:this.props.isFlip?e:t,series:[{x:{field:"x",label:s},y:{field:"y",label:o},color:this.props.elevationGraphColor}]};this.setState({chartDefinition:n},(()=>{var a,r;if(this.chart){this.chart.data=this.props.isFlip?e:t,this.xAxis.title.text=s,this.xAxis.title.textAlign="middle",this.yAxis.title.text=o,this.yAxis.title.textAlign="middle";const{am4core:n}=this.amchart4;return this.chart.zoomOutButton.background.fill=n.color(this.props.theme.colors.palette.primary[600]),this.chart.zoomOutButton.background.states.getKey("hover")&&this.chart.zoomOutButton.background.states.getKey("down")&&(this.chart.zoomOutButton.background.states.getKey("hover").properties.fill=n.color(this.props.theme.colors.palette.primary[500]),this.chart.zoomOutButton.background.states.getKey("down").properties.fill=n.color(this.props.theme.colors.palette.primary[800])),this.xAxis.numberFormatter=this.makeFormatter(this.xAxis,i[2]),this.yAxis.numberFormatter=this.makeFormatter(this.yAxis,i[3]),this.adjustAxisRanges(this.accessChartParams),this.xAxis.invalidateLabels(),void this.yAxis.invalidateLabels()}this.createChart({definition:n,container:this._chartContainer.current,isRTL:this.isRTL,isDarkTheme:this.props.theme.darkTheme,showGrid:null===(a=this.props.commonGeneralSettings)||void 0===a?void 0:a.showGridAxis,showTitleAxis:null===(r=this.props.commonGeneralSettings)||void 0===r?void 0:r.showAxisTitles,showLegend:this.state.showLegend})}))}))}))):this.setState({chartDefinition:null},(()=>{this.chart&&(this.chart.dispose(),this.chart=null)}))}}else this.setState({chartDefinition:null}),this.chart&&(this.chart.dispose(),this.chart=null)},this.checkForProfileSettings=()=>{var e,t,i,s;const o=[];return(null===(t=null===(e=this.props.drawingLayer)||void 0===e?void 0:e.graphics)||void 0===t?void 0:t.length)>0&&(null===(s=null===(i=this.props.drawingLayer.graphics.getItemAt(0))||void 0===i?void 0:i.attributes)||void 0===s?void 0:s.esriCTFeatureLayerId)&&this.props.drawingLayer.graphics.forEach((e=>{const t=e.getAttribute("esriCTFeatureLayerId");o.includes(t)||o.push(t)})),o},this.getSelectedUnits=()=>{const e=this.props.unitOptions.find((e=>e.value===this.props.selectedLinearUnit)),t=this.props.unitOptions.find((e=>e.value===this.props.selectedElevationUnit)),i=this.nls(e.value),s=this.nls(e.abbreviation);return[i,this.nls(t.value),s,this.nls(t.abbreviation)]},this._updateProfileResults=e=>{const t={distances:{},elevations:{}};var i,s,o;return t.distances=(i=e.distances,s=e.effectiveUnits.distance,o=this.props.selectedLinearUnit,i.map((e=>parseFloat(j(e,s,o).toString()))),i),t.elevations=function(e,t,i,s,o){return e.forEach((e=>{e.x=parseFloat(j(e.x,t,s).toString()),e.y=parseFloat(j(e.y,i,o).toString())})),e}(e.elevations,e.effectiveUnits.distance,e.effectiveUnits.elevation,this.props.selectedLinearUnit,this.props.selectedElevationUnit),t},this.clearChart=()=>{this.setState({chartDefinition:null})},this.getNearestElevationData=e=>{const t=this.allDistances;let i=R(e,this.props.selectedLinearUnit,this.props.profileResult.effectiveUnits.distance);if(this.props.isFlip){const e=t[t.length-1];i=e-i}const s=t.reduce(((e,t)=>Math.abs(t-i)<Math.abs(e-i)?t:e));if(s>=0){const e=t?t.indexOf(s):-1;if(e>=0)return this.state.chartDefinition.data[e]}return null},this.hideChartPosition=()=>{this.props.hideChartPosition()},this.createChart=e=>K(this,void 0,void 0,(function*(){var t;const i=yield V.default.loadChartsModule();if(!i)return;this.amchart4=i;const{am4core:s,am4charts:o}=i,n=e.isRTL;s.useTheme(i.am4themes_animated),e.isDarkTheme?s.useTheme(i.am4themes_dark):s.unuseTheme(i.am4themes_dark);const a=s.create(e.container,o.XYChart);this.chart=a,n?a.padding(0,e.showTitleAxis?5:-10,e.showTitleAxis&&e.showLegend?4:e.showTitleAxis&&!e.showLegend?-2:!e.showTitleAxis&&e.showLegend||e.showTitleAxis||e.showLegend?0:-25,5):a.padding(0,5,e.showTitleAxis&&e.showLegend?4:e.showTitleAxis&&!e.showLegend?-2:!e.showTitleAxis&&e.showLegend||e.showTitleAxis||e.showLegend?0:-25,e.showTitleAxis?5:-10),a.data=e.definition.data;const r=(null===(t=e.definition.series[0])||void 0===t?void 0:t.color)?e.definition.series[0].color:"#b54900";a.zoomOutButton.background.fill=s.color(this.props.theme.colors.palette.primary[600]),a.zoomOutButton.background.states.getKey("hover")&&a.zoomOutButton.background.states.getKey("down")&&(a.zoomOutButton.background.states.getKey("hover").properties.fill=s.color(this.props.theme.colors.palette.primary[500]),a.zoomOutButton.background.states.getKey("down").properties.fill=s.color(this.props.theme.colors.palette.primary[800])),a.zoomOutButton.readerTitle=this.nls("zoomOut");const l=this.getSelectedUnits(),d=a.xAxes.push(new o.ValueAxis),h=a.yAxes.push(new o.ValueAxis);this.accessChartParams={params:e,am4charts:o,amCharts4Index:i,chart:a,xAxis:d,yAxis:h,unitsAbbreviations:l,groundColor:r,isRTL:n},this.configureXAxis(this.accessChartParams),this.configureYAxis(this.accessChartParams),this.configureTooltipCursorPosition(this.accessChartParams),this.addGroundSeries(this.accessChartParams),this.adjustAxisRanges(this.accessChartParams),this.hideLastGridLines(this.accessChartParams),this.profilingWithCustomizeOptions(),this.viewOutput&&this.props.showVolumetricObj&&"3d"===this.props.mapView.view.type&&this.addVolumetricObjLineSeries(this.accessChartParams),this.state.showLegend&&this.displayChartLegend(this.accessChartParams),n&&(a.rtl=n,a.zoomOutButton.align="left",a.zoomOutButton.marginLeft="5px",this.xAxis.renderer.inversed=n,this.xAxis.renderer.labels.template.textAlign="middle",this.yAxis.renderer.opposite=n,this.yAxis.renderer.labels.template.textAlign="middle")})),this.canShowProfileSettingsForBackward=e=>{var t,i;let s=!1;return e&&(e.hasOwnProperty("advanceOptions")||(null==e?void 0:e.profileSettings.hasOwnProperty("isProfileSettingsEnabled"))||(null==e?void 0:e.profileSettings.hasOwnProperty("isCustomizeOptionEnabled")))&&((null==e?void 0:e.advanceOptions)||(null===(t=null==e?void 0:e.profileSettings)||void 0===t?void 0:t.isProfileSettingsEnabled)&&(null===(i=null==e?void 0:e.profileSettings)||void 0===i?void 0:i.isCustomizeOptionEnabled))&&(s=!0),s},this.profilingWithCustomizeOptions=()=>{var e,t,i,s,o;if(this.resetExportingInfo(),this.canShowProfileSettingsForBackward(this.props.currentConfig)){const e=this.checkForProfileSettings();e.length>0&&e.forEach((e=>{this.addLineSeries(e,this.accessChartParams)}))}this.props.currentConfig&&(this.props.currentConfig.hasOwnProperty("advanceOptions")&&(null===(e=this.props.currentConfig)||void 0===e?void 0:e.advanceOptions)||(null===(i=null===(t=this.props.currentConfig)||void 0===t?void 0:t.assetSettings)||void 0===i?void 0:i.isAssetSettingsEnabled))&&(null===(s=this.props.assetIntersectionResult)||void 0===s?void 0:s.length)>0&&(null===(o=this.props.assetIntersectionResult)||void 0===o||o.forEach((e=>{var t;(null===(t=null==e?void 0:e.intersectionResult)||void 0===t?void 0:t.length)>0&&("polyline"===e.intersectionResult[0].intersectingFeature.geometry.type?this.addIntersectingLineSeries(e,this.accessChartParams):this.addPointSeries(e,this.accessChartParams))})))},this.hideLastGridLines=e=>{const{yAxis:t}=e,i=e=>()=>{e.renderer.grid.each((e=>{e.visible="none"!==e.dataItem.label.dom.getAttribute("display")}))};this.yAxis.events.on("rangechangeended",i(t)),this.yAxis.events.on("validated",i(t))},this.adjustAxisRanges=e=>{var t;const{xAxis:i,yAxis:s}=e;if(null===(t=this.props.profileResult)||void 0===t?void 0:t.statistics){const{minX:e,maxX:t,minY:o,maxY:n}=this.getAdjustedBounds({data:this.props.profileResult,pixelWidth:i.pixelWidth,pixelHeight:s.pixelHeight});i.min=e,i.max=t,s.min=o,s.max=n}},this.getAdjustedBounds=({data:e,pixelWidth:t,pixelHeight:i})=>{const s=e.statistics;let o=s.maxDistance;o=R(o,e.effectiveUnits.distance,this.props.selectedLinearUnit);let n=s.minElevation;n=R(n,e.effectiveUnits.elevation,this.props.selectedElevationUnit);let a=s.maxElevation;a=R(a,e.effectiveUnits.elevation,this.props.selectedElevationUnit);for(const e in this.minMaxOfEachProfile)this.minMaxOfEachProfile[e].max>a&&(a=this.minMaxOfEachProfile[e].max),this.minMaxOfEachProfile[e].min<n&&(n=this.minMaxOfEachProfile[e].min);const r=Math.max(o-0,.001);let l=Math.max(a-n,.001);if(e.dynamicElevationRange){const e=R(r,this.props.selectedLinearUnit,this.props.selectedElevationUnit);l=Math.max(l,e/300)}n-=.02*l,a=n+l+.02*l;const d=function(e,t,i=10){const s=U(t-e,!1);if(0===s)return[e,t];const o=U(s/(i-1),!0);return[Math.floor(e/o)*o,Math.ceil(t/o)*o]}(n,a,10);return l=d[1]-d[0],this.props.isUniformChartScalingEnable?this.getUniformBounds({bounds:{minX:0,maxX:o,minY:n,maxY:a},pixelWidth:t,pixelHeight:i,centered:!0}):{minX:0,maxX:0+r,minY:n,maxY:n+l}},this.getUniformBounds=({bounds:e,pixelWidth:t,pixelHeight:i,centered:s})=>{let{minX:o,maxX:n,minY:a,maxY:r}=e;const l=n-o,d=R(r-a,this.props.selectedElevationUnit,this.props.selectedLinearUnit)/i/(l/t);return d>=1?[o,n]=this.scaleRange([o,n],d,s):[a,r]=this.scaleRange([a,r],1/d,s),{minX:o,maxX:n,minY:a,maxY:r}},this.scaleRange=([e,t],i,s)=>{const o=(t-e)*i;if(s){const i=(e+t)/2-o/2;return[i,i+o]}return[e,e+o]},this.getFontSize=()=>{const e=this.props.theme;let t=9;return"125%"===e.typography.fontSizeRoot?t=11:"87.5%"===e.typography.fontSizeRoot?t=8:"75%"===e.typography.fontSizeRoot&&(t=7),t},this.configureXAxis=e=>{const{xAxis:t,params:i,unitsAbbreviations:s}=e,{am4core:o}=e.amCharts4Index,n=this.getFontSize();this.xAxis=t,t.title.text=i.definition.series[0].x.label,t.title.textAlign="middle",t.title.fontWeight=400,t.title.fontSize=n+3,t.title.visible=i.showTitleAxis,t.cursorTooltipEnabled=!0,t.extraTooltipPrecision=2,t.numberFormatter=this.makeFormatter(t,s[2]),t.strictMinMax=!0;const a=t.renderer.labels.template;a.fontSize=n,a.fontWeight="400",a.paddingTop=6,a.horizontalCenter="left",a.paddingLeft=0,t.renderer.line.visible=!1,t.renderer.baseGrid.disabled=!0,t.renderer.minGridDistance=50,t.renderer.minLabelPosition=.05,t.renderer.maxLabelPosition=.95,t.renderer.fontWeight=400,t.renderer.fontSize=n,t.renderer.grid.template.disabled=!i.showGrid,t.renderer.grid.template.strokeOpacity=.1,t.renderer.grid.template.stroke=o.color("f4f4f4")},this.configureYAxis=e=>{const{yAxis:t,params:i,unitsAbbreviations:s}=e,{am4core:o}=e.amCharts4Index,n=this.getFontSize();this.yAxis=t,t.title.text=i.definition.series[0].y.label,t.title.textAlign="middle",t.title.fontWeight=400,t.title.fontSize=n+3,t.title.paddingBottom=6,t.title.visible=i.showTitleAxis,t.cursorTooltipEnabled=!0,t.extraTooltipPrecision=2,t.numberFormatter=this.makeFormatter(t,s[3]),t.strictMinMax=!0,t.baseValue=-5e5;const a=t.renderer.labels.template;a.fontSize=n,a.fontWeight="400",a.verticalCenter="bottom",a.paddingLeft=4,a.paddingBottom=0,t.renderer.line.opacity=0,t.renderer.line.visible=!1,t.renderer.baseGrid.disabled=!0,t.renderer.inside=!0,t.renderer.minGridDistance=30,t.renderer.minLabelPosition=0,t.renderer.maxLabelPosition=.95,t.renderer.fontWeight=400,t.renderer.fontSize=n,t.renderer.grid.template.disabled=!i.showGrid,t.renderer.grid.template.strokeOpacity=.1,t.renderer.grid.template.stroke=o.color("f4f4f4")},this.highlightIntersectionsOnMap=e=>{var t;const i=Object.keys(e);if((null===(t=this.props.assetIntersectionResult)||void 0===t?void 0:t.length)>0&&i.length>0){const t=[];i.forEach((i=>{const s=e[i];this.props.assetIntersectionResult.some((e=>{var o;if((null===(o=null==e?void 0:e.intersectionResult)||void 0===o?void 0:o.length)>0&&i===e.settings.layerId)return s.forEach((i=>{var s;const o=(null===(s=e.intersectionResult[i])||void 0===s?void 0:s.record).getFeature();t.push(((e,t)=>{switch(t||(t="#00FFFF"),e.geometry.type){case"point":return((e,t)=>{var i,s,o,n;const a=e.layer;let r,l,d,h,c,p,u,g,v;if(l=!1,r={type:"simple-marker",style:"square",color:[0,255,255,0],outline:{color:t||"#00FFFF",width:2}},r.size=30,null==a?void 0:a.renderer)if(a.renderer.symbol)l=!0,r=X(r,a.renderer.symbol);else if((null===(i=a.renderer.infos)||void 0===i?void 0:i.length)>0){for(c=0;c<a.renderer.infos.length;c++)a.typeIdField?d=e.attributes[a.typeIdField]:a.renderer.attributeField&&(d=e.attributes[a.renderer.attributeField]),h=a.renderer.infos[c].value,null!=d&&""!==d&&null!=h&&""!==h&&d.toString()===h.toString()&&(l=!0,r=X(r,a.renderer.infos[c].symbol));l||a.renderer.defaultSymbol&&(l=!0,r=X(r,a.renderer.defaultSymbol))}return(null===(s=null==a?void 0:a.graphics)||void 0===s?void 0:s.length)>0&&a._getSymbol(e)&&(p=e.getShape(),(null==p?void 0:p.shape)?p.shape.hasOwnProperty("r")?(l=!0,r.size=2*p.shape.r+10):p.shape.hasOwnProperty("width")&&(l=!0,(null===(n=null===(o=a.renderer)||void 0===o?void 0:o.infos)||void 0===n?void 0:n.length)>0&&(r=X(r,a.renderer.infos[0].symbol)),r.size=p.shape.width+10):a.renderer.visualVariables&&(u=a._getRenderer(e),g=(e=>{let t=null;return e.renderer.visualVariables&&e.renderer.visualVariables.forEach((e=>{"sizeInfo"===e.type&&(t=e)})),t})(a),g&&(v=u.getSize(e,{sizeInfo:g,shape:a._getSymbol(e),resolution:a&&a.getResolutionInMeters&&a.getResolutionInMeters()}),null!==v&&(r.size=v+10)))),new Z.default({geometry:e.geometry,symbol:r,attributes:e.attributes})})(e,t);case"polyline":return((e,t)=>{var i,s,o,n;const a=e.layer;let r,l,d,h;if(r=4,null==a?void 0:a.renderer)if(null===(i=a.renderer.symbol)||void 0===i?void 0:i.hasOwnProperty("width"))r=a.renderer.symbol.width;else if((null===(o=null===(s=a.renderer)||void 0===s?void 0:s.infos)||void 0===o?void 0:o.length)>0)for(h=0;h<a.renderer.infos.length;h++)a.typeIdField?l=e.attributes[a.typeIdField]:a.renderer.attributeField&&(l=e.attributes[a.renderer.attributeField]),d=a.renderer.infos[h].value,null!=l&&""!==l&&null!=d&&""!==d&&l.toString()===d.toString()&&a.renderer.infos[h].symbol.hasOwnProperty("width")&&(r=a.renderer.infos[h].symbol.width);else(null===(n=a.renderer.defaultSymbol)||void 0===n?void 0:n.hasOwnProperty("width"))&&(r=a.renderer.defaultSymbol.width);const c={type:"simple-line",color:t||"#00FFFF",width:4,style:"solid",outline:{color:"#00FFFF",width:r}};return new Z.default({geometry:e.geometry,symbol:c,attributes:e.attributes})})(e,t);case"polygon":return((e,t)=>{const i={type:"simple-fill",color:[0,255,255,0],style:"solid",outline:{color:t||"#00FFFF",width:2}};return new Z.default({geometry:e.geometry,symbol:i,attributes:e.attributes})})(e,t)}})(o,"#FFFF00"))})),!0}))})),t.length>0&&(this.props.intersectionHighlightLayer.removeAll(),this.props.intersectionHighlightLayer.addMany(t))}},this.configureTooltipCursorPosition=e=>{const{xAxis:t,yAxis:i,chart:s}=e,{am4core:o}=e.amCharts4Index,n=this.getFontSize(),a=s.tooltip;a.label.fontSize=n+3,a.label.padding(4,4,4,4),a.background.padding(0,0,0,0),a.background.cornerRadius=0,a.background.stroke=null,a.background.fill=o.color(this.props.theme.colors.white),a.label.fill=o.color(this.props.theme.colors.black);const r=new e.amCharts4Index.am4charts.XYCursor;r.trackable=!0,r.behavior="zoomXY",r.events.on("cursorpositionchanged",(e=>{var o,n,a,l,d;this.props.intersectionHighlightLayer.removeAll();const h=t.toAxisPosition(r.xPosition),c=t.positionToValue(h),p=this.getNearestElevationData(c);if(p){let e=r.xPosition;if(null!=this.props.profileResult.statistics){const i=this.props.profileResult;let{maxDistance:s}=i.statistics;if(null!=s){s=R(s,i.effectiveUnits.distance,this.props.selectedLinearUnit);const o=this.isRTL?1-r.xPosition:r.xPosition;e=this.positionRelativeToData(o,t.minZoomed,t.maxZoomed,0,s)}}this.props.isFlip?this.props.highlightChartPositionOnMap(1-e):this.props.highlightChartPositionOnMap(e);let h=null;const c=i.measuredHeight,u=c+s.pixelPaddingTop,g=this.yAxis.numberFormatter.format(p.y,5);let v="";this.chartSeries.isHiding||this.chartSeries.isHidden||(h=p.y,v+='<div style="display:inline-block; margin: 3px 0px 3px 0px; height: 2px; width:15px; background-color:'+this.chartSeries.stroke.hex+';"></div> '+this.chartSeries.name+":  <b>"+g+"</b> <br/>");const f=this.yAxis.numberFormatter.format(p.esriCTViewY,5);this.props.profileResult.lines.length>1&&this.props.showVolumetricObj&&"3d"===this.props.mapView.view.type&&((null===(o=this.volumetricObjLineSeries)||void 0===o?void 0:o.isHiding)||(null===(n=this.volumetricObjLineSeries)||void 0===n?void 0:n.isHidden)||(h=p.esriCTViewY,v+='<div style="display:inline-block; margin: 3px 0px 3px 0px; height: 2px; width:15px; background-color:'+this.volumetricObjLineSeries.stroke.hex+';"></div> '+this.volumetricObjLineSeries.name+":  <b>"+f+"</b> <br/>"));const m=this.seriesKey&&this.seriesKey[p.pointIdx]?this.seriesKey[p.pointIdx]:null;if(null===(l=null===(a=this.chart)||void 0===a?void 0:a.series)||void 0===l||l.values.forEach((e=>{if(e.dataFields.valueY===m&&!e.isHiding&&!e.isHidden){const t=this.yAxis.numberFormatter.format(p[m],5);return(null===h||h<p[m])&&(h=p[m]),v+='<div style="display:inline-block; margin: 3px 0px 3px 0px; height: 2px; width:15px; background-color:'+e.stroke.hex+';"></div> '+e.name+":  <b>"+t+"</b> <br/>",!0}})),null!==this.intersectionSeriesKeyIndex[p.pointIdx]){const e=null===(d=this.intersectionSeriesKey)||void 0===d?void 0:d[this.intersectionSeriesKeyIndex[p.pointIdx]],t={},i=[];e&&Object.keys(e).forEach((s=>{e[s].forEach((e=>{var s,o;null===(o=null===(s=this.chart)||void 0===s?void 0:s.series)||void 0===o||o.values.some((s=>{if(s.dataFields.valueY===e.seriesId&&!s.isHiding&&!s.isHidden&&void 0!==p[e.seriesId]){let o=this.yAxis.numberFormatter.format(p[e.seriesId],5);const n=e.layerId+e.featureIndex+o;return i.includes(n)||(i.push(n),t[e.layerId]||(t[e.layerId]=[]),t[e.layerId].includes(e.featureIndex)||t[e.layerId].push(e.featureIndex),(null===h||h<p[e.seriesId])&&(h=p[e.seriesId]),e.hasOwnProperty("y2")&&(o=this.yAxis.numberFormatter.format(e.value,5),o=o+" | "+this.yAxis.numberFormatter.format(e.y2,5)),e.displayField?v+='<div style="display:inline-block; '+e.assetStyle+'"></div> '+s.name+" ("+e.displayField+"):  <b>"+o+"</b> <br/>":v+='<div style="display:inline-block; '+e.assetStyle+'"></div> '+s.name+":  <b>"+o+"</b> <br/>"),!0}}))}))})),this.highlightIntersectionsOnMap(t)}if(""!==v&&this.yAxis.min<=h){s.tooltip.html=v;const e={x:r.point.x+r.parent.pixelX+s.pixelPaddingLeft,y:u-i.valueToPosition(h)*c-1};s.tooltip.pointTo(e,!0),s.tooltip.show()}}})),s.events.on("out",(()=>{this.props.intersectionHighlightLayer.removeAll(),s.tooltip.hide(),this.hideChartPosition()})),s.cursor=r},this.positionRelativeToData=(e,t,i,s,o)=>(t+e*(i-t)-s)/(o-s),this.addGroundSeries=e=>{const{chart:t,groundColor:i,am4charts:s}=e,{am4core:o}=e.amCharts4Index,n=t.series.push(new s.LineSeries);this.chartSeries=n,this.props.chartInfo(this.chart),n.dataFields.valueY="y",n.dataFields.valueX="x",n.name=this.nls("groundElevation"),n.stroke=o.color(i),n.fill=o.color(i),n.strokeWidth=1.5,n.fillOpacity=.1},this.addVolumetricObjLineSeries=e=>{const{chart:t,am4charts:i}=e,{am4core:s}=e.amCharts4Index,o=t.series.push(new i.LineSeries);this.props.chartInfo(this.chart),o.dataFields.valueY="esriCTViewY",o.dataFields.valueX="x",o.name=this.props.volumetricObjLabel?this.props.volumetricObjLabel:this.nls("volumetricObj"),o.stroke=s.color(this.props.volumetricObjLineColor),o.fill=s.color(this.props.volumetricObjLineColor),o.strokeWidth=1.5,o.fillOpacity=.1,this.volumetricObjLineSeries=o,this.groundExportingInfo.esriCTViewY=o.name+" "+this.nls("elevationLabel")+" ("+this.props.selectedElevationUnit+")"},this.getDistanceOfIntersectingPointOnLine=(e,t)=>{var i;if(e&&(null===(i=null==t?void 0:t.paths)||void 0===i?void 0:i.length)>0){const i=B.default.nearestCoordinate(t,e).coordinate,s=[];let o=0;t.paths.forEach((e=>{e.forEach(((i,n)=>{if(0!==n){const a=[[N.default.clone(e[n-1]),N.default.clone(i)]];s[o++]=new G.default({hasZ:t.hasZ,hasM:t.hasM,paths:a,spatialReference:t.spatialReference.toJSON()})}}))}));const n=[];s.forEach((e=>{n.push(this.getLengthAsPerMapProjection(e,this.props.selectedLinearUnit))}));let a=0,r=-1;return s.some(((e,s)=>{if(B.default.intersects(e,i)){const s=e.getPoint(0,0),o={paths:[[[s.x,s.y],[i.x,i.y]]],spatialReference:t.spatialReference},n=new G.default(o);return r=a+this.getLengthAsPerMapProjection(n,this.props.selectedLinearUnit),!0}a+=n[s]})),r}return-1},this.createDataForIntersectingAssets=e=>K(this,void 0,void 0,(function*(){var t,i,s,o,n,a;if(this.props.currentConfig){if(((null===(t=this.props.currentConfig)||void 0===t?void 0:t.hasOwnProperty("advanceOptions"))&&(null===(i=this.props.currentConfig)||void 0===i?void 0:i.advanceOptions)||(null===(o=null===(s=this.props.currentConfig)||void 0===s?void 0:s.assetSettings)||void 0===o?void 0:o.hasOwnProperty("isAssetSettingsEnabled"))&&(null===(n=this.props.currentConfig.assetSettings)||void 0===n?void 0:n.isAssetSettingsEnabled))&&(null===(a=this.props.assetIntersectionResult)||void 0===a?void 0:a.length)>0){const t=new Promise((t=>{this.intersectionSeriesKey={},this.props.assetIntersectionResult.forEach((t=>{var i,s,o,n;if((null===(i=null==t?void 0:t.settings)||void 0===i?void 0:i.elevationSettings)&&(null===(s=t.intersectionResult)||void 0===s?void 0:s.length)>0){const i=null===(n=null===(o=null==t?void 0:t.intersectionResult[0].intersectingFeature)||void 0===o?void 0:o.geometry)||void 0===n?void 0:n.type;"point"===i?this.createElevationDataForIntersectingPointLayer(t,e):"polyline"===i&&this.createElevationDataForIntersectingLineLayer(t,e)}})),t(e)}));return t}yield Promise.resolve()}})),this.createElevationDataForIntersectingPointLayer=(e,t)=>{var i;const s=e.settings.layerId,o=null===(i=null==e?void 0:e.settings)||void 0===i?void 0:i.elevationSettings,n=H.default.getMetersPerUnitForSR(new W.default(this.props.mapView.view.spatialReference.toJSON()));null==e||e.intersectionResult.forEach(((i,a)=>{var r,l,d,h,c,p;const u=this.getDistanceOfIntersectingPointOnLine(i.intersectingFeature.geometry,e.inputGeometry);let g;const v=i.intersectingFeature,f=(null===(r=null==e?void 0:e.settings)||void 0===r?void 0:r.displayField)?i.record.getFormattedFieldValue(null===(l=null==e?void 0:e.settings)||void 0===l?void 0:l.displayField,this.props.intl):void 0,m=null===(h=null===(d=null==e?void 0:e.settings)||void 0===d?void 0:d.style)||void 0===h?void 0:h.intersectingAssetShape,y=null===(p=null===(c=null==e?void 0:e.settings)||void 0===c?void 0:c.style)||void 0===p?void 0:p.intersectingAssetColor;let S=m;S||(S="circle");let b,x="";switch(S){case"rectangle":x+="margin: 0px 3px 0px 3px; height: 7px; width: 15px; background-color: "+y+";";break;case"circle":x+="margin: 0px 3px 0px 3px; height: 10px; width: 10px; background-color: "+y+"; border-radius: 50%;";break;case"square":x+="margin: 0px 3px 0px 3px; height: 10px; width: 10px; background-color: "+y+";";break;case"triangle":x+="margin: 0px 3px 0px 3px; width: 0; height: 0; border:5px solid transparent; border-bottom: 10px solid "+y+";"}"z"===o.type?(g=i.intersectingFeature.geometry.z*n,g=R(g,J,this.props.selectedElevationUnit)):"one"===o.type&&o.field1&&null!==v.attributes[o.field1]?(g=v.attributes[o.field1],o.unit&&o.unit!==this.props.selectedElevationUnit&&(g=R(g,o.unit,this.props.selectedElevationUnit))):"two"===o.type&&o.field1&&o.field2&&null!==v.attributes[o.field1]&&null!==v.attributes[o.field2]&&(g=v.attributes[o.field1],o.unit&&o.unit!==this.props.selectedElevationUnit&&(g=R(g,o.unit,this.props.selectedElevationUnit)),b=v.attributes[o.field2],o.unit&&o.unit!==this.props.selectedElevationUnit&&(b=R(b,o.unit,this.props.selectedElevationUnit)));const w=t.filter((e=>e.x>=u));let L;if(w.length<1){const e=t.length;t[e-1].x<u&&(L=t[e-1])}else null==w||w.some((e=>(L=e,!0)));const C=s+a+"y",I=s+a+"y2";L&&(L[C]=void 0===g?L.y:g,"two"===o.type?(L[I]=void 0===b?L.y:b,this.updateMinMaxForIntersectionProfile({pointIndex:L.pointIdx,layerId:s,seriesID:I,newValue:L[C],newValue2:L[I],displayField:f,assetShapeStyle:x,featureIndex:a})):this.updateMinMaxForIntersectionProfile({pointIndex:L.pointIdx,layerId:s,seriesID:C,newValue:L[C],newValue2:void 0,displayField:f,assetShapeStyle:x,featureIndex:a}))}))},this._getElevationValueForPointOnLineGeometry=(e,t,i)=>{let s;const o=this.getDistanceOfIntersectingPointOnLine(t,i.geometry),n=this.getLengthAsPerMapProjection(i.geometry,this.props.selectedLinearUnit),a=H.default.getMetersPerUnitForSR(new W.default(this.props.mapView.view.spatialReference.toJSON()));if("z"===e.type)s=t.z*a,s=R(s,J,this.props.selectedElevationUnit);else if("one"===e.type&&e.field1&&null!==i.attributes[e.field1])s=i.attributes[e.field1],e.unit&&e.unit!==this.props.selectedElevationUnit&&(s=R(s,e.unit,this.props.selectedElevationUnit));else if("two"===e.type&&e.field1&&e.field2&&null!==i.attributes[e.field1]&&null!==i.attributes[e.field2]){let t=i.attributes[e.field1];e.unit&&e.unit!==this.props.selectedElevationUnit&&(t=R(t,e.unit,this.props.selectedElevationUnit));let a=i.attributes[e.field2];e.unit&&e.unit!==this.props.selectedElevationUnit&&(a=R(a,e.unit,this.props.selectedElevationUnit)),s=t+(a-t)/n*o}return s},this.createElevationDataForIntersectingLineLayer=(e,i)=>{const s=e.settings.elevationSettings,o=e.settings.layerId,n=i.length;null==e||e.intersectionResult.forEach(((a,r)=>{var l,d,h,c;const p=a.intersectingFeature,u=(null===(l=null==e?void 0:e.settings)||void 0===l?void 0:l.displayField)?a.record.getFormattedFieldValue(null===(d=null==e?void 0:e.settings)||void 0===d?void 0:d.displayField,this.props.intl):void 0,g="margin: 3px 0px 3px 0px; height: 2px; width:15px; background-color:"+(null===(c=null===(h=null==e?void 0:e.settings)||void 0===h?void 0:h.style)||void 0===c?void 0:c.intersectingAssetColor)+";";a.connectedFeatureForProfiling.forEach((a=>{let l=[],d=[];const h=[],c=[];a.paths.forEach(((a,v)=>{d=[],l=[],h[v]=[],c[v]=[];const f=o+"y_I_"+r+"_"+v,m=o+"y-point_"+r+"_"+v;a.forEach(((a,y)=>{const S=new _.default(a),b=B.default.nearestCoordinate(e.inputGeometry,S).coordinate;let x=this.getDistanceOfIntersectingPointOnLine(b,e.inputGeometry);const w=this._getElevationValueForPointOnLineGeometry(s,S,p);if(l.push(w),d.push(x),0!==y){let e=d[y-1],s=w,a=l[y-1];x<e&&(e+=x,x=e-x,e-=x,s=l[y-1],a=w);const p=x-e,S=N.default.clone(e);e+=p;let b=i.filter((t=>t.x>=S&&t.x<e));if(0===b.length&&(0===e&&n>0?b=[i[0]]:(b=i.filter((t=>t.x<e)),b.length>0&&(b=[b[b.length-1]]))),b.length>1){if(void 0===s||void 0===a)b.forEach((e=>{e[f]=e.y,this.updateMinMaxForIntersectionProfile({pointIndex:e.pointIdx,layerId:o,seriesID:f,newValue:e.y,newValue2:void 0,displayField:u,assetShapeStyle:g,featureIndex:r})}));else{const e=(s-a)/p;b.forEach((t=>{let i=0;i=t.x-S;const s=a+e*i;t[f]=s,this.updateMinMaxForIntersectionProfile({pointIndex:t.pointIdx,layerId:o,seriesID:f,newValue:s,newValue2:void 0,displayField:u,assetShapeStyle:g,featureIndex:r})}))}h[v].push([b[0],b[b.length-1]]),c[v].push([a,s])}else if(1===b.length){let e=!1;h[v].length>0&&h[v].some((i=>{if(t.lodash.isDeepEqual(b,i))return e=!0,!0})),e||(h[v].push([b[0]]),c[v].push([a]))}else if(0===b.length){let t;i[n-1].x<e&&(t=i[n-1],void 0===s&&(s=t.y),t[m]=s,this.updateMinMaxForIntersectionProfile({pointIndex:t.pointIdx,layerId:o,seriesID:m,newValue:s,newValue2:void 0,displayField:u,assetShapeStyle:g,featureIndex:r})),h[v].push([]),c[v].push([])}}}))})),h.forEach(((e,t)=>{const i=o+"y_I_"+r+"_"+t,s=o+"y-point_"+r+"_"+t;let n=0;if(e.forEach((e=>{n+=e.length})),n>1)e.forEach(((e,s)=>{if(e.length>0){let n,a;1===e.length&&(a=c[t][s][0],n=e[0],void 0===a&&(a=n.y),n[i]=a,this.updateMinMaxForIntersectionProfile({pointIndex:n.pointIdx,layerId:o,seriesID:i,newValue:a,newValue2:void 0,displayField:u,assetShapeStyle:g,featureIndex:r}))}}));else if(1===n){let i,n;e.some(((e,a)=>{if(e.length>0&&e[0])return i=e[0],n=c[t][a][0],void 0===n&&(n=i.y),i[s]=n,this.updateMinMaxForIntersectionProfile({pointIndex:i.pointIdx,layerId:o,seriesID:s,newValue:n,newValue2:void 0,displayField:u,assetShapeStyle:g,featureIndex:r}),!0}))}}))})),a.disconnectedFeatureForProfiling.forEach(((t,n)=>{const a=this._getElevationValueForPointOnLineGeometry(s,t,p),l=this.getDistanceOfIntersectingPointOnLine(t,e.inputGeometry),d=i.filter((e=>e.x>=l));let h;const c=o+"y-point_"+r+"_"+n+"_d";if(d.length<1){const e=i.length;i[e-1].x<l&&(h=i[e-1])}else null==d||d.some((e=>{if(!e.hasOwnProperty(c))return h=e,!0}));h&&(h[c]=void 0===a?h.y:a,this.updateMinMaxForIntersectionProfile({pointIndex:h.pointIdx,layerId:o,seriesID:c,newValue:h[c],newValue2:void 0,displayField:u,assetShapeStyle:g,featureIndex:r}))}))}))},this.createDataForProfileLines=e=>K(this,void 0,void 0,(function*(){if(this.canShowProfileSettingsForBackward(this.props.currentConfig)){const t=this.checkForProfileSettings();if(t.length>0)return new Promise(((i,s)=>{this.getDistanceOfAllSelectedFeatures().then((s=>{t.forEach((t=>{let i=0;this.props.drawingLayer.graphics.forEach(((o,n)=>K(this,void 0,void 0,(function*(){const a=o.attributes.esriCTFeatureLayerId,r=this.getConfiguredSettingsForLine(a);if((null==r?void 0:r.elevationSettings)&&a===t){const t=s[n],a=N.default.clone(i);i+=t;const l=e.filter((e=>e.x>=a&&e.x<=i));this.addElevationForSelectedFeature(r.elevationSettings,o,t,l,a)}else i+=s[n]}))))})),i(e)}))}));yield Promise.resolve()}else yield Promise.resolve()})),this.getLengthAsPerMapProjection=(e,t)=>this.props.mapView.view.spatialReference.isWebMercator||this.props.mapView.view.spatialReference.isGeographic?B.default.geodesicLength(e,t):B.default.planarLength(e,t),this.getDistanceAsPerMapProjection=(e,t)=>this.props.mapView.view.spatialReference.isWebMercator||this.props.mapView.view.spatialReference.isGeographic?z.default.geodesicLength(e,t):z.default.planarLength(e,t),this.getConfiguredSettingsForLine=e=>this.updatedProfileLayers.find((t=>t.layerId===e)),this.getDistanceAsPerConfiguredFieldAndUnits=(e,t)=>{const i=t.attributes[e.field];return isNaN(Number(i))?0:R(i,e.unit,this.props.selectedLinearUnit)},this.updateMinMaxForIntersectionProfile=e=>{let t=e.newValue,i=e.newValue;this.intersectionSeriesKey[e.pointIndex]||(this.intersectionSeriesKey[e.pointIndex]={}),this.intersectionSeriesKeyIndex[e.pointIndex]=e.pointIndex;const s={seriesId:e.seriesID,value:e.newValue,assetStyle:e.assetShapeStyle,featureIndex:e.featureIndex,layerId:e.layerId};void 0!==e.newValue2&&(s.y2=e.newValue2,i<e.newValue2&&(i=e.newValue2),t>e.newValue2&&(t=e.newValue2)),void 0!==e.displayField&&null!==e.displayField&&(s.displayField=e.displayField),this.intersectionSeriesKey[e.pointIndex][e.layerId]||(this.intersectionSeriesKey[e.pointIndex][e.layerId]=[]),this.intersectionSeriesKey[e.pointIndex][e.layerId].push(s),this.minMaxOfEachProfile[e.layerId]?this.minMaxOfEachProfile[e.layerId]&&(this.minMaxOfEachProfile[e.layerId].min>t&&(this.minMaxOfEachProfile[e.layerId].min=t),this.minMaxOfEachProfile[e.layerId].max<i&&(this.minMaxOfEachProfile[e.layerId].max=i)):this.minMaxOfEachProfile[e.layerId]={min:t,max:i}},this.updateMinMaxForProfile=(e,t,i)=>{this.seriesKey[e]=t+"y",this.seriesValue[e]=i,this.intersectionSeriesKeyIndex[e]=null,this.minMaxOfEachProfile[t]?this.minMaxOfEachProfile[t]&&(this.minMaxOfEachProfile[t].min>i&&(this.minMaxOfEachProfile[t].min=i),this.minMaxOfEachProfile[t].max<i&&(this.minMaxOfEachProfile[t].max=i)):this.minMaxOfEachProfile[t]={min:i,max:i}},this.addElevationForSelectedFeature=(e,t,i,s,o)=>{var n,a;let r,l;const d=t.attributes.esriCTFeatureLayerId;if("one"===e.type&&e.field1&&null!==t.attributes[e.field1])r=t.attributes[e.field1],e.unit&&e.unit!==this.props.selectedElevationUnit&&(r=R(r,e.unit,this.props.selectedElevationUnit)),s.forEach((e=>{e[d+"y"]=r,e.layerName=d,this.updateMinMaxForProfile(e.pointIdx,d,r)}));else if("two"===e.type&&e.field1&&e.field2&&null!==t.attributes[e.field1]&&null!==t.attributes[e.field2]){r=t.attributes[e.field1],e.unit&&e.unit!==this.props.selectedElevationUnit&&(r=R(r,e.unit,this.props.selectedElevationUnit)),l=t.attributes[e.field2],e.unit&&e.unit!==this.props.selectedElevationUnit&&(l=R(l,e.unit,this.props.selectedElevationUnit));const n=(l-r)/i;s.forEach((e=>{let t=0;t=e.x-o;const i=r+n*t;e[d+"y"]=i,e.layerName=d,this.updateMinMaxForProfile(e.pointIdx,d,i)}))}else if("z"===e.type&&t.geometry.hasZ){const e=t.geometry;if((null===(n=e.paths)||void 0===n?void 0:n.length)>0){const t=[];let i=0;e.paths.forEach((s=>{s.forEach(((o,n)=>{if(0!==n){const a=[[N.default.clone(s[n-1]),N.default.clone(o)]];t[i++]=new G.default({hasZ:e.hasZ,hasM:e.hasM,paths:a,spatialReference:e.spatialReference.toJSON()})}}))}));const o=H.default.getMetersPerUnitForSR(new W.default(this.props.mapView.view.spatialReference.toJSON()));let n=null===(a=s[0])||void 0===a?void 0:a.x;const r=this.props.drawingLayer.elevationInfo;t.forEach(((e,i)=>{const a=this.getLengthAsPerMapProjection(e,this.props.selectedLinearUnit),l=t[i].paths[0][0][2]*o,h=t[i].paths[0][1][2]*o,c=s.filter((e=>e.x>=n&&e.x<=n+a));let p=R(l,J,this.props.selectedElevationUnit),u=R(h,J,this.props.selectedElevationUnit);"3d"===this.props.mapView.view.type&&r&&(null==c?void 0:c.length)>0&&("relative-to-ground"!==r.mode&&"relative-to-scene"!==r.mode||(p+=c[0].y,u+=c[c.length-1].y));const g=(u-p)/a;c.forEach((e=>{if(!e[d+"y"]){let t=0;t=e.x-n;let i=p+g*t;"3d"===this.props.mapView.view.type&&"on-the-ground"===(null==r?void 0:r.mode)&&(i=e.y),e[d+"y"]=i,e.layerName=d,this.updateMinMaxForProfile(e.pointIdx,d,i)}})),n+=a}))}}else e.type&&s.forEach((e=>{e[d+"y"]=e.y,e.layerName=d,this.updateMinMaxForProfile(e.pointIdx,d,e.y)}))},this.getDistanceOfAllSelectedFeatures=()=>{const e=[];return this.props.drawingLayer.graphics.forEach((t=>{e.push(this.getDistanceAsPerMapProjection(t.geometry,this.props.selectedLinearUnit))})),Promise.all(e)},this.addLineSeries=(e,t)=>{let i=null,s="";const o=this.props.mapView.view.map.layers.toArray(),n=A(this.props.activeDs);if(this.updatedProfileLayers.length>0&&(i=this.updatedProfileLayers.filter((t=>t.layerId===e)),null==n||n.forEach((e=>{o.forEach((t=>{const o=t;"group"===o.type?o.layers.toArray().forEach((t=>{t.id===e.jimuChildId&&i.forEach((i=>{i.layerId===e.id&&(s=t.title)}))})):"feature"===o.type&&t.id===e.jimuChildId&&i.forEach((i=>{i.layerId===e.id&&(s=t.title)}))}))}))),1===(null==i?void 0:i.length)){const{chart:o,am4charts:n}=t,{am4core:a}=t.amCharts4Index,r=o.series.push(new n.LineSeries);r.dataFields.valueY=e+"y",r.dataFields.valueX="x",r.name=s,r.stroke=a.color(i[0].style.lineColor),r.strokeWidth=i[0].style.lineThickness,r.connect=!1,"dotted-line"===i[0].style.lineType?r.strokeDasharray="2 , 4":"dashed-line"===i[0].style.lineType&&(r.strokeDasharray="8 , 4"),this.groundExportingInfo[e+"y"]=s+" "+this.nls("elevationLabel")+" ("+this.props.selectedElevationUnit+")"}},this.getDisplayFieldAlias=(e,i)=>{var s,o;const n=t.DataSourceManager.getInstance().getDataSource(e),a=null===(s=null==n?void 0:n.getSchema())||void 0===s?void 0:s.fields;return(null===(o=null==a?void 0:a[i])||void 0===o?void 0:o.alias)||i},this.createPointSeriesForIntersectingLines=(e,t,i,s,o)=>{const{chart:n,am4charts:a}=e,{am4core:r}=e.amCharts4Index,l=n.series.push(new a.XYSeries);l.dataFields.valueY=t.layerId+"y-point_"+s+"_"+o,l.dataFields.valueX="x",l.name=i,l.stroke=r.color(t.style.intersectingAssetColor),l.hiddenInLegend=!0;const d=l.bullets.push(new a.Bullet);d.stroke=r.color(t.style.intersectingAssetColor),d.fill=r.color(t.style.intersectingAssetColor);const h=d.createChild(r.Rectangle);return h.width=t.style.intersectingAssetSize?t.style.intersectingAssetSize:6,h.height=t.style.intersectingAssetSize?t.style.intersectingAssetSize:6,h.horizontalCenter="middle",h.verticalCenter="middle",l},this.createSeriesForIntersectingLines=(e,t,i,s,o)=>{const{chart:n,am4charts:a}=e,{am4core:r}=e.amCharts4Index,l=n.series.push(new a.LineSeries);l.dataFields.valueY=t.layerId+"y_I_"+s+"_"+o,l.dataFields.valueX="x",l.name=i,l.stroke=r.color(t.style.intersectingAssetColor),l.strokeWidth=t.style.intersectingAssetSize?t.style.intersectingAssetSize:4,"dotted-line"===t.style.intersectingAssetShape?l.strokeDasharray="2 , 4":"dashed-line"===t.style.intersectingAssetShape&&(l.strokeDasharray="8 , 4");const d=this.createPointSeriesForIntersectingLines(e,t,i,s,o);return l.events.on("hidden",(function(){d.hide(),l.hide()})),l.events.on("shown",(function(){d.show(),l.show()})),l},this.addIntersectingLineSeries=(e,t)=>{const i=null==e?void 0:e.title,s=null==e?void 0:e.settings,o=[];s&&i&&(null==e||e.intersectionResult.forEach(((e,n)=>{e.connectedFeatureForProfiling.forEach((e=>{e.paths.forEach(((e,a)=>{const r=this.createSeriesForIntersectingLines(t,s,i,n,a);o.length>0&&(r.hiddenInLegend=!0),o.push(r)}))})),e.disconnectedFeatureForProfiling.forEach(((e,a)=>{const r=this.createSeriesForIntersectingLines(t,s,i,n,a+"_d");o.length>0&&(r.hiddenInLegend=!0),o.push(r)}))})),this.intersectingLayersExportingInfo[s.layerId]={xCoordinate:"X",yCoordinate:"Y",x:this.nls("distanceLabel")+" ("+this.props.selectedLinearUnit+")",intersectingLayerY:this.nls("elevationLabel")+" ("+this.props.selectedElevationUnit+")",layerName:i,intersectingLayerDisplayField:this.getDisplayFieldAlias(s.layerId,s.displayField)},o[0].events.on("shown",(function(){o.forEach((e=>{e.show()}))})),o[0].events.on("hidden",(function(){o.forEach((e=>{e.hide()}))})))},this.addPointSeries=(e,t)=>{const i=null==e?void 0:e.title,s=null==e?void 0:e.settings,o=[];if(s&&i){const{chart:n,am4charts:a}=t,{am4core:r}=t.amCharts4Index;for(let l=0;l<e.intersectionResult.length;l++){let e;"two"===s.elevationSettings.type?(e=n.series.push(new a.ColumnSeries),e.name=i,e.dataFields.valueX="x",e.dataFields.openValueY=s.layerId+l+"y",e.dataFields.valueY=s.layerId+l+"y2",e.sequencedInterpolation=!0,e.fill=r.color(s.style.intersectingAssetColor),e.stroke=r.color(s.style.intersectingAssetColor),e.columns.template.width=1,this.createBulletsForDumbbellPlotSeries(t,e,s).locationY=1,this.createBulletsForPointSeries(t,e,s).locationY=.5,this.createBulletsForDumbbellPlotSeries(t,e,s)):(e=n.series.push(new a.XYSeries),e.dataFields.valueY=s.layerId+l+"y",e.dataFields.valueX="x",e.stroke=r.color(s.style.intersectingAssetColor),e.name=i,this.createBulletsForPointSeries(t,e,s)),e.hiddenInLegend=!0,o.push(e)}const l=n.series.push(new a.LineSeries);l.dataFields.valueY=s.layerId+"y-linePoint",l.dataFields.valueX="x",l.name=i,l.connect=!1,l.strokeWidth=1,l.strokeOpacity=0,l.stroke=r.color(s.style.intersectingAssetColor),this.createBulletsForPointSeries(t,l,s,!0),l.events.on("hidden",(function(){o.forEach((e=>{e.hide()})),l.hide()})),l.events.on("shown",(function(){o.forEach((e=>{e.show()})),l.show()}));const d=this.getDisplayFieldAlias(s.layerId,s.displayField);"two"===s.elevationSettings.type?this.intersectingLayersExportingInfo[s.layerId]={xCoordinate:"X",yCoordinate:"Y",x:this.nls("distanceLabel")+" ("+this.props.selectedLinearUnit+")",intersectingLayerY:this.nls("oneFieldLabelForExport")+" "+this.nls("elevationLabel")+" ("+this.props.selectedElevationUnit+")",intersectingLayerY2:this.nls("twoFieldLabelForExport")+" "+this.nls("elevationLabel")+" ("+this.props.selectedElevationUnit+")",layerName:i,intersectingLayerDisplayField:d}:this.intersectingLayersExportingInfo[s.layerId]={xCoordinate:"X",yCoordinate:"Y",x:this.nls("distanceLabel")+" ("+this.props.selectedLinearUnit+")",intersectingLayerY:this.nls("elevationLabel")+" ("+this.props.selectedElevationUnit+")",layerName:i,intersectingLayerDisplayField:d}}},this.createBulletsForPointSeries=(e,t,i,s)=>{const{am4charts:o}=e,{am4core:n}=e.amCharts4Index,a=t.bullets.push(new o.Bullet);let r=i.style.intersectingAssetSize?i.style.intersectingAssetSize:6;switch(s&&r>10&&(r=10),a.stroke=n.color(i.style.intersectingAssetColor),a.fill=n.color(i.style.intersectingAssetColor),a.states.create("hover").properties.scale=1.3,i.style.intersectingAssetShape){case"rectangle":const e=a.createChild(n.Rectangle);e.width=r,e.height=r/2,e.horizontalCenter="middle",e.verticalCenter="middle";break;case"square":const t=a.createChild(n.Rectangle);t.width=r,t.height=r,t.horizontalCenter="middle",t.verticalCenter="middle";break;case"triangle":const i=a.createChild(n.Triangle);i.width=r,i.height=r,i.horizontalCenter="middle",i.verticalCenter="middle";break;default:a.createChild(n.Circle).radius=r}return a},this.createBulletsForDumbbellPlotSeries=(e,t,i)=>{const{am4charts:s}=e,{am4core:o}=e.amCharts4Index,n=t.bullets.push(new s.Bullet);n.stroke=o.color(i.style.intersectingAssetColor),n.fill=o.color(i.style.intersectingAssetColor);const a=n.createChild(o.Rectangle),r=i.style.intersectingAssetSize?i.style.intersectingAssetSize:6;return a.width="circle"===i.style.intersectingAssetShape?2*r:r+2,a.height=1,a.horizontalCenter="middle",a.verticalCenter="middle",n},this.displayChartLegend=e=>{const{chart:t,am4charts:i,isRTL:s}=e;t.legend=new i.Legend,t.legend.itemContainers.template.paddingTop=5,t.legend.itemContainers.template.marginBottom=0,t.legend.itemContainers.template.paddingBottom=0,t.legend.position="bottom",t.legend.contentAlign=s?"right":"left",t.legend.reverseOrder=s,t.legend.itemContainers.template.reverseOrder=s;const o=t.legend.markers.template;o.width=15,o.height=15,t.legend.itemContainers.template.events.on("hit",(e=>{this.props.toggleLegendSeriesState(e.target.dataItem.dataContext.isHidden,e.target.dataItem.dataContext.name)}))},this.makeFormatter=(e,t)=>{const i=e.numberFormatter.clone();return i.format=(e,i,s=2)=>"string"==typeof e?"":`${T.default.formatNumber(e,{maximumFractionDigits:s})} ${t}`,i},this.minMaxOfEachProfile={},this.allDistances=[],this.seriesKey=[],this.seriesValue=[],this.intersectionSeriesKey={},this.intersectionSeriesKeyIndex=[],this.groundExportingInfo={},this.intersectingLayersExportingInfo={};const a=(0,t.getAppStore)().getState();this.isRTL=null===(s=null==a?void 0:a.appContext)||void 0===s?void 0:s.isRTL,this.chart=null,this.amchart4=null,this.xAxis=null,this.yAxis=null,this.chartSeries=null,this.viewOutput=null,this.volumetricObjLineSeries=null,this.accessChartParams=null,this.updatedProfileLayers=null===(o=this.props.currentConfig)||void 0===o?void 0:o.profileSettings.layers,this.state={chartDefinition:null,showLegend:null===(n=this.props.commonGeneralSettings)||void 0===n?void 0:n.showLegend},this.props.profileResult&&this.createOrUpdateChartDefinition()}render(){return(0,t.jsx)(t.React.Fragment,null,this.state&&this.state.chartDefinition&&(0,t.jsx)("div",{tabIndex:-1,className:"w-100 h-100 p-2"},(0,t.jsx)("div",{tabIndex:0,"aria-label":this.nls("chartRender"),className:"w-100 h-100",ref:this._chartContainer})))}}const{epIcon:$}=b();class Q extends t.React.PureComponent{constructor(e){super(e),this.nls=e=>{const t=Object.assign({},l,i.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:t[e]}):t[e]},this.componentDidMount=()=>{this.generateStats()},this.generateStats=()=>{this.selectedStats=[],this.props.activeDsConfig.profileChartSettings.selectedStatistics.forEach((e=>{e.enabled&&this.selectedStats.push({label:e.label,name:e.name})})),this.selectedStatisticsDisplay()},this.componentDidUpdate=e=>{e.selectedElevationUnit===this.props.selectedElevationUnit&&e.selectedLinearUnit===this.props.selectedLinearUnit&&e.selectedStatsDisplay===this.props.selectedStatsDisplay&&e.isFlip===this.props.isFlip&&e.chartDataUpdateTime===this.props.chartDataUpdateTime||this.generateStats(),e.renderSeries!==this.props.renderSeries&&this.selectedStatisticsDisplay()},this.selectedStatisticsDisplay=()=>{const e=[];let s="",o=null,n="";this.selectedStats.forEach((a=>{var r,l;this.props.renderSeries||this.props.legendName!==this.props.toggledSeriesName?(n=a.name,this.props.chartProfileResult?(this.props.isFlip&&a.name!==C.AvgElevation&&a.name!==C.MaxDistance&&a.name!==C.MaxElevation&&a.name!==C.MinElevation&&(n=I(a.name)),o=null===(l=null===(r=this.props.chartProfileResult)||void 0===r?void 0:r.statistics)||void 0===l?void 0:l[n],s=this.getStatsValueWithUnit(o,n)):s=this.nls("noStatsValue")):s=this.nls("noStatsValue"),e.push((0,t.jsx)(t.React.Fragment,null,(0,t.jsx)("div",{tabIndex:0,className:"statistic-info"},(0,t.jsx)(i.Label,{id:this.props.parentWidgetId+this.props.index,"aria-label":this.nls(a.name),className:"statistic-label text-break mb-1 pt-3"},this.nls(a.name)),(0,t.jsx)("div",{tabIndex:0,"aria-label":s},s))))})),this.setState({statsResultList:e})},this.getStatsValueWithUnit=(e,t)=>{let i="",s=null;return x.forEach((o=>{var n,a;t===C.MaxDistance?o.value===this.props.selectedLinearUnit&&(s=R(e,null===(n=this.props.chartProfileResult)||void 0===n?void 0:n.effectiveUnits.distance,this.props.selectedLinearUnit),i=this.props.intl.formatNumber(s,{maximumFractionDigits:2})+" "+this.nls(o.abbreviation)):t===C.MaxPositiveSlope||t===C.MaxNegativeSlope||t===C.AvgPositiveSlope||t===C.AvgNegativeSlope?i=null===e?this.nls("noStatsValue"):this.props.intl.formatNumber(e,{maximumFractionDigits:2})+" ":o.value===this.props.selectedElevationUnit&&(s=R(e,null===(a=this.props.chartProfileResult)||void 0===a?void 0:a.effectiveUnits.elevation,this.props.selectedElevationUnit),i=this.props.intl.formatNumber(s,{maximumFractionDigits:2})+" "+this.nls(o.abbreviation))})),i},this.onExpandClick=()=>{this.setState({legendExpanded:!this.state.legendExpanded})},this.state={legendExpanded:!1,statsResultList:[]}}render(){return(0,t.jsx)("div",{tabIndex:-1},(0,t.jsx)("div",{tabIndex:-1,className:"ep-legend-section ep-shadow py-1"},(0,t.jsx)(r.SettingRow,{flow:"wrap"},(0,t.jsx)("div",{tabIndex:0,className:"d-flex justify-content-between w-100 align-items-center"},(0,t.jsx)(i.Label,{id:this.props.parentWidgetId+this.props.index,"aria-label":this.props.legendName,className:"w-100 legendLabel text-break"},this.props.legendName),!this.props.singleSeriesExpandStat&&(0,t.jsx)("div",{tabIndex:0,className:this.state.legendExpanded?"arrow-up":"arrow-down"},(0,t.jsx)(i.Button,{id:this.props.parentWidgetId+this.props.index,role:"button","aria-expanded":this.state.legendExpanded,title:this.nls("expandLegend"),className:"expand-collapse-button",type:"tertiary",icon:!0,size:"sm",onClick:this.onExpandClick.bind(this)},(0,t.jsx)(i.Icon,{icon:$.iconExpandCollapse,size:"10"}))))),(0,t.jsx)(i.Collapse,{isOpen:this.state.legendExpanded||this.props.singleSeriesExpandStat},(0,t.jsx)("div",{tabIndex:-1,className:"stat-content"},(0,t.jsx)("div",{tabIndex:0,className:"profile-statistics"},this.state.statsResultList.map(((e,i)=>(0,t.jsx)(t.React.Fragment,{key:i},e))))))))}}var ee=M(99395),te=M.n(ee);const{epIcon:ie}=b(),se=(0,t.getAppStore)().getState().portalSelf;class oe extends t.React.PureComponent{constructor(e){var s,o,a,r,d,h,c,p,u,g,v,f,m,y,S,b,w,L,C,I,E,M,D,V,j,k,U;super(e),this.selectableLayers=[],this.intersectingLayers=[],this.alertElement=t.React.createRef(),this.nls=e=>{const t=Object.assign({},l,i.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:t[e]}):t[e]},this.updateOutputStatistics=()=>{this.props.buildOutputStatistics(this.state.selectedElevationUnit,this.state.selectedLinearUnit,this.state.isFlipChart)},this.componentDidMount=()=>{this.getSelectableLayers(this.props.activeDataSource),this.getIntersectingLayers(this.props.activeDataSource),this.props.intersectingBufferRuntime({enabled:this.state.isBufferSelectorEnableInConfig,bufferDistance:this.state.selectedBufferDistance,bufferUnits:this.state.selectedBufferUnit,bufferSymbol:this.state.selectedBufferSymbol}),(this.props.selectMode||this.props.drawMode)&&setTimeout((()=>{var e,t;null===(t=null===(e=this.alertElement)||void 0===e?void 0:e.current)||void 0===t||t.focus()}),100)},this.componentDidUpdate=e=>{var i,s,o,n,a,r,l,d,h,c,p,u,g,v,f,m,y,S,b,x,w,L,C,I,E,M,D,A,P,O,V;const j=this.props.activeDatasourceConfig,R=e.activeDatasourceConfig,k=F(j,se);(e.commonDsGeneralSettings.showLegend!==(null===(i=this.props.commonDsGeneralSettings)||void 0===i?void 0:i.showLegend)||(null==R?void 0:R.profileChartSettings.displayStatistics)!==(null==j?void 0:j.profileChartSettings.displayStatistics)||e.chartDataUpdateTime!==this.props.chartDataUpdateTime||this.didStatisticsListChanged(null==R?void 0:R.profileChartSettings.selectedStatistics,null==j?void 0:j.profileChartSettings.selectedStatistics))&&(this.updateOutputStatistics(),this.setState({showLegend:null===(s=this.props.commonDsGeneralSettings)||void 0===s?void 0:s.showLegend,displayStats:null==j?void 0:j.profileChartSettings.displayStatistics,chartResult:this.props.profileResult,selectedStatisticsList:null==j?void 0:j.profileChartSettings.selectedStatistics},(()=>{this.state.displayStats&&this.props.profileResult||this.setState({statisticsOpen:!1}),this.displayStatisticsInfo(this.chart),this.exportOptionDisplay()}))),e.commonDsGeneralSettings.allowExport===(null===(o=this.props.commonDsGeneralSettings)||void 0===o?void 0:o.allowExport)&&e.chartDataUpdateTime===this.props.chartDataUpdateTime||this.setState({allowExport:null===(n=this.props.commonDsGeneralSettings)||void 0===n?void 0:n.allowExport,isExport:!1},(()=>{e.chartDataUpdateTime!==this.props.chartDataUpdateTime&&(this.setState({distanceInterval:this.getDefaultIntervalValue()}),this.showIntervalError(this.getDefaultIntervalValue()))})),e.noFeaturesFoundError!==this.props.noFeaturesFoundError&&this.setState({noFeaturesError:this.props.noFeaturesFoundError}),e.viewModelErrorState===this.props.viewModelErrorState&&e.profileErrorMsg===this.props.profileErrorMsg||this.setState({noValidInput:this.props.viewModelErrorState,viewModelErrorMsg:this.props.profileErrorMsg}),(null==R?void 0:R.profileChartSettings.elevationUnit)===(null==j?void 0:j.profileChartSettings.elevationUnit)&&(null==R?void 0:R.profileChartSettings.linearUnit)===(null==j?void 0:j.profileChartSettings.linearUnit)&&(null==R?void 0:R.advanceOptions)===(null==j?void 0:j.advanceOptions)&&(null===(a=null==R?void 0:R.profileSettings)||void 0===a?void 0:a.isProfileSettingsEnabled)===(null===(r=null==j?void 0:j.profileSettings)||void 0===r?void 0:r.isProfileSettingsEnabled)&&(null===(l=null==R?void 0:R.profileSettings)||void 0===l?void 0:l.isCustomizeOptionEnabled)===(null===(d=null==j?void 0:j.profileSettings)||void 0===d?void 0:d.isCustomizeOptionEnabled)&&(null===(h=null==R?void 0:R.assetSettings)||void 0===h?void 0:h.isAssetSettingsEnabled)===(null===(c=null==j?void 0:j.assetSettings)||void 0===c?void 0:c.isAssetSettingsEnabled)||this.setState({selectedElevationUnit:(null==j?void 0:j.profileChartSettings.elevationUnit)?j.profileChartSettings.elevationUnit:k[0],selectedLinearUnit:(null==j?void 0:j.profileChartSettings.linearUnit)?j.profileChartSettings.linearUnit:k[1],isProfileSettingsOptionEnabled:null==j?void 0:j.profileSettings.isProfileSettingsEnabled,isCustomizeOptionEnabled:null==j?void 0:j.profileSettings.isCustomizeOptionEnabled,isAssetSettingsOptionEnabled:null===(p=null==j?void 0:j.assetSettings)||void 0===p?void 0:p.isAssetSettingsEnabled,profileLayers:null==j?void 0:j.profileSettings.layers,intersectingLayers:null===(u=null==j?void 0:j.assetSettings)||void 0===u?void 0:u.layers},(()=>{this.updateOutputStatistics(),this.displayStatisticsInfo(this.chart),this.showIntervalError(this.getDefaultIntervalValue()),this.exportOptionDisplay(),this.getSelectableLayers(this.props.activeDataSource),this.getIntersectingLayers(this.props.activeDataSource)})),(null==R?void 0:R.profileChartSettings.showVolumetricObjLineInGraph)===(null==j?void 0:j.profileChartSettings.showVolumetricObjLineInGraph)&&(null==R?void 0:R.profileChartSettings.volumetricObjLineColor)===(null==j?void 0:j.profileChartSettings.volumetricObjLineColor)&&(null==R?void 0:R.profileChartSettings.volumetricObjLabel)===(null==j?void 0:j.profileChartSettings.volumetricObjLabel)||this.setState({showViewLineGraph:null==j?void 0:j.profileChartSettings.showVolumetricObjLineInGraph,volumetricObjLineColor:null==j?void 0:j.profileChartSettings.volumetricObjLineColor,volumetricObjLabel:null==j?void 0:j.profileChartSettings.volumetricObjLabel}),this.didProfileLayersSettingsChanged(null==R?void 0:R.profileSettings.layers,null==j?void 0:j.profileSettings.layers)&&this.setState({profileLayers:null==j?void 0:j.profileSettings.layers},(()=>{this.getSelectableLayers(this.props.activeDataSource)})),this.didIntersectingLayersSettingsChanged(null===(g=null==R?void 0:R.assetSettings)||void 0===g?void 0:g.layers,null===(v=null==j?void 0:j.assetSettings)||void 0===v?void 0:v.layers)&&this.setState({intersectingLayers:null===(f=null==j?void 0:j.assetSettings)||void 0===f?void 0:f.layers},(()=>{this.getIntersectingLayers(this.props.activeDataSource)})),(this.props.drawMode&&e.onDrawingComplete!==this.props.onDrawingComplete||e.isNewSegmentsForSelection!==this.props.isNewSegmentsForSelection||e.noGraphicAfterFirstSelection!==this.props.noGraphicAfterFirstSelection)&&this.setState({dismissInfoMsg:this.props.selectMode&&this.props.isNewSegmentsForSelection||this.props.drawMode&&!this.props.onDrawingComplete,dismissWarningMsg:!this.props.isNewSegmentsForSelection&&!this.props.noGraphicAfterFirstSelection&&this.props.selectMode}),(null===(y=null===(m=null==R?void 0:R.assetSettings)||void 0===m?void 0:m.assetIntersectingBuffer)||void 0===y?void 0:y.enabled)===(null===(b=null===(S=null==j?void 0:j.assetSettings)||void 0===S?void 0:S.assetIntersectingBuffer)||void 0===b?void 0:b.enabled)&&(null===(w=null===(x=null==R?void 0:R.assetSettings)||void 0===x?void 0:x.assetIntersectingBuffer)||void 0===w?void 0:w.bufferDistance)===(null===(C=null===(L=null==j?void 0:j.assetSettings)||void 0===L?void 0:L.assetIntersectingBuffer)||void 0===C?void 0:C.bufferDistance)&&(null===(E=null===(I=null==R?void 0:R.assetSettings)||void 0===I?void 0:I.assetIntersectingBuffer)||void 0===E?void 0:E.bufferUnits)===(null===(D=null===(M=null==j?void 0:j.assetSettings)||void 0===M?void 0:M.assetIntersectingBuffer)||void 0===D?void 0:D.bufferUnits)&&t.lodash.isDeepEqual(null===(P=null===(A=null==R?void 0:R.assetSettings)||void 0===A?void 0:A.assetIntersectingBuffer)||void 0===P?void 0:P.bufferSymbol,null===(V=null===(O=null==j?void 0:j.assetSettings)||void 0===O?void 0:O.assetIntersectingBuffer)||void 0===V?void 0:V.bufferSymbol)||this.setState({isBufferSelectorEnableInConfig:null==j?void 0:j.assetSettings.assetIntersectingBuffer.enabled,isBufferSelectorEnableAtRuntime:null==j?void 0:j.assetSettings.assetIntersectingBuffer.enabled,selectedBufferDistance:(null==j?void 0:j.assetSettings.assetIntersectingBuffer.bufferDistance)||this.state.selectedBufferDistance,selectedBufferUnit:(null==j?void 0:j.assetSettings.assetIntersectingBuffer.bufferUnits)||this.state.selectedBufferUnit,selectedBufferSymbol:null==j?void 0:j.assetSettings.assetIntersectingBuffer.bufferSymbol},(()=>{this.props.intersectingBufferRuntime({enabled:this.state.isBufferSelectorEnableInConfig,bufferDistance:this.state.selectedBufferDistance,bufferUnits:this.state.selectedBufferUnit,bufferSymbol:this.state.selectedBufferSymbol})}))},this.didStatisticsListChanged=(e,t)=>{let i=!1;return null==t||t.some(((t,s)=>{if(t.name!==e[s].name||t.label!==e[s].label||t.enabled!==e[s].enabled)return i=!0,!0})),i},this.didProfileLayersSettingsChanged=(e,t)=>{let i=!1;return(null==e?void 0:e.length)!==(null==t?void 0:t.length)&&(i=!0),i},this.didIntersectingLayersSettingsChanged=(e,t)=>{let i=!1;return(null==e?void 0:e.length)!==(null==t?void 0:t.length)&&(i=!0),i},this.showIntervalError=e=>{this.setState({distanceInterval:e}),e>=0&&e<=this.getMaxDistance()?this.setState({showInValidIntervalErrorMsg:!1}):this.setState({showInValidIntervalErrorMsg:!0,getIntervalsError:this.getIntervalLimitValues(0,this.getMaxDistance())})},this.getSelectableLayers=e=>{const t=A(e);this.selectableLayers=[];const i=[];let s=!1;null==t||t.forEach((e=>{var t,o,n,a;const r=e;r&&r.layerDefinition&&r.layerDefinition.geometryType&&((null===(t=this.props.activeDatasourceConfig)||void 0===t?void 0:t.hasOwnProperty("advanceOptions"))||this.state.isProfileSettingsOptionEnabled)&&((null===(o=this.props.activeDatasourceConfig)||void 0===o?void 0:o.hasOwnProperty("advanceOptions"))&&(null===(n=this.props.activeDatasourceConfig)||void 0===n?void 0:n.advanceOptions)||this.state.isCustomizeOptionEnabled?0===this.state.profileLayers.length?s=!1:"esriGeometryPolyline"===r.layerDefinition.geometryType&&(null===(a=this.state.profileLayers)||void 0===a||a.forEach((e=>{(null==e?void 0:e.layerId)===r.id&&(this.selectableLayers.push({label:r.schema.label,value:r.id}),i.push(r.id),s=!0)}))):"esriGeometryPolyline"===r.layerDefinition.geometryType&&(this.selectableLayers.push({label:r.schema.label,value:r.id}),i.push(r.id),s=!0))})),this.props.selectableLayersRuntime(i),this.setState({selectedLayers:i,isAnyProfileLineLayers:s})},this.getIntersectingLayers=e=>{const t=A(e);this.intersectingLayers=[];const i=[];let s=!1;null==t||t.forEach((e=>{var t,o;const n=e;n&&n.layerDefinition&&n.layerDefinition.geometryType&&this.state.isAssetSettingsOptionEnabled&&(0===(null===(t=this.state.intersectingLayers)||void 0===t?void 0:t.length)?s=!1:"esriGeometryPolyline"!==n.layerDefinition.geometryType&&"esriGeometryPoint"!==n.layerDefinition.geometryType||null===(o=this.state.intersectingLayers)||void 0===o||o.forEach((e=>{(null==e?void 0:e.layerId)===n.id&&(this.intersectingLayers.push({label:n.schema.label,value:n.id}),i.push(n.id),s=!0)})))})),this.props.intersectingLayersRuntime(i),this.setState({selectedIntersectedLayers:i,isAnyIntersectingLayers:s})},this.onDoneClick=()=>{this.props.doneClick()?this.setState({enableForNewProfile:!0}):this.setState({enableForNewProfile:!1,initialEmptyState:!1,emptyStateIfDoneClick:!0,noFeaturesError:!1,noValidInput:!1},(()=>{setTimeout((()=>{var e,t;null===(t=null===(e=this.alertElement)||void 0===e?void 0:e.current)||void 0===t||t.focus()}),100)}))},this.toggleStatistics=()=>{this.setState({statisticsOpen:!this.state.statisticsOpen},(()=>{this.displayStatisticsInfo(this.chart)}))},this.toggleSettings=()=>{this.setState({settingsOptionsOpen:!this.state.settingsOptionsOpen})},this.highlightChartPosition=e=>{this.props.chartPosition(e)},this.hideChartPosition=()=>{this.props.hideChartPosition()},this.onChartFlip=()=>{this.setState({isFlipChart:!this.state.isFlipChart},(()=>{this.displayStatisticsInfo(this.chart),this.updateOutputStatistics(),this.exportOptionDisplay()}))},this.onNewProfileClick=()=>{this.createNewProfile(),this.props.jimuMapView.clearSelectedFeatures(),this.setState({enableForNewProfile:!1})},this.onClearButtonClick=()=>{this.createNewProfile()},this.createNewProfile=()=>{this.props.activateDrawSelectToolForNewProfile(),this.setState({initialEmptyState:!0,emptyStateIfDoneClick:!1,noFeaturesError:!1,noValidInput:!1,statisticsOpen:!1,isExport:!1},(()=>{setTimeout((()=>{var e,t;null===(t=null===(e=this.alertElement)||void 0===e?void 0:e.current)||void 0===t||t.focus()}),100)}))},this.onElevationUnitChange=e=>{this.setState({selectedElevationUnit:e.target.value},(()=>{this.displayStatisticsInfo(this.chart),this.updateOutputStatistics()}))},this.onLinearUnitChange=e=>{this.setState({selectedLinearUnit:e.target.value},(()=>{this.displayStatisticsInfo(this.chart),this.updateOutputStatistics(),this.showIntervalError(this.getDefaultIntervalValue()),this.exportOptionDisplay()}))},this.onLayerSelected=(e,t,i)=>{let s=!0;this.setState({selectedLayers:i}),0===i.length&&(s=!1),this.setState({isLayerSelected:s}),this.props.selectableLayersRuntime(i)},this.onIntersectedLayerSelected=(e,t,i)=>{this.setState({selectedIntersectedLayers:i}),this.props.intersectingLayersRuntime(i)},this.displaySelectedFields=e=>{let t=this.nls("selectLayerLabel");return e&&e.length&&(t=this.props.intl.formatMessage({id:"selectedLayerCount",defaultMessage:l.selectedLayerCount},{selectedLayerCount:e.length})),t},this.updateBufferValues=()=>{this.props.intersectingBufferRuntime({enabled:this.state.isBufferSelectorEnableAtRuntime,bufferDistance:this.state.selectedBufferDistance,bufferUnits:this.state.selectedBufferUnit,bufferSymbol:this.state.selectedBufferSymbol})},this.onBufferSelectorChange=e=>{this.setState({isBufferSelectorEnableAtRuntime:e.target.checked},(()=>{this.updateBufferValues()}))},this.onBufferUnitsChange=e=>{const t=((e,t)=>{const i=P(t);return e>i?i:e})(this.state.selectedBufferDistance,e.target.value);this.setState({selectedBufferUnit:e.target.value,selectedBufferDistance:t},(()=>{this.updateBufferValues()}))},this.onBufferDistanceChange=e=>{this.setState({selectedBufferDistance:null!=e?e:0},(()=>{this.updateBufferValues()}))},this.onUniformScalingChange=e=>{this.setState({isUniformScalingEnable:e.target.checked})},this.setExportButtonState=e=>{this.setState({exportData:e})},this.customizeIntervalChange=e=>{this.setState({isCustomizeInterval:e.target.checked}),e.target.checked&&this.onDistanceIntervalChange(this.state.distanceInterval)},this.getMaxDistance=()=>{var e,t;return(null===(t=null===(e=this.props.profileResult)||void 0===e?void 0:e.statistics)||void 0===t?void 0:t.maxDistance)?R(this.props.profileResult.statistics.maxDistance,this.props.profileResult.effectiveUnits.distance,this.state.selectedLinearUnit):0},this.onExportButtonClick=()=>{this.state.showInValidIntervalErrorMsg?this.setState({exportData:!1}):this.setState({exportData:!0})},this.onExportCancelButtonClick=()=>{this.setState({isExport:!1})},this.getDefaultIntervalValue=()=>{const e=this.getMaxDistance();let t=1;return e<1&&e>=.1?t=.1:e<.1&&e>=.01?t=.01:e<.01&&e>=.001?t=.001:e<.001&&e>=1e-4&&(t=1e-4),t},this.onDistanceIntervalChange=e=>{this.setState({distanceInterval:null!=e?e:0},(()=>{0===this.state.distanceInterval?this.setState({showInValidIntervalErrorMsg:!0,getIntervalsError:this.getIntervalLimitValues(null,null)}):this.state.distanceInterval>=0&&this.state.distanceInterval<=this.getMaxDistance()?this.setState({showInValidIntervalErrorMsg:!1}):this.setState({showInValidIntervalErrorMsg:!0,getIntervalsError:this.getIntervalLimitValues(0,this.getMaxDistance())})}))},this.getIntervalLimitValues=(e,t)=>{let i="";return i=e||t?this.props.intl.formatMessage({id:"intervalErrorHint",defaultMessage:l.intervalErrorHint},{xMin:e,xMax:this.truncateMaxIntervalDistance(t)}):this.nls("intervalHintForInvalidEntry"),i},this.truncateMaxIntervalDistance=e=>{let t;if(!isNaN(e)&&null!==e){const i=4;t=new RegExp(i>0?"^\\d*[.]?\\d{0,"+i+"}":"^\\d*").exec(e.toString())[0]}return t},this.adjustInfoIconPosition=()=>{let e=-8;return"125%"===this.props.theme.typography.fontSizeRoot&&(e=-11),e},this.exportOptionDisplay=()=>{const e=(0,t.getAppStore)().getState().appContext.isRTL,s=x.find((e=>e.value===this.state.selectedLinearUnit));return(0,t.jsx)("div",null,(0,t.jsx)(i.Popper,{css:n(this.props.theme),open:this.state.isExport,reference:"export"+this.props.widgetId,placement:"right-start",version:0,offset:[0,0],toggle:e=>{this.setState({isExport:!this.state.isExport})}},(0,t.jsx)("div",{style:{width:250},className:"p-2"},(0,t.jsx)(i.Label,{"aria-label":this.nls("chartExport"),className:"exportLabel text-break"},this.nls("chartExport")),(0,t.jsx)(i.Label,{tabIndex:0,className:"pt-2 pl-1 exportHintStyle"},this.nls("exportHint")),(0,t.jsx)("div",{className:"pt-1 pb-1 d-flex"},(0,t.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("customizeIntervalTooltip"),title:this.nls("customizeIntervalTooltip"),showArrow:!0,placement:"top"},(0,t.jsx)(i.Button,{className:"d-inline",style:{marginTop:this.adjustInfoIconPosition(),marginLeft:-4},type:"tertiary",icon:!0},(0,t.jsx)(i.Icon,{icon:ie.infoIcon}))),(0,t.jsx)(i.Label,{className:"w-100 d-flex pl-1"},this.nls("customizeIntervalLabel")),(0,t.jsx)(i.Switch,{role:"switch","aria-label":this.nls("customizeIntervalLabel"),title:this.nls("customizeIntervalLabel"),checked:this.state.isCustomizeInterval,onChange:this.customizeIntervalChange})),(0,t.jsx)("div",{className:this.state.isCustomizeInterval?"showCustomizeEdit":"hideCustomizeEdit"},(0,t.jsx)("div",{className:(0,t.classNames)("d-flex",this.state.showInValidIntervalErrorMsg?"pb-1":"pb-2")},(0,t.jsx)(i.NumericInput,{"aria-label":this.nls("customizeIntervalLabel"),size:"sm",defaultValue:this.state.distanceInterval,value:this.state.distanceInterval,title:this.state.distanceInterval+"",className:(0,t.classNames)("ml-1 w-100",this.state.showInValidIntervalErrorMsg?"invalidValue":""),showHandlers:!1,onChange:this.onDistanceIntervalChange}),(0,t.jsx)("div",{title:this.nls(s.abbreviation),className:"style-setting--unit-selector border"},(0,t.jsx)(i.Label,{className:"text-truncate unitsLabel"},this.nls(s.abbreviation)))),(0,t.jsx)(i.Label,{className:(0,t.classNames)("ml-1 pb-1 invalidRange",this.state.isCustomizeInterval&&this.state.showInValidIntervalErrorMsg?"showCustomizeEdit":"hideCustomizeEdit")},this.state.getIntervalsError)),(0,t.jsx)("div",{style:{height:35},className:"mt-1 mb-2 d-flex w-100"},(0,t.jsx)("div",{className:"align-items-center w-100 pt-1",style:{display:"inline-block"}},(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("exportLabel"),title:this.nls("exportLabel"),className:"actionButton text-break",style:{float:e?"left":"right"},size:"default",type:"primary",onClick:this.onExportButtonClick},this.nls("exportLabel")),(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("cancel"),title:this.nls("cancel"),className:"actionButton text-break",style:{float:e?"right":"left"},size:"default",type:"secondary",onClick:this.onExportCancelButtonClick},this.nls("cancel")))))))},this.displayStatisticsInfo=e=>{var s,o,n;const a=[];this.setState({legendStats:[]});let r=!1;(null==e?void 0:e.series)?((null===(o=null===(s=null==e?void 0:e.series)||void 0===s?void 0:s.values)||void 0===o?void 0:o[0])&&(r=!0),null===(n=null==e?void 0:e.series)||void 0===n||n.values.forEach(((e,i)=>{if(0===i)return a.push((0,t.jsx)(Q,{theme:this.props.theme,intl:this.props.intl,parentWidgetId:this.props.widgetId,index:i,key:e.name+i,singleSeriesExpandStat:r,legendName:e.name,activeDsConfig:this.props.activeDatasourceConfig,selectedElevationUnit:this.state.selectedElevationUnit,selectedLinearUnit:this.state.selectedLinearUnit,chartDataUpdateTime:this.props.chartDataUpdateTime,chartProfileResult:this.props.visibleGroundProfileStats,selectedStatsDisplay:this.state.selectedStatisticsList,renderSeries:this.state.renderSeries,toggledSeriesName:this.state.toggledSeriesName,isFlip:this.state.isFlipChart})),!0}))):a.push((0,t.jsx)(i.Loading,{type:i.LoadingType.Secondary})),this.setState({legendStats:a})},this.statisticsDisplay=()=>{return(0,t.jsx)("div",null,(0,t.jsx)(i.Popper,{css:(e=this.props.theme,s=this.props.chartColorRender?this.props.chartColorRender:"#b54900",t.css`
    .ep-shadow {
      box-shadow: 0 0 8px 3px rgba(0,0,0,0.2)!important;
    }

    .ep-legend {
      height: 100px;
      overflow-y: auto;
    }

    .ep-legend-section {
      border-radius: 2px;
      padding: 5px;
      margin-top: 10px;
      border-left: 3px solid ${s};
      min-width: 120px;
    }

    .cursor-pointer {
      cursor: pointer
    }

    .legendLabel {
      margin-bottom: 0px;
      font-weight: bold;
      word-wrap: break-word;
    }

    .expand-collapse-button {
      &:hover {
        color: ${e.colors.palette.secondary[900]};
      }
    }

    .arrow-up {
      transform-origin: center center;
      transform: rotate(180deg);
      transition: transform .5s ease 0s;
    }

    .arrow-down {
      transform-origin: center center;
      transform: rotate(0deg);
      transition: transform .5s ease 0s;
    }

    .stat-content {
      display: block;
      padding: 12px 15px;
      padding-top: 0;
    }

    .profile-statistics {
      --max-width: 105px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(var(--max-width), 1fr));
      gap: 2px 22px;
      width: 100%;
    }

    .statistic-info {
      display: block;
      text-align: start;
    }

    .statistic-label {
      font-weight: 500;
    }
  `),open:this.state.statisticsOpen,reference:"statistics"+this.props.widgetId,floating:!0,headerTitle:this.nls("statisticsLabel"),placement:"auto",version:0,offset:[0,0],onHeaderClose:()=>{this.setState({statisticsOpen:!this.state.statisticsOpen})},defaultSize:{width:400,height:235}},(0,t.jsx)("div",{style:{height:"calc(100% - 15px)",overflow:"auto"},className:"pr-3 pl-3 pt-2 pb-3"},this.state.legendStats.map(((e,i)=>(0,t.jsx)(t.React.Fragment,{key:i},e))))));var e,s},this.settingsOptionsRender=()=>(0,t.jsx)("div",null,(0,t.jsx)(i.Popper,{css:(this.props.theme,t.css`
  .settingsLabel {
    margin: 0 !important;
    font-weight: 500;
  }

  .selectLayerWarningMsg {
    padding: 1px !important;
    background-color: transparent !important;
    border: none !important;
    font-size: 11px;
  }

  .selectLayerWarningMsg .left-part {
    color: var(--warning-900) !important;
    margin-right: 0 !important;
  }

  .custom-multiselect .jimu-dropdown .jimu-btn .dropdown-button-content {
    padding-top: 3px;
    padding-bottom: 3px;
  }
  `),open:this.state.settingsOptionsOpen,reference:"settingsOptions"+this.props.widgetId,placement:"right-start",version:0,offset:[0,0],toggle:e=>{this.setState({settingsOptionsOpen:!this.state.settingsOptionsOpen})}},(0,t.jsx)("div",{tabIndex:-1,style:{width:175}},(0,t.jsx)("div",{tabIndex:-1,className:"p-2"},(0,t.jsx)(i.Label,{"aria-label":this.nls("elevationUnitLabel"),className:"settingsLabel text-break"},this.nls("elevationUnitLabel")),(0,t.jsx)(i.Select,{menuRole:"menu","aria-label":this.nls("elevationUnitLabel")+" "+this.state.selectedElevationUnit,className:"pt-1",name:"elevationUnit",size:"sm",onChange:this.onElevationUnitChange,value:this.state.selectedElevationUnit},x.map((e=>(0,t.jsx)(i.Option,{role:"option","aria-label":e.value,key:e.value,value:e.value},this.nls(e.value)))))),(0,t.jsx)("div",{className:"p-2"},(0,t.jsx)(i.Label,{"aria-label":this.nls("distanceUnitLabel"),className:"settingsLabel text-break"},this.nls("distanceUnitLabel")),(0,t.jsx)(i.Select,{menuRole:"menu","aria-label":this.nls("distanceUnitLabel")+" "+this.state.selectedLinearUnit,className:"pt-1",name:"linearUnit",size:"sm",onChange:this.onLinearUnitChange,value:this.state.selectedLinearUnit},x.map((e=>(0,t.jsx)(i.Option,{role:"option","aria-label":e.value,key:e.value,value:e.value},this.nls(e.value)))))),this.props.selectMode&&this.state.isAnyProfileLineLayers&&(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)("div",{className:"p-2"},(0,t.jsx)(i.Label,{"aria-label":this.nls("selectableLayersLabel"),className:"settingsLabel text-break"},this.nls("selectableLayersLabel")),!this.state.isLayerSelected&&(0,t.jsx)(i.Alert,{tabIndex:0,className:"w-100 selectLayerWarningMsg",onClose:function(){},open:!this.state.isLayerSelected,text:this.nls("selectLayerWarning"),type:"warning",withIcon:!0}),(0,t.jsx)(i.MultiSelect,{items:(0,t.Immutable)(this.selectableLayers),values:(0,t.Immutable)(this.state.selectedLayers),className:"pt-1 custom-multiselect",buttonProps:{showDynamicTitle:!0},size:"sm",fluid:!0,onClickItem:this.onLayerSelected,displayByValues:this.displaySelectedFields}))),(this.props.selectMode||this.props.drawMode)&&this.state.isAnyIntersectingLayers&&(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)("div",{className:"p-2"},(0,t.jsx)(i.Label,{"aria-label":this.nls("intersectingLayersLabel"),className:"settingsLabel text-break"},this.nls("intersectingLayersLabel")),(0,t.jsx)(i.MultiSelect,{items:(0,t.Immutable)(this.intersectingLayers),values:(0,t.Immutable)(this.state.selectedIntersectedLayers),className:"pt-1 custom-multiselect",buttonProps:{showDynamicTitle:!0},size:"sm",fluid:!0,onClickItem:this.onIntersectedLayerSelected,displayByValues:this.displaySelectedFields}))),this.state.isAssetSettingsOptionEnabled&&this.state.isBufferSelectorEnableInConfig&&(0,t.jsx)("div",{className:"p-2"},(0,t.jsx)(i.Label,{"aria-label":this.nls("bufferSelectorLabel"),className:"w-100 d-flex"},(0,t.jsx)("div",{className:"flex-grow-1 settingsLabel text-break"},this.nls("bufferSelectorLabel")),(0,t.jsx)(i.Switch,{role:"switch","aria-label":this.nls("bufferSelectorLabel"),title:this.nls("bufferSelectorLabel"),checked:this.state.isBufferSelectorEnableAtRuntime,onChange:this.onBufferSelectorChange})),this.state.isBufferSelectorEnableAtRuntime&&(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)(i.NumericInput,{"aria-label":this.nls("bufferSelectorLabel")+this.state.selectedBufferDistance,size:"sm",min:0,max:P(this.state.selectedBufferUnit),defaultValue:this.state.selectedBufferDistance,value:this.state.selectedBufferDistance,onChange:this.onBufferDistanceChange}),(0,t.jsx)(i.Select,{menuRole:"menu","aria-label":this.state.selectedBufferUnit,className:"pt-1 pb-1",size:"sm",name:"bufferUnits",value:this.state.selectedBufferUnit,onChange:this.onBufferUnitsChange},x.map(((e,s)=>(0,t.jsx)(i.Option,{role:"option","aria-label":e.value,key:s,value:e.value},this.nls(e.value))))))),(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)("div",{className:"pl-2 pb-2 pr-2"},(0,t.jsx)(i.Label,{className:"cursor-pointer settingsLabel text-break",title:this.nls("uniformChartScalingInfo")},(0,t.jsx)(i.Checkbox,{role:"checkbox",className:"mr-2 font-13","aria-label":this.nls("uniformChartScaling"),checked:this.state.isUniformScalingEnable,onChange:this.onUniformScalingChange.bind(this)}),this.nls("uniformChartScaling"))))))),this.dismissInfoMsg=()=>{this.setState({dismissInfoMsg:!this.state.dismissInfoMsg})},this.dismissWarningMsg=()=>{this.setState({dismissWarningMsg:!this.state.dismissWarningMsg})},this.getChartInfo=e=>{this.chart=e,setTimeout((()=>{this.displayStatisticsInfo(this.chart)}),50)},this.onToggleSeries=(e,t)=>{this.setState({renderSeries:e,toggledSeriesName:t})},this.toggleExport=()=>{this.setState({isExport:!this.state.isExport})};const T=F(this.props.activeDatasourceConfig,se);this.chart=null;let N=null===(a=null===(o=null===(s=this.props.activeDatasourceConfig)||void 0===s?void 0:s.assetSettings)||void 0===o?void 0:o.assetIntersectingBuffer)||void 0===a?void 0:a.bufferUnits;""===N&&(N=O(se)),this.state={chartResult:this.props.profileResult,initialEmptyState:!0,emptyStateIfDoneClick:!1,enableForNewProfile:!1,settingsOptionsOpen:!1,unitOptions:x,isFlipChart:!1,selectedElevationUnit:this.props.activeDatasourceConfig?T[0]:this.props.defaultConfig.profileChartSettings.elevationUnit,selectedLinearUnit:this.props.activeDatasourceConfig?T[1]:this.props.defaultConfig.profileChartSettings.linearUnit,selectedLayers:[],selectedIntersectedLayers:[],profileLayers:null===(r=this.props.activeDatasourceConfig)||void 0===r?void 0:r.profileSettings.layers,intersectingLayers:(null===(c=null===(h=null===(d=this.props.activeDatasourceConfig)||void 0===d?void 0:d.assetSettings)||void 0===h?void 0:h.layers)||void 0===c?void 0:c.length)>0?null===(u=null===(p=this.props.activeDatasourceConfig)||void 0===p?void 0:p.assetSettings)||void 0===u?void 0:u.layers:[],isAnyProfileLineLayers:!1,isAnyIntersectingLayers:!1,isProfileSettingsOptionEnabled:null===(g=this.props.activeDatasourceConfig)||void 0===g?void 0:g.profileSettings.isProfileSettingsEnabled,isCustomizeOptionEnabled:null===(v=this.props.activeDatasourceConfig)||void 0===v?void 0:v.profileSettings.isCustomizeOptionEnabled,isAssetSettingsOptionEnabled:null===(m=null===(f=this.props.activeDatasourceConfig)||void 0===f?void 0:f.assetSettings)||void 0===m?void 0:m.isAssetSettingsEnabled,noFeaturesError:this.props.noFeaturesFoundError,dismissInfoMsg:this.props.selectMode&&this.props.isNewSegmentsForSelection||this.props.drawMode&&!this.props.onDrawingComplete,dismissWarningMsg:!this.props.isNewSegmentsForSelection&&!this.props.noGraphicAfterFirstSelection&&this.props.selectMode,statisticsOpen:!1,legendStats:[],showLegend:null===(y=this.props.commonDsGeneralSettings)||void 0===y?void 0:y.showLegend,displayStats:this.props.activeDatasourceConfig?this.props.activeDatasourceConfig.profileChartSettings.displayStatistics:this.props.defaultConfig.profileChartSettings.displayStatistics,selectedStatisticsList:this.props.activeDatasourceConfig?this.props.activeDatasourceConfig.profileChartSettings.selectedStatistics:this.props.defaultConfig.profileChartSettings.selectedStatistics,renderSeries:!0,toggledSeriesName:"",isUniformScalingEnable:!1,isLayerSelected:!0,isBufferSelectorEnableInConfig:null===(w=null===(b=null===(S=this.props.activeDatasourceConfig)||void 0===S?void 0:S.assetSettings)||void 0===b?void 0:b.assetIntersectingBuffer)||void 0===w?void 0:w.enabled,isBufferSelectorEnableAtRuntime:null===(I=null===(C=null===(L=this.props.activeDatasourceConfig)||void 0===L?void 0:L.assetSettings)||void 0===C?void 0:C.assetIntersectingBuffer)||void 0===I?void 0:I.enabled,selectedBufferDistance:(null===(D=null===(M=null===(E=this.props.activeDatasourceConfig)||void 0===E?void 0:E.assetSettings)||void 0===M?void 0:M.assetIntersectingBuffer)||void 0===D?void 0:D.bufferDistance)||10,selectedBufferUnit:N||O(se),selectedBufferSymbol:null===(k=null===(j=null===(V=this.props.activeDatasourceConfig)||void 0===V?void 0:V.assetSettings)||void 0===j?void 0:j.assetIntersectingBuffer)||void 0===k?void 0:k.bufferSymbol,noValidInput:this.props.viewModelErrorState,viewModelErrorMsg:this.props.profileErrorMsg,isExport:!1,isCustomizeInterval:!1,allowExport:null===(U=this.props.commonDsGeneralSettings)||void 0===U?void 0:U.allowExport,exportData:!1,showViewLineGraph:this.props.activeDatasourceConfig?this.props.activeDatasourceConfig.profileChartSettings.showVolumetricObjLineInGraph:this.props.defaultConfig.profileChartSettings.showVolumetricObjLineInGraph,volumetricObjLineColor:this.props.activeDatasourceConfig?this.props.activeDatasourceConfig.profileChartSettings.volumetricObjLineColor:this.props.defaultConfig.profileChartSettings.volumetricObjLineColor,volumetricObjLabel:this.props.activeDatasourceConfig?this.props.activeDatasourceConfig.profileChartSettings.volumetricObjLabel:this.props.defaultConfig.profileChartSettings.volumetricObjLabel,distanceInterval:1,showInValidIntervalErrorMsg:!1,getIntervalsError:""},this.selectableLayers=[],this.intersectingLayers=[]}render(){var s,o,n;let l="",d="",h="";this.state.initialEmptyState&&this.props.drawMode||this.state.emptyStateIfDoneClick&&this.props.drawMode?l=this.nls("drawUserInfo"):(this.state.initialEmptyState&&this.props.selectMode||this.state.emptyStateIfDoneClick&&this.props.selectMode)&&(l=this.nls("selectUserInfo")),this.state.emptyStateIfDoneClick&&this.props.drawMode?d=this.nls("emptyDrawStateWarning"):this.state.emptyStateIfDoneClick&&this.props.selectMode&&(d=this.nls("emptySelectStateWarning")),this.props.drawMode&&this.props.chartRender?h=this.nls("infoMsgWhileDrawing"):this.props.selectMode&&this.props.chartRender&&(h=this.props.isNewSegmentsForSelection&&this.props.noGraphicAfterFirstSelection?this.nls("infoMsgWhileSelecting"):this.nls("addToSelectionWarning"));const c=this.nls("noFeaturesFound"),p=this.settingsOptionsRender(),u=this.statisticsDisplay(),g=this.exportOptionDisplay();return(0,t.jsx)("div",{className:"h-100 w-100",css:a(this.props.theme)},(0,t.jsx)("div",{style:{height:35},className:"ep-widget-header d-flex w-100"},(0,t.jsx)("div",{className:"align-items-center w-100 pt-1",style:{display:"inline-block"}},(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("settingsOptions"),"aria-haspopup":"dialog",title:this.nls("settingsOptions"),icon:!0,id:"settingsOptions"+this.props.widgetId,className:"chart-actions",active:this.state.settingsOptionsOpen,size:"sm",type:"default",onClick:this.toggleSettings},(0,t.jsx)(i.Icon,{size:16,icon:ie.settingsIcon})),this.state.allowExport&&this.props.chartRender&&(this.props.drawMode&&this.props.onDrawingComplete||this.props.selectMode)&&(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("chartExport"),"aria-haspopup":"dialog",title:this.nls("chartExport"),icon:!0,id:"export"+this.props.widgetId,className:"chart-actions",active:this.state.isExport,size:"sm",type:"default",onClick:this.toggleExport},(0,t.jsx)(i.Icon,{size:16,icon:te()})),this.props.chartRender&&(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("chartFlip"),title:this.nls("chartFlip"),icon:!0,className:"chart-actions",active:this.state.isFlipChart,size:"sm",type:"default",onClick:this.onChartFlip},(0,t.jsx)(i.Icon,{size:16,icon:ie.flipIcon})),this.state.displayStats&&(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("chartStatistics"),"aria-haspopup":"dialog",title:this.nls("chartStatistics"),icon:!0,id:"statistics"+this.props.widgetId,className:"chart-actions",active:this.state.statisticsOpen,size:"sm",type:"default",onClick:this.toggleStatistics},(0,t.jsx)(i.Icon,{size:16,icon:ie.chartIcon}))),this.state.settingsOptionsOpen&&p,this.state.isExport&&g,this.state.statisticsOpen&&u)),(0,t.jsx)("div",{className:(0,t.classNames)("ep-widget-bodyContainer d-flex w-100",this.props.chartRender?"":"align-items-center")},this.props.displayLoadingIndicator&&(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)(i.Loading,{type:i.LoadingType.Secondary})),(0,t.jsx)("div",{className:(0,t.classNames)("w-100",this.props.chartRender?"":"alignInfo align-items-center",this.props.noFeaturesFoundError?"alignInfo align-items-center":"")},!this.props.displayLoadingIndicator&&(0,t.jsx)(t.React.Fragment,null,!this.props.chartRender&&!this.state.noFeaturesError&&!this.state.noValidInput&&(0,t.jsx)("div",{tabIndex:0,ref:this.alertElement,"aria-label":l},(0,t.jsx)(i.Alert,{className:"mb-3 w-100 userInfo",onClose:function(){},open:!this.props.chartRender&&!this.state.noFeaturesError&&!this.state.noValidInput,text:l,type:"info",withIcon:!0})),this.state.emptyStateIfDoneClick&&!this.props.chartRender&&!this.state.noFeaturesError&&!this.state.noValidInput&&(0,t.jsx)(i.Alert,{tabIndex:0,className:"w-100 userInfo",onClose:function(){},open:this.state.emptyStateIfDoneClick&&!this.props.chartRender&&!this.state.noFeaturesError&&!this.state.noValidInput,text:d,type:"warning",withIcon:!0}),this.state.noFeaturesError&&(0,t.jsx)(i.Alert,{tabIndex:0,className:"w-100 userInfo",onClose:function(){},open:this.state.noFeaturesError,text:c,type:"warning",withIcon:!0}),this.state.noValidInput&&(0,t.jsx)(i.Alert,{tabIndex:0,className:"w-100 userInfo",onClose:function(){},open:this.state.noValidInput,text:this.state.viewModelErrorMsg,type:"warning",withIcon:!0})),(this.props.chartRender||this.state.exportData)&&(0,t.jsx)(q,{ref:"chartObj",intl:this.props.intl,isExportEnable:this.state.exportData,parentWidgetId:this.props.widgetId,commonGeneralSettings:this.props.commonDsGeneralSettings,activeDs:this.props.activeDataSource,currentConfig:this.props.activeDatasourceConfig,theme:this.props.theme,selectedLinearUnit:this.state.selectedLinearUnit,selectedElevationUnit:this.state.selectedElevationUnit,showVolumetricObj:this.state.showViewLineGraph,volumetricObjLineColor:this.state.volumetricObjLineColor,volumetricObjLabel:this.state.volumetricObjLabel,chartDataUpdateTime:this.props.chartDataUpdateTime,profileResult:this.props.profileResult,unitOptions:this.state.unitOptions,highlightChartPositionOnMap:this.highlightChartPosition.bind(this),hideChartPosition:this.hideChartPosition.bind(this),chartInfo:this.getChartInfo.bind(this),toggleLegendSeriesState:this.onToggleSeries,elevationGraphColor:this.props.chartColorRender,isFlip:this.state.isFlipChart,isUniformChartScalingEnable:this.state.isUniformScalingEnable,drawingLayer:this.props.drawingLayer,intersectionHighlightLayer:this.props.intersectionHighlightLayer,mapView:this.props.jimuMapView,assetIntersectionResult:this.props.intersectionResult,setExportButton:this.setExportButtonState,isCustomIntervalEnabled:this.state.isCustomizeInterval,customDistanceInterval:this.state.distanceInterval}))),(0,t.jsx)("div",{className:"floatingInfoMsg"},!this.state.enableForNewProfile&&this.props.chartRender&&(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)("div",{title:h},(0,t.jsx)(i.Alert,{tabIndex:0,className:(0,t.classNames)("alignDismissibleInfo",this.state.dismissInfoMsg?"showMessage":"hideMessage"),onClose:this.dismissInfoMsg,open:this.state.dismissInfoMsg,text:h,type:"info",withIcon:!0,closable:!0})),(0,t.jsx)("div",{title:h},(0,t.jsx)(i.Alert,{tabIndex:0,className:(0,t.classNames)("alignDismissibleInfo",this.state.dismissWarningMsg?"showMessage":"hideMessage"),onClose:this.dismissWarningMsg,open:this.state.dismissWarningMsg,text:h,type:"warning",withIcon:!0,closable:!0})))),(0,t.jsx)("div",{className:"ep-widget-footer"},(0,t.jsx)(r.SettingRow,null,(0,t.jsx)("div",{className:"w-100 footer-display"},(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("backButtonLabel"),title:this.nls("backButtonLabel"),className:"m-1 text-break",size:"default",type:"tertiary",onClick:this.props.onNavBack},(0,t.jsx)(i.Icon,{size:16,autoFlip:!0,icon:ie.arrowNavBack}),this.nls("backButtonLabel")),(null===(s=this.props.commonDsGeneralSettings)||void 0===s?void 0:s.buttonStyle)===e.IconText&&(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("doneButtonLabel"),title:this.nls("doneButtonLabel"),className:this.state.enableForNewProfile||this.props.onDrawingComplete||this.state.noValidInput||this.props.selectMode&&this.props.chartRender&&!this.props.isNewSegmentsForSelection?"hidden":"m-1 actionButton text-break",size:"default",type:"primary",onClick:this.onDoneClick},(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)(i.Icon,{size:16,icon:ie.doneIcon}),this.nls("doneButtonLabel"))),this.props.chartRender&&(null===(o=this.props.commonDsGeneralSettings)||void 0===o?void 0:o.buttonStyle)===e.IconText&&(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("clearButtonLabel"),title:this.nls("clearButtonLabel"),className:this.state.enableForNewProfile||this.props.onDrawingComplete||this.props.selectMode&&this.props.chartRender&&!this.props.isNewSegmentsForSelection?"hidden":"m-1 actionButton text-break",size:"default",type:"default",onClick:this.onClearButtonClick},(0,t.jsx)(i.Icon,{size:16,icon:ie.clearIcon}),this.nls("clearButtonLabel"))),(this.state.enableForNewProfile||this.props.onDrawingComplete||this.state.noValidInput||this.props.selectMode&&this.props.chartRender&&!this.props.isNewSegmentsForSelection)&&(null===(n=this.props.commonDsGeneralSettings)||void 0===n?void 0:n.buttonStyle)===e.IconText&&(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("newProfileButtonLabel"),title:this.nls("newProfileButtonLabel"),className:"m-1 actionButton text-break",size:"default",type:"primary",onClick:this.onNewProfileClick},(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)(i.Icon,{size:16,icon:this.props.drawMode?ie.drawIcon:ie.selectIcon}),this.nls("newProfileButtonLabel")))))))}}var ne=M(97878),ae=M(23852),re=M(55606),le=M(37902),de=M(22443),he=M(135),ce=M(17465),pe=M(45818),ue=M(99818),ge=M(57780),ve=function(e,t,i,s){return new(i||(i=Promise))((function(o,n){function a(e){try{l(s.next(e))}catch(e){n(e)}}function r(e){try{l(s.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((s=s.apply(e,t||[])).next())}))};const{epIcon:fe}=b(),me={style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18};class ye extends t.BaseWidget{constructor(s){var o,n,a,r,d,h;super(s),this.resultsAfterIntersectionTimeout=null,this.nls=e=>{const t=Object.assign({},l,i.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:t[e]}):t[e]},this.createDrawingLayers=()=>{this.drawingLayer=new ae.default({listMode:"hide",effect:"bloom(0.8, 1px, 0)"}),this.nextPossibleSelectionLayer=new ae.default({listMode:"hide",effect:"bloom(0.8, 0px, 1%)"}),this.bufferLayer=new ae.default({listMode:"hide"}),this.intersectionHighlightLayer=new ae.default({listMode:"hide",effect:"bloom(0.8, 1px, 0)"})},this.componentDidMount=()=>{this.setState({chartColorRender:this.state.groundColor,noFeaturesError:!1,viewModelErrorState:!1})},this.waitForChildDataSourcesReady=e=>ve(this,void 0,void 0,(function*(){yield null==e?void 0:e.whenAllJimuLayerViewLoaded();const i=t.DataSourceManager.getInstance().getDataSource(null==e?void 0:e.dataSourceId);return(null==i?void 0:i.isDataSourceSet)&&!i.areChildDataSourcesCreated()?i.childDataSourcesReady().then((()=>i)).catch((e=>i)):Promise.resolve(i)})),this.activeViewChangeHandler=e=>ve(this,void 0,void 0,(function*(){var i,s;e&&e.view?(this.mapView=e,this.state.jimuMapView&&(this.state.currentSketchVM&&!this.state.currentSketchVM.destroyed&&this.state.currentSketchVM.destroy(),this.clearAll(),this.setState({initialStage:!0,resultStage:!1,drawModeActive:null===(i=this.props.config.generalSettings)||void 0===i?void 0:i.isDrawToolActive,selectModeActive:null===(s=this.props.config.generalSettings)||void 0===s?void 0:s.isSelectToolActive}),this.destroyDrawingLayers(),this.createDrawingLayers()),this.setState({onWidgetLoadShowLoadingIndicator:!0}),this.waitForChildDataSourcesReady(e).finally((()=>{this.setState({onWidgetLoadShowLoadingIndicator:!1}),e&&this.setState({jimuMapView:e},(()=>{if(""===e.dataSourceId)this.setState({currentDatasource:"default"},(()=>{this.activeCurrentDs=this.state.currentDatasource,this.selectedUnit=F(this.props.config.configInfo[this.state.currentDatasource],this.props.portalSelf)}));else if(this.state.jimuMapView.dataSourceId===this.props.config.activeDataSource&&this.props.config.configInfo[this.props.config.activeDataSource]){if(this.props.config.activeDataSource&&this.props.config.configInfo[this.props.config.activeDataSource]){let e=this.props.config.activeDataSource;this.state.jimuMapView&&this.state.jimuMapView.dataSourceId&&(e=this.props.config.configInfo.hasOwnProperty(this.state.jimuMapView.dataSourceId)?this.state.jimuMapView.dataSourceId:"default",this.setState({currentDatasource:e},(()=>{this.activeCurrentDs=this.state.currentDatasource,"default"!==this.state.currentDatasource&&this.checkLineLayerAvailableInDsAndConfig(this.state.currentDatasource),this.setConfigForDataSources()})))}}else this.setState({currentDatasource:this.state.jimuMapView.dataSourceId}),this.checkLineLayerAvailableInDsAndConfig(this.state.jimuMapView.dataSourceId);setTimeout((()=>{var i,s,o,n;const a={mode:"3d"===this.state.jimuMapView.view.type?"relative-to-ground":"on-the-ground",offset:null};this.drawingLayer.set("elevationInfo",a),this.nextPossibleSelectionLayer.set("elevationInfo",a),this.state.jimuMapView.view.map.addMany([this.bufferLayer,this.nextPossibleSelectionLayer,this.drawingLayer,this.intersectionHighlightLayer]),this.createApiWidget(e),this.createEpViewModel(e);const r=(0,t.getAppStore)().getState().widgetsRuntimeInfo[this.props.id].state;let l=!0;if(this.widgetOpenedWithSelection&&(this.widgetOpenedWithSelection=!1,r===t.WidgetState.Opened&&(null===(s=null===(i=this.props.mutableStateProps)||void 0===i?void 0:i.selectedFeatureRecords)||void 0===s?void 0:s.length)>0)){const e=null===(n=null===(o=this.props.mutableStateProps.selectedFeatureRecords)||void 0===o?void 0:o[0])||void 0===n?void 0:n.feature;this.checkSelectedFeaturesAvailability(e)&&(l=!1,this.displayFeaturesResult([[e]]))}!l||r!==t.WidgetState.Opened&&r||this.loadSelectDrawToolOnLoad(this.activeCurrentDs)}),100)}))}))):this.setState({initialStage:!1,resultStage:!1})})),this.loadSelectDrawToolOnLoad=e=>{if("default"===e)this.state.drawModeActive&&this.manageActiveDrawSelect();else if(this.state.drawModeActive||this.state.selectModeActive){if(this.state.lineLayersNotFound&&this.state.selectModeActive)return;this.manageActiveDrawSelect()}else this.setState({resultStage:!1,initialStage:!0})},this.manageActiveDrawSelect=()=>{this.setState({resultStage:!0,initialStage:!1},(()=>{this.clearAll(),this._displayDefaultCursor(),this.activateDrawOrSelectTool()}))},this.checkLineLayerAvailableInDsAndConfig=e=>{var t;const i=A(e);let s=!0;null==i||i.forEach((e=>{const t=e;t&&t.layerDefinition&&t.layerDefinition.geometryType&&"esriGeometryPolyline"===t.layerDefinition.geometryType&&(s=!1)})),e&&this.props.config.configInfo[e]&&this.canShowSelectAndDrawOptions(this.props.config.configInfo[e])?this.canShowProfilingForBackward(this.props.config.configInfo[e])&&0===(null===(t=this.props.config.configInfo[e])||void 0===t?void 0:t.profileSettings.layers.length)&&(s=!0):s=!0,this.setState({lineLayersNotFound:s})},this.setConfigForDataSources=()=>{var e,t,i,s,o;const n=this.props.config.configInfo[this.state.currentDatasource];this.setState({groundColor:n?null===(e=n.profileChartSettings)||void 0===e?void 0:e.groundColor:this.defaultConfig.profileChartSettings.groundColor,graphicsHighlightColor:n?null===(t=n.profileChartSettings)||void 0===t?void 0:t.graphicsHighlightColor:this.defaultConfig.profileChartSettings.graphicsHighlightColor,chartColorRender:n?null===(i=n.profileChartSettings)||void 0===i?void 0:i.groundColor:this.defaultConfig.profileChartSettings.groundColor,customElevationLayer:n?null===(s=n.profileChartSettings)||void 0===s?void 0:s.isCustomElevationLayer:this.defaultConfig.profileChartSettings.isCustomElevationLayer,elevationLayer:n?null===(o=n.profileChartSettings)||void 0===o?void 0:o.elevationLayerURL:this.defaultConfig.profileChartSettings.elevationLayerURL,selectedLinearUnit:n?this.selectedUnit[1]:this.defaultConfig.profileChartSettings.linearUnit,selectedElevationUnit:n?this.selectedUnit[0]:this.defaultConfig.profileChartSettings.elevationUnit})},this.createDefaultConfigForDataSource=()=>{let e="",t="";return e=O(this.props.portalSelf),t=(e=>"english"===(null==e?void 0:e.units)?"miles":"kilometers")(this.props.portalSelf),{profileChartSettings:{isCustomElevationLayer:!0,elevationLayerURL:"https://elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",linearUnit:t,elevationUnit:e,displayStatistics:!0,selectedStatistics:w,groundColor:"#b54900",graphicsHighlightColor:"#b54900",showVolumetricObjLineInGraph:!1,volumetricObjLineColor:"#cf4ccf",volumetricObjLabel:this.nls("volumetricObj")}}},this.canShowProfilingForBackward=e=>{var t,i,s,o;let n=!1;return e&&((null==e?void 0:e.hasOwnProperty("advanceOptions"))||(null===(t=null==e?void 0:e.profileSettings)||void 0===t?void 0:t.hasOwnProperty("isProfileSettingsEnabled"))&&(null===(i=null==e?void 0:e.profileSettings)||void 0===i?void 0:i.hasOwnProperty("isCustomizeOptionEnabled")))&&((null==e?void 0:e.advanceOptions)||(null===(s=null==e?void 0:e.profileSettings)||void 0===s?void 0:s.isProfileSettingsEnabled)&&(null===(o=null==e?void 0:e.profileSettings)||void 0===o?void 0:o.isCustomizeOptionEnabled))&&(n=!0),n},this.canShowSelectAndDrawOptions=e=>{var t;let i=!0;return(null===(t=null==e?void 0:e.profileSettings)||void 0===t?void 0:t.hasOwnProperty("isProfileSettingsEnabled"))&&(i=e.profileSettings.isProfileSettingsEnabled),i},this.createApiWidget=e=>{var t,i;const s=new ne.default({view:e?e.view:null,layer:new ae.default,updateOnGraphicClick:!1,defaultCreateOptions:{mode:"click",hasZ:"3d"===(null===(t=null==e?void 0:e.view)||void 0===t?void 0:t.type)},polylineSymbol:{type:"simple-line",color:this.state.graphicsHighlightColor,width:5},pointSymbol:pe.default.fromJSON(me),defaultUpdateOptions:{toggleToolOnClick:!1}});s.on("create",(t=>{if("start"===t.state){const e={type:"simple-line",color:this.state.graphicsHighlightColor,width:5};this.state.currentSketchVM.set("polylineSymbol",e)}else"complete"===t.state&&(this.setState({noFeaturesError:!1}),this.state.selectModeActive&&(this.setState({loadingIndicator:!0}),e.selectFeaturesByGraphic(t.graphic,"intersects").then((e=>{this.queryForNewSelection(e,!0)}),(e=>{const t=this.getErrorMsgState(L.UnknownError);this.setState({loadingIndicator:!1,viewModelErrorState:t[0],profileErrorMsg:t[1]})}))))})),this.setState({currentSketchVM:s}),null===(i=null==e?void 0:e.view)||void 0===i||i.on("click",(t=>{const i=this.nextPossibleSelectionLayer;this.state.addToSelectionTool&&(t.stopPropagation(),e.view.hitTest(t).then((e=>{if(e&&e.results){const t=e.results.filter((e=>"graphic"===e.type)).filter((e=>e.graphic.layer===i&&"polyline"===e.graphic.geometry.type));t&&t.length>0&&(this.clearChart(),this.newFeatureSelection=!1,this.mapView.clearSelectedFeatures(),this.selectFeatureForProfiling(t[0].graphic))}})))}))},this.createEpViewModel=e=>{var t,i,s,o,n;const a=[];if(this._defaultViewModel&&(this._defaultViewModel.profiles=a),this.state.customElevationLayer?a.push({type:"query",source:new ce.default({url:this.state.elevationLayer}),color:this.state.groundColor}):a.push({type:"ground",color:this.state.groundColor}),"3d"===this.state.jimuMapView.view.type&&(null===(i=null===(t=this.props.config.configInfo[this.state.currentDatasource])||void 0===t?void 0:t.profileChartSettings)||void 0===i?void 0:i.showVolumetricObjLineInGraph)&&a.push({type:"view",color:null===(o=null===(s=this.props.config.configInfo[this.state.currentDatasource])||void 0===s?void 0:s.profileChartSettings)||void 0===o?void 0:o.volumetricObjLineColor}),this._defaultViewModel){if(this._defaultViewModel.view=e.view,this._defaultViewModel.profiles=a,null===(n=this._defaultViewModel.input)||void 0===n?void 0:n.geometry){const e=new AbortController;this.setState({loadingIndicator:!0}),he.default.whenOnce((()=>1===this._defaultViewModel.progress),e.signal).then((()=>ve(this,void 0,void 0,(function*(){var t,i,s;const o=null===(s=null===(i=null===(t=this._defaultViewModel)||void 0===t?void 0:t.chartData)||void 0===i?void 0:i.lines)||void 0===s?void 0:s.find((e=>"ground"===e.type||"query"===e.type));this._defaultViewModel.chartData&&o?(yield new Promise((e=>setTimeout(e,500))),this.onChartDataReady(e.signal)):this.onErrorInChartData(!0,this.nls("noProfileError"))}))))}}else this._defaultViewModel=new de.default({view:e?e.view:null,profiles:a});const r=this._defaultViewModel;he.default.watch((()=>r.errorState),(e=>{var t;const i=this.getErrorMsgState(e);0!==(null==i?void 0:i.length)&&i&&(null===(t=this._abortController)||void 0===t||t.abort(),this.onErrorInChartData(i[0],i[1]))}),{initial:!0}),he.default.watch((()=>{var e;return null===(e=r.input)||void 0===e?void 0:e.geometry}),(()=>ve(this,void 0,void 0,(function*(){var e,t,i,s;if(r.input)try{null===(e=this._abortController)||void 0===e||e.abort();const{signal:o}=this._abortController=new AbortController;if(this.setState({loadingIndicator:!0,onDrawingComplete:"created"===this._defaultViewModel.state}),yield he.default.whenOnce((()=>1===r.progress),o),o.aborted)return;if(this._defaultViewModel.chartData){if(!(null===(s=null===(i=null===(t=this._defaultViewModel)||void 0===t?void 0:t.chartData)||void 0===i?void 0:i.lines)||void 0===s?void 0:s.find((e=>"ground"===e.type||"query"===e.type))))return void this.onErrorInChartData(!0,this.nls("noProfileError"));yield new Promise((e=>setTimeout(e,500))),yield this.onChartDataReady(o)}else this.onErrorInChartData(!0,this.state.profileErrorMsg)}catch(e){if(!ge.default.isAbortError(e))throw e}}))))},this.onChartDataReady=e=>ve(this,void 0,void 0,(function*(){if(this.state.drawModeActive||this.state.selectModeActive){const t=yield this.createBufferGraphics(!0);if(e.aborted)return;this.setState({intersectionResult:t,viewModelErrorState:!1,profileResult:this._defaultViewModel.chartData,chartDataUpdateTime:Date.now()},(()=>ve(this,void 0,void 0,(function*(){yield new Promise((e=>setTimeout(e,500))),this.setState({loadingIndicator:!1,startChartRendering:!0})}))))}})),this.onErrorInChartData=(e,t)=>{this.setState({loadingIndicator:!1,viewModelErrorState:e,profileErrorMsg:t||this.nls("unknownError"),startChartRendering:!1,profileResult:null,chartDataUpdateTime:Date.now()})},this.createBufferGraphics=e=>ve(this,void 0,void 0,(function*(){return new Promise((i=>{var s,o,n;if(this.bufferGraphics=null,this.selectedBufferValues)if(null===(s=this._defaultViewModel)||void 0===s?void 0:s.input)if(this.selectedBufferValues.enabled&&this.selectedBufferValues.bufferDistance>0){let s=this._defaultViewModel.input.geometry.clone();B.default.isSimple(s)||(s=B.default.simplify(s)),t.geometryUtils.createBuffer(s,[this.selectedBufferValues.bufferDistance],this.selectedBufferValues.bufferUnits).then((t=>{var s;const o=Array.isArray(t)?t[0]:t,n=new Z.default({geometry:o,symbol:pe.default.fromJSON(this.selectedBufferValues.bufferSymbol)});this.bufferGraphics=n,n&&this.bufferGraphics&&(null===(s=this.bufferLayer)||void 0===s||s.removeAll(),this.bufferLayer.add(n)),this.checkForIntersectingLayer(e).then((e=>{i(e)}))}))}else null===(o=this.bufferLayer)||void 0===o||o.removeAll(),this.checkForIntersectingLayer(e).then((e=>{i(e)}));else null===(n=this.bufferLayer)||void 0===n||n.removeAll(),e||this.setState({intersectionResult:[]}),i([]);else i([])}))})),this.onBufferChange=e=>{this.selectedBufferValues=e,this.createBufferGraphics()},this.getErrorMsgState=e=>{switch(e){case L.TooComplex:return[!0,this.nls("tooComplexError")];case L.InvalidGeometry:return[!0,this.nls("invalidGeometryError")];case L.InvalidElevationInfo:return[!0,this.nls("invalidElevationInfoError")];case L.UnknownError:return[!0,this.nls("unknownError")];case L.NoVisibleProfiles:case L.RefinedButNoChartData:return[!0,this.nls("noProfileError")];case L.None:return[]}},this.getSelectableLayers=e=>{const t=A(e),i=[],s=this.canShowSelectAndDrawOptions(this.props.config.configInfo[e])&&this.canShowProfilingForBackward(this.props.config.configInfo[e]);null==t||t.forEach((t=>{var o,n;const a=t;a&&a.layerDefinition&&a.layerDefinition.geometryType&&(s?"esriGeometryPolyline"===a.layerDefinition.geometryType&&(null===(n=null===(o=this.props.config.configInfo[e])||void 0===o?void 0:o.profileSettings.layers)||void 0===n||n.forEach((e=>{e.layerId===t.id&&i.push(t.id)}))):"esriGeometryPolyline"===a.layerDefinition.geometryType&&i.push(t.id))})),this.selectableLayersAtRuntime=i},this.checkSelectedFeaturesAvailability=e=>{var t;let i=!1;if(e){const s=this.getDSLayerID(e.layer.id);this.getSelectableLayers(this.state.currentDatasource),"polyline"===(null===(t=null==e?void 0:e.geometry)||void 0===t?void 0:t.type)&&this.selectableLayersAtRuntime.includes(s)&&(i=!0)}return i},this.displayFeaturesResult=e=>{var t;this.setState({initialStage:!1,resultStage:!0,selectModeActive:!0,drawModeActive:!1,onDrawingComplete:!1,startChartRendering:!1,viewModelErrorState:!1}),this._defaultViewModel&&this._defaultViewModel.clear(),(this.state.drawModeActive||this.state.selectModeActive)&&(null===(t=this.state.currentSketchVM)||void 0===t||t.cancel()),this.hideChartPosition(),this.queryForNewSelection(e,!1)},this.componentDidUpdate=e=>{var i,s,o,n,a,r,l,d,h,c,p,u,g,v;const f=null===(o=null===(s=null===(i=(0,t.getAppStore)())||void 0===i?void 0:i.getState())||void 0===s?void 0:s.widgetsRuntimeInfo[this.props.id])||void 0===o?void 0:o.state;if(f===t.WidgetState.Opened||!f){const t=null===(n=this.props)||void 0===n?void 0:n.selectedFeatureRecords;if((null==t?void 0:t.length)>0&&(!e||!e.mutableStatePropsVersion||!e.mutableStatePropsVersion.selectedFeatureRecords||(null===(a=null==e?void 0:e.mutableStatePropsVersion)||void 0===a?void 0:a.selectedFeatureRecords)!==(null===(r=this.props.mutableStatePropsVersion)||void 0===r?void 0:r.selectedFeatureRecords))){if(!this.checkSelectedFeaturesAvailability(null===(l=null==t?void 0:t[0])||void 0===l?void 0:l.feature))return;this.displayFeaturesResult([[null===(d=null==t?void 0:t[0])||void 0===d?void 0:d.feature]])}}if(this.props.appMode!==e.appMode&&this.props.appMode===t.AppMode.Run?this.state.addToSelectionTool&&this._displayAddToSelectionCursor():this.props.appMode!==e.appMode&&this.props.appMode===t.AppMode.Design&&this._displayDefaultCursor(),!this.mapView)return;if(e.useMapWidgetIds===this.props.useMapWidgetIds&&e.config.activeDataSource===this.props.config.activeDataSource||this.props.config.configInfo[this.props.config.activeDataSource]&&this.setState({currentDatasource:this.props.config.activeDataSource},(()=>{this.checkLineLayerAvailableInDsAndConfig(this.state.currentDatasource),this.setState({customElevationLayer:this.props.config.configInfo[this.state.currentDatasource].profileChartSettings.isCustomElevationLayer,elevationLayer:this.props.config.configInfo[this.state.currentDatasource].profileChartSettings.elevationLayerURL})})),e.state!==this.props.state&&!this.state.profileResult&&(this.state.drawModeActive||this.state.selectModeActive)){const e=(0,t.getAppStore)().getState().widgetsRuntimeInfo[this.props.id].state;e!==t.WidgetState.Opened&&e||this.loadSelectDrawToolOnLoad(this.activeCurrentDs)}const m=null===(h=this.props.config.configInfo)||void 0===h?void 0:h[this.state.currentDatasource],y=null===(c=e.config.configInfo)||void 0===c?void 0:c[this.state.currentDatasource];this.props.config.configInfo.hasOwnProperty(this.state.currentDatasource)&&(this.checkLineLayerAvailableInDsAndConfig(this.state.currentDatasource),this.setConfigForDataSources()),(null==y?void 0:y.profileChartSettings.groundColor)===(null==m?void 0:m.profileChartSettings.groundColor)&&(null==y?void 0:y.profileChartSettings.graphicsHighlightColor)===(null==m?void 0:m.profileChartSettings.graphicsHighlightColor)||this.setState({groundColor:null==m?void 0:m.profileChartSettings.groundColor,graphicsHighlightColor:null==m?void 0:m.profileChartSettings.graphicsHighlightColor},(()=>{var e,t;if(this.setState({chartColorRender:this.state.groundColor}),this.drawingLayer&&this.drawingLayer.graphics.length>0){const e={type:"simple-line",color:this.state.graphicsHighlightColor,width:5};this.drawingLayer.graphics.items.forEach((t=>{t.symbol=e}))}this._defaultViewModel&&this.state.groundColor&&(null===(t=null===(e=this._defaultViewModel.profiles.getItemAt(0))||void 0===e?void 0:e.color)||void 0===t||t.setColor(this.state.groundColor))})),(null==y?void 0:y.profileChartSettings.elevationUnit)===(null==m?void 0:m.profileChartSettings.elevationUnit)&&(null==y?void 0:y.profileChartSettings.linearUnit)===(null==m?void 0:m.profileChartSettings.linearUnit)||this.setState({selectedLinearUnit:null==m?void 0:m.profileChartSettings.linearUnit,selectedElevationUnit:null==m?void 0:m.profileChartSettings.elevationUnit}),(null==y?void 0:y.profileChartSettings.elevationLayerURL)===(null==m?void 0:m.profileChartSettings.elevationLayerURL)&&(null==y?void 0:y.profileChartSettings.isCustomElevationLayer)===(null==m?void 0:m.profileChartSettings.isCustomElevationLayer)||m&&y&&this.setState({elevationLayer:null==m?void 0:m.profileChartSettings.elevationLayerURL},(()=>{this.state.initialStage||this.activateToolForNewProfile(),this.createEpViewModel(this.mapView)})),(this.didProfileLayersSettingsChanged(null==y?void 0:y.profileSettings.layers,null==m?void 0:m.profileSettings.layers)||this.checkForPrevCurrentAdvanceConfig(y,m,this.nls("selectableLayersLabel")))&&this.setState({profileLineLayers:null==m?void 0:m.profileSettings.layers},(()=>{var e;let t=!1;!(null==m?void 0:m.profileSettings.isProfileSettingsEnabled)||(null==m?void 0:m.profileSettings.isCustomizeOptionEnabled)||0!==this.state.profileLineLayers.length||this.state.drawModeActive||this.state.selectModeActive||(this.onBackClick(),t=!0),(null==m?void 0:m.profileSettings.isProfileSettingsEnabled)||this.state.drawModeActive||(this.onBackClick(),t=!0),(null===(e=null==m?void 0:m.assetSettings)||void 0===e?void 0:e.isAssetSettingsEnabled)?this.createBufferGraphics():this.bufferLayer&&this.bufferLayer.removeAll(),this.setState({lineLayersNotFound:t})})),(this.didIntersectingLayersSettingsChanged(null===(p=null==y?void 0:y.assetSettings)||void 0===p?void 0:p.layers,null===(u=null==m?void 0:m.assetSettings)||void 0===u?void 0:u.layers)||this.checkForPrevCurrentAdvanceConfig(y,m,this.nls("intersectingLayersLabel")))&&((null===(g=null==m?void 0:m.assetSettings)||void 0===g?void 0:g.isAssetSettingsEnabled)?this.createBufferGraphics():this.bufferLayer&&this.bufferLayer.removeAll()),(null==y?void 0:y.profileChartSettings.volumetricObjLineColor)===(null==m?void 0:m.profileChartSettings.volumetricObjLineColor)&&(null==y?void 0:y.profileChartSettings.showVolumetricObjLineInGraph)===(null==m?void 0:m.profileChartSettings.showVolumetricObjLineInGraph)||this._defaultViewModel&&"3d"===(null===(v=this.state.jimuMapView.view)||void 0===v?void 0:v.type)&&this.createEpViewModel(this.mapView)},this.checkForPrevCurrentAdvanceConfig=(e,t,i)=>{var s,o,n,a,r,l,d,h;let c=!1;return i===this.nls("selectableLayersLabel")&&(!e||((null==e?void 0:e.hasOwnProperty("advanceOptions"))&&(null==e?void 0:e.advanceOptions))===((null==t?void 0:t.hasOwnProperty("advanceOptions"))&&(null==t?void 0:t.advanceOptions))&&((null==e?void 0:e.profileSettings.hasOwnProperty("isProfileSettingsEnabled"))&&(null===(s=null==e?void 0:e.profileSettings)||void 0===s?void 0:s.isProfileSettingsEnabled))===((null==t?void 0:t.profileSettings.hasOwnProperty("isProfileSettingsEnabled"))&&(null===(o=null==t?void 0:t.profileSettings)||void 0===o?void 0:o.isProfileSettingsEnabled))&&((null==e?void 0:e.profileSettings.hasOwnProperty("isCustomizeOptionEnabled"))&&(null===(n=null==e?void 0:e.profileSettings)||void 0===n?void 0:n.isCustomizeOptionEnabled))===((null==t?void 0:t.profileSettings.hasOwnProperty("isCustomizeOptionEnabled"))&&(null===(a=null==t?void 0:t.profileSettings)||void 0===a?void 0:a.isCustomizeOptionEnabled))||(c=!0)),i===this.nls("intersectingLayersLabel")&&e&&(((null==e?void 0:e.hasOwnProperty("advanceOptions"))&&(null==e?void 0:e.advanceOptions))!==((null==t?void 0:t.hasOwnProperty("advanceOptions"))&&(null==t?void 0:t.advanceOptions))||(null==e?void 0:e.hasOwnProperty("assetSettings"))&&((null===(r=null==e?void 0:e.assetSettings)||void 0===r?void 0:r.hasOwnProperty("isAssetSettingsEnabled"))&&(null===(l=null==e?void 0:e.assetSettings)||void 0===l?void 0:l.isAssetSettingsEnabled))!==((null===(d=null==t?void 0:t.assetSettings)||void 0===d?void 0:d.hasOwnProperty("isAssetSettingsEnabled"))&&(null===(h=null==t?void 0:t.assetSettings)||void 0===h?void 0:h.isAssetSettingsEnabled)))&&(c=!0),c},this.didProfileLayersSettingsChanged=(e,t)=>{let i=!1;return(null==e?void 0:e.length)!==(null==t?void 0:t.length)&&(i=!0),i},this.didIntersectingLayersSettingsChanged=(e,t)=>{let i=!1;return(null==e?void 0:e.length)!==(null==t?void 0:t.length)&&(i=!0),i},this.componentWillUnmount=()=>{var e,t;this._defaultViewModel&&this._defaultViewModel.clear(),this.state.currentSketchVM&&(null===(e=this.state.currentSketchVM)||void 0===e||e.cancel()),this.destroyDrawingLayers(),this._displayDefaultCursor(),null===(t=this.mapView)||void 0===t||t.clearSelectedFeatures()},this.buildOutputStatistics=(e,t,i)=>{var s,o,n;this.buildStatsValuesAsOutput(null===(o=null===(s=this._defaultViewModel)||void 0===s?void 0:s.visibleProfiles)||void 0===o?void 0:o[0],null===(n=this.props.outputDataSources)||void 0===n?void 0:n[0],e,t,i)},this.getOutputDataSource=e=>t.DataSourceManager.getInstance().getDataSource(e),this.buildStatsValuesAsOutput=(e,s,o,n,a)=>{var r,l,d;if(!this.getOutputDataSource(s))return;const h=[];h.push({alias:"OBJECTID",type:"double",name:"OBJECTID"}),w.forEach((e=>{h.push({alias:this.nls(e.value).replace(/ /g,""),type:"string",name:this.nls(e.value).replace(/ /g,"")})}));const c={},p=this.outputStatisticsValueDisplay(e,s,o,n,a);c.OBJECTID=0,p.forEach(((e,t)=>{var i;c[null===(i=h[t+1])||void 0===i?void 0:i.name]=null==e?void 0:e.statValue}));const u=new Z.default({attributes:c,geometry:null}),g=[];h.forEach((e=>{if(e.name){const t={fieldName:e.name,label:e.alias};g.push(t)}}));const v=Object.assign({},i.defaultMessages),f=new ue.default({id:s+"_layer",title:this.props.intl.formatMessage({id:"outputStatistics",defaultMessage:v.outputStatistics},{name:this.props.label}),fields:h,geometryType:"point",source:[u],objectIdField:"OBJECTID",popupTemplate:{title:this.props.intl.formatMessage({id:"outputStatistics",defaultMessage:v.outputStatistics},{name:this.props.label}),content:[{type:"fields",fieldInfos:g}]}});this.getOutputDataSource(s).layer=f;const m=c?t.DataSourceStatus.Unloaded:t.DataSourceStatus.NotReady;null===(r=this.getOutputDataSource(s))||void 0===r||r.setStatus(m),null===(l=this.getOutputDataSource(s))||void 0===l||l.setCountStatus(m),null===(d=this.getOutputDataSource(s))||void 0===d||d.addSourceVersion()},this.outputStatisticsValueDisplay=(e,t,i,s,o)=>{const n=[];let a="",r=null,l="";return w.forEach((t=>{var d;l=t.value,(null==e?void 0:e.statistics)?(o&&l!==C.AvgElevation&&l!==C.MaxDistance&&l!==C.MaxElevation&&l!==C.MinElevation&&(l=I(l)),r=null===(d=null==e?void 0:e.statistics)||void 0===d?void 0:d[l],a=this.getStatsValueWithUnit(e,r,l,i,s)):a=this.nls("noStatsValue"),n.push({statName:t.value,statValue:a})})),n},this.getStatsValueWithUnit=(e,t,i,s,o)=>{let n="",a=null;return x.forEach((r=>{i===C.MaxDistance?r.value===o&&(a=R(t,null==e?void 0:e.effectiveUnits.distance,o),n=this.props.intl.formatNumber(a,{maximumFractionDigits:2})+" "+this.nls(r.abbreviation)):i===C.MaxPositiveSlope||i===C.MaxNegativeSlope||i===C.AvgPositiveSlope||i===C.AvgNegativeSlope?n=null===t?this.nls("noStatsValue"):this.props.intl.formatNumber(t,{maximumFractionDigits:2})+" ":r.value===s&&(a=R(t,null==e?void 0:e.effectiveUnits.elevation,s),n=this.props.intl.formatNumber(a,{maximumFractionDigits:2})+" "+this.nls(r.abbreviation))})),n},this.queryForNewSelection=(e,i)=>{let s=null;e.length>0&&e.forEach((e=>{var t,o,n,a,r,l,d,h;if(e.length>0){const c=this.getDSLayerID(e[0].layer.id);if("polyline"===(null===(t=e[0].geometry)||void 0===t?void 0:t.type)&&this.selectableLayersAtRuntime.includes(c)){if("3d"===this.state.jimuMapView.view.type&&(null===(n=null===(o=e[0])||void 0===o?void 0:o.layer)||void 0===n?void 0:n.elevationInfo)){const t=null===(r=null===(a=e[0])||void 0===a?void 0:a.layer)||void 0===r?void 0:r.elevationInfo;this.drawingLayer.set("elevationInfo",t),this.nextPossibleSelectionLayer.set("elevationInfo",t)}return this.newFeatureSelection=!0,this.setState({noGraphicAfterFirstSelection:!0}),s=new Z.default({geometry:null===(l=e[0])||void 0===l?void 0:l.geometry,attributes:(null===(d=e[0])||void 0===d?void 0:d.attributes)?null===(h=e[0])||void 0===h?void 0:h.attributes:{}}),s.attributes.esriCTFeatureLayerId=c,i&&this.mapView.clearSelectedFeatures(),!0}}})),(this.drawingLayer||this.bufferLayer)&&(this.drawingLayer.removeAll(),this.bufferLayer.removeAll()),s?(this.setState({drawModeActive:!1,noFeaturesError:!1,viewModelErrorState:!1}),t.geometryUtils.projectToSpatialReference([s.geometry],this.state.jimuMapView.view.spatialReference).then((e=>{(null==e?void 0:e.length)>0&&(s.geometry=e[0]),this.selectFeatureForProfiling(s)}),(e=>{console.log(e),this.selectFeatureForProfiling(s)}))):(this.state.selectModeActive&&this.state.currentSketchVM.create("point"),this.setState({loadingIndicator:!1,noFeaturesError:!0}))},this.checkForIntersectingLayer=e=>new Promise((t=>{var i,s,o,n,a;const r=null===(s=null===(i=this._defaultViewModel)||void 0===i?void 0:i.input)||void 0===s?void 0:s.geometry,l=[],d=A(this.state.jimuMapView.dataSourceId),h=["group","feature"],c=this.mapView.view.map.layers.toArray().filter((e=>h.includes(e.type)&&this.considerLayerVisibility(e))),p=null===(n=null===(o=this.props.config.configInfo[this.state.currentDatasource])||void 0===o?void 0:o.assetSettings)||void 0===n?void 0:n.layers;(null===(a=this.intersectingLayersAtRuntime)||void 0===a?void 0:a.length)>0&&(null==d||d.forEach((e=>{this.intersectingLayersAtRuntime.forEach((t=>{t===e.id&&c.forEach((i=>{if("group"===i.type)i.layers.toArray().forEach((i=>{if(i.id===e.jimuChildId&&this.considerLayerVisibility(i)){const e=p.find((e=>t===e.layerId));l.push(this.queryForIntersectingLayers(e,r))}}));else if("feature"===i.type&&i.id===e.jimuChildId){const e=p.find((e=>t===e.layerId));l.push(this.queryForIntersectingLayers(e,r))}}))}))}))),Promise.all(l).then((i=>{e||this.setState({intersectionResult:i}),t(i)}))})),this.queryForIntersectingLayers=(e,i)=>ve(this,void 0,void 0,(function*(){const s=this.bufferGraphics,o=t.DataSourceManager.getInstance().getDataSource(e.layerId);return new Promise((t=>{var n,a,r,l;if("esriGeometryPolyline"===(null===(n=null==o?void 0:o.layerDefinition)||void 0===n?void 0:n.geometryType)||"esriGeometryPoint"===(null===(a=null==o?void 0:o.layerDefinition)||void 0===a?void 0:a.geometryType)){const n={};n.geometry=(null==s?void 0:s.geometry)?s.geometry.toJSON():i.toJSON(),n.returnGeometry=!0,n.returnZ=!0;const a=this.filterExistingFeatures(o);a&&(n.where=a),n.outFields=[o.layerDefinition.objectIdField],e.displayField&&!n.outFields.includes(e.displayField)&&n.outFields.push(e.displayField),(null===(r=e.elevationSettings)||void 0===r?void 0:r.field1)&&!n.outFields.includes(e.elevationSettings.field1)&&n.outFields.push(e.elevationSettings.field1),(null===(l=e.elevationSettings)||void 0===l?void 0:l.field2)&&!n.outFields.includes(e.elevationSettings.field2)&&n.outFields.push(e.elevationSettings.field2),n.outFields=["*"],n.distance=.1,n.units="esriSRUnit_Meter";try{o.query(n).then((n=>{const a=[];(null==n?void 0:n.records.length)>0&&n.records.forEach((e=>{const t=e.feature,o=[],n=[],r={connectedFeatureForProfiling:n,disconnectedFeatureForProfiling:o,intersectingFeature:t,record:e},l=t.geometry;if("polyline"===l.type){let e=i;const t=B.default.intersect(l,s?s.geometry:e);if(t&&n.push(t),s){const t=s.geometry;e=new G.default({hasZ:t.hasZ,hasM:t.hasM,paths:t.rings,spatialReference:t.spatialReference})}const a=B.default.intersectLinesToPoints(l,e);a.length>0&&a.forEach((e=>{t&&B.default.intersects(e,t)||o.push(e)}))}a.push(r)}));const r={title:o.getLabel(),settings:e,intersectionResult:a,inputGeometry:i};t(r)}),(e=>{console.log(e),t(null)}))}catch(e){t(null)}}else t(null)}))})),this.considerLayerVisibility=e=>e.visible&&(e.minScale>=this.mapView.view.scale&&e.maxScale<=this.mapView.view.scale||0===e.minScale&&e.maxScale<=this.mapView.view.scale||0===e.maxScale&&e.minScale>=this.mapView.view.scale||0===e.minScale&&0===e.maxScale),this.getDSLayerID=e=>{var t,i;let s="";if(null===(i=null===(t=this.state)||void 0===t?void 0:t.jimuMapView)||void 0===i?void 0:i.dataSourceId){const t=A(this.state.jimuMapView.dataSourceId);null==t||t.forEach((t=>{if(t.jimuChildId===e)return s=t.id,!0}))}return s},this.queryForIndividualLayers=(e,t)=>{var i,s;const o=[],n=A(e),a=this.mapView.view.map.layers.toArray();let r=!0,l=!0;if(this.canShowSelectAndDrawOptions(this.props.config.configInfo[this.state.currentDatasource])&&this.canShowProfilingForBackward(this.props.config.configInfo[this.state.currentDatasource])){if((null===(i=this.props.config.configInfo[this.state.currentDatasource])||void 0===i?void 0:i.profileSettings.layers.length)>0){const e=null===(s=this.props.config.configInfo[this.state.currentDatasource])||void 0===s?void 0:s.profileSettings.layers;null==n||n.forEach((i=>{this.selectableLayersAtRuntime.forEach((s=>{s===i.id&&a.forEach((s=>{const n=s;"group"===n.type?(l=this.considerLayerVisibility(n),l&&n.layers.toArray().forEach((s=>{r=this.considerLayerVisibility(s),s.id===i.jimuChildId&&r&&e.forEach((e=>{e.layerId===i.id&&o.push(this.queryIndividualLayer(s,i,t))}))}))):"feature"===n.type&&(r=this.considerLayerVisibility(n),s.id===i.jimuChildId&&r&&e.forEach((e=>{e.layerId===i.id&&o.push(this.queryIndividualLayer(s,i,t))})))}))}))}))}}else null==n||n.forEach((e=>{const i=e;this.selectableLayersAtRuntime.forEach((s=>{s===i.id&&a.forEach((s=>{var n;const a=s;"group"===a.type?(l=this.considerLayerVisibility(a),l&&a.layers.toArray().forEach((e=>{var s;r=this.considerLayerVisibility(e),e.id===i.jimuChildId&&r&&(null===(s=i.layerDefinition)||void 0===s?void 0:s.geometryType)&&"esriGeometryPolyline"===i.layerDefinition.geometryType&&o.push(this.queryIndividualLayer(e,i,t))}))):"feature"===a.type&&(r=this.considerLayerVisibility(a),s.id===e.jimuChildId&&r&&(null===(n=i.layerDefinition)||void 0===n?void 0:n.geometryType)&&"esriGeometryPolyline"===i.layerDefinition.geometryType&&o.push(this.queryIndividualLayer(s,e,t)))}))}))}));return o},this.queryIndividualLayer=(e,t,i)=>ve(this,void 0,void 0,(function*(){let s=null;s=this.mapView.view.map.findLayerById(e.id);const o=this.getMetersForVerticalSR(s),n=this.filterExistingFeatures(t),a=e.definitionExpression,r=Date.now();let l=null;l=new le.default,l.geometry=i,l.returnGeometry=!0,l.returnZ=!0,l.outSpatialReference=this.state.jimuMapView.view.spatialReference,l.outFields=["*"],l.where=n?a?n+" AND "+a+" AND "+r+"="+r:n+" AND "+r+"="+r:a?a+" AND "+r+"="+r:r+"="+r;let d=[];try{yield s.queryFeatures(l).then((e=>{e.features.length>0&&e.features.forEach((e=>{if(o){const t=H.default.getMetersPerUnitForSR(new W.default(this.mapView.view.spatialReference.toJSON())),i=e.geometry;i.paths.length>0&&i.paths.forEach((e=>{e.length>0&&e.forEach((e=>{e.length>1&&(e[2]=e[2]*o/t)}))}))}e.attributes.esriCTFeatureLayerId=t.dataSourceJson.id})),d=e.features}),(e=>{console.log(e)}))}catch(e){d=[]}return d})),this.getMetersForVerticalSR=e=>{var t,i,s,o;let n=1;return n=(null===(i=null===(t=e.sourceJSON)||void 0===t?void 0:t.sourceSpatialReference)||void 0===i?void 0:i.vcsWkid)?H.default.getMetersPerVerticalUnitForSR(new W.default({wkid:e.sourceJSON.sourceSpatialReference.vcsWkid})):(null===(o=null===(s=e.sourceJSON)||void 0===s?void 0:s.sourceSpatialReference)||void 0===o?void 0:o.vcsWkt)?H.default.getMetersPerVerticalUnitForSR(new W.default({wkid:e.sourceJSON.sourceSpatialReference.vcsWkt})):null,n},this.filterExistingFeatures=e=>{let t="";const i=e.layer.objectIdField,s=this.drawingLayer.graphics.filter((t=>{var i;return!(!(null===(i=null==t?void 0:t.attributes)||void 0===i?void 0:i.hasOwnProperty("esriCTFeatureLayerId"))||t.attributes.esriCTFeatureLayerId!==e.dataSourceJson.id)}));return s.forEach(((o,n)=>{var a;(null===(a=null==o?void 0:o.attributes)||void 0===a?void 0:a.hasOwnProperty("esriCTFeatureLayerId"))&&o.attributes.esriCTFeatureLayerId===e.dataSourceJson.id&&(n===s.length-1?t+=i+" <> "+o.attributes[i]:t+=i+" <> "+o.attributes[i]+" and ")})),t},this.selectFeatureForProfiling=e=>{let t=!1,i=!1;const s=this.drawingLayer.graphics.length;if(s>0){const o=this.drawingLayer.graphics.getItemAt(0).geometry,n=this.drawingLayer.graphics.getItemAt(s-1).geometry,a=o.getPoint(0,0),r=n.getPoint(0,n.paths[0].length-1),l=e.geometry.getPoint(0,0),d=e.geometry.getPoint(0,e.geometry.paths[0].length-1);B.default.intersects(l,a)?(t=!0,i=!0):B.default.intersects(d,a)?(t=!0,i=!1):B.default.intersects(d,r)?(t=!1,i=!0):B.default.intersects(l,r)&&(t=!1,i=!1)}const o={type:"simple-line",color:new Y.default(this.state.graphicsHighlightColor).toRgba(),width:5},n=e.geometry;if(i){const e=[];for(let t=n.paths.length-1;t>=0;t--){const i=[];for(let e=n.paths[t].length-1;e>=0;e--)i.push(n.paths[t][e]);e.push(i)}n.paths=e}const a=new Z.default({geometry:n,attributes:e.attributes,symbol:o});let r=!1;!this.state.addToSelectionTool&&this._defaultViewModel&&(this._defaultViewModel.input=a,r=!0),t?this.drawingLayer.graphics.add(a,0):this.drawingLayer.graphics.add(a),this.nextPossibleSelectionLayer.removeAll(),setTimeout((()=>{this.renderChartOnSelect(r),this.highlightNextPossibleSelection()}),200)},this.createSinglePathPolyline=e=>{const t=[];e.paths.forEach((e=>{e.forEach((e=>t.push(e)))}));const i=new G.default({hasZ:e.hasZ,spatialReference:e.spatialReference.toJSON()});return i.addPath(t),i},this.renderChartOnSelect=e=>{if(this.state.addToSelectionTool){let t;if(this.drawingLayer.graphics.length>1){const e=new G.default({spatialReference:this.drawingLayer.graphics.getItemAt(0).geometry.spatialReference.toJSON()});let i=[];this.drawingLayer.graphics.forEach((t=>{const s=t.geometry;if(s.paths.length>1)s.paths.forEach((t=>{i.length>0?(t.forEach((e=>i.push(e))),e.addPath(i),i=[]):e.addPath(t)}));else{const t=e.paths.length;t>0?s.paths.forEach((i=>{i.forEach((i=>e.paths[t-1].push(i)))})):s.paths.forEach((e=>{e.forEach((e=>i.push(e)))}))}})),i.length>0&&e.addPath(i),t=new Z.default({geometry:e})}else 1===this.drawingLayer.graphics.length&&(t=this.drawingLayer.graphics.getItemAt(0));!e&&this._defaultViewModel&&(this._defaultViewModel.input=t)}},this.highlightNextPossibleSelection=()=>{let e,t,i,s;const o=this.drawingLayer.graphics.length;if(o>0){i=this.drawingLayer.graphics.getItemAt(0).geometry,e=i.getPoint(0,0);let n=i.paths[0].length-1;t=i.getPoint(0,n),o>1&&(s=this.drawingLayer.graphics.getItemAt(o-1).geometry,n=s.paths[0].length-1,t=s.getPoint(0,n));const a=new Z.default({geometry:e});this.nextPossibleSelectionLayer.graphics.add(a);const r=new Z.default({geometry:t});this.nextPossibleSelectionLayer.graphics.add(r),this.queryForNextPossibleSelection([e,t])}},this.queryForNextPossibleSelection=e=>{let t=[];e.forEach((e=>{t=t.concat(this.queryForIndividualLayers(this.state.jimuMapView.dataSourceId,this.pointToExtent(e)))})),this.setState({nextPossibleloadingIndicator:!0}),Promise.all(t).then((t=>{this.setState({nextPossibleloadingIndicator:!1});const i=[],s=t.flat();(null==s?void 0:s.length)>0&&(s.forEach((t=>{var s,o,n,a,r;if((null===(o=null===(s=null==t?void 0:t.geometry)||void 0===s?void 0:s.paths)||void 0===o?void 0:o.length)>0){const s=t.geometry.getPoint(0,0),o=t.geometry.paths[t.geometry.paths.length-1].length-1,l=t.geometry.getPoint(0,o);if(s&&B.default.intersects(e[0],s)||l&&B.default.intersects(e[0],l)||s&&B.default.intersects(e[1],s)||l&&B.default.intersects(e[1],l)){const e={type:"simple-line",color:[252,252,3,.8],style:"short-dot",width:"3d"===(null===(r=null===(a=null===(n=this.state)||void 0===n?void 0:n.jimuMapView)||void 0===a?void 0:a.view)||void 0===r?void 0:r.type)?7:4},s=new Z.default({geometry:t.geometry,attributes:t.attributes,symbol:e});i.push(s)}}})),i&&i.length>0&&this.nextPossibleSelectionLayer.graphics.addMany(i)),setTimeout((()=>{this.updateStateCanAddToSelection()}),200)}),(e=>{console.log(e),this.updateStateCanAddToSelection()}))},this.updateStateCanAddToSelection=()=>{let e=!1;this.nextPossibleSelectionLayer.graphics.filter((e=>"polyline"===e.geometry.type)).length>0?e=!0:this.newFeatureSelection?this.setState({noGraphicAfterFirstSelection:!0}):this.setState({noGraphicAfterFirstSelection:!1}),e?this._activateAddToSelectionTool():this._deActivateAddToSelectionTool()},this._activateAddToSelectionTool=()=>{var e;this.state.addToSelectionTool||this.setState({addToSelectionTool:!0}),this.state.jimuMapView&&this.state.jimuMapView.view&&(this.state.jimuMapView.view.popupEnabled=!1),this._displayAddToSelectionCursor(),null===(e=this.nextPossibleSelectionLayer)||void 0===e||e.set("visible",!0)},this._deActivateAddToSelectionTool=()=>{var e;this.state.addToSelectionTool&&this.setState({addToSelectionTool:!1}),this.state.jimuMapView&&this.state.jimuMapView.view&&(this.state.jimuMapView.view.popupEnabled=!0),this._displayDefaultCursor(),null===(e=this.nextPossibleSelectionLayer)||void 0===e||e.set("visible",!1)},this._displayAddToSelectionCursor=()=>{this.state.jimuMapView&&this.state.jimuMapView.view&&this.state.jimuMapView.view&&this.state.jimuMapView.view.container&&null!==this.state.jimuMapView.view.container.style.cursor&&(this.state.jimuMapView.view.container.style.cursor="copy")},this.activateDrawOrSelectTool=()=>{this.state.currentSketchVM&&((this.state.drawModeActive||this.state.selectModeActive)&&this.state.currentSketchVM.cancel(),this.setState({onDrawingComplete:!1,startChartRendering:!1,viewModelErrorState:!1,loadingIndicator:!1},(()=>{this.state.drawModeActive&&this._defaultViewModel&&this._defaultViewModel.start({mode:"sketch"}),this.state.selectModeActive&&this.state.currentSketchVM.create("point")})))},this.destroyDrawingLayers=()=>{this.drawingLayer&&(this.drawingLayer.removeAll(),this.drawingLayer.destroy()),this.nextPossibleSelectionLayer&&(this.nextPossibleSelectionLayer.removeAll(),this.nextPossibleSelectionLayer.destroy()),this.bufferLayer&&(this.bufferLayer.removeAll(),this.bufferLayer.destroy()),this.intersectionHighlightLayer&&(this.intersectionHighlightLayer.removeAll(),this.intersectionHighlightLayer.destroy()),this.hideChartPosition()},this._displayDefaultCursor=()=>{this.state.jimuMapView&&this.state.jimuMapView.view&&this.state.jimuMapView.view&&this.state.jimuMapView.view.container&&null!==this.state.jimuMapView.view.container.style.cursor&&(this.state.jimuMapView.view.container.style.cursor=null)},this.pointToExtent=(e,t=5)=>{const i=t*(this.state.jimuMapView.view.extent.get("width")/this.state.jimuMapView.view.get("width")),s={xmin:e.x-i,ymin:e.y-i,xmax:e.x+i,ymax:e.y+i,spatialReference:this.state.jimuMapView.view.spatialReference};return new re.default(s)},this.selectableLayersAvailableAtRuntime=e=>{this.selectableLayersAtRuntime=e},this.intersectingLayersAvailableAtRuntime=e=>{this.intersectingLayersAtRuntime=e,this.resultsAfterIntersectionTimeout&&clearTimeout(this.resultsAfterIntersectionTimeout),this.resultsAfterIntersectionTimeout=setTimeout((()=>{this.resultsAfterIntersectionTimeout=null,this.createBufferGraphics()}),500)},this.onSelectButtonClicked=()=>{this.setState({initialStage:!1,resultStage:!0,selectModeActive:!0,drawModeActive:!1},(()=>{this.activateDrawOrSelectTool()}))},this.onDrawButtonClicked=()=>{this.setState({initialStage:!1,resultStage:!0,selectModeActive:!1,drawModeActive:!0},(()=>{this.activateDrawOrSelectTool()}))},this.onBackClick=()=>{this.clearAll(),this.setState({initialStage:!0,startChartRendering:!1,onDrawingComplete:!1,resultStage:!1,drawModeActive:!1,selectModeActive:!1})},this.clearAll=()=>{var e;this._defaultViewModel&&this._defaultViewModel.clear(),(this.state.drawModeActive||this.state.selectModeActive)&&(null===(e=this.state.currentSketchVM)||void 0===e||e.cancel()),this._deActivateAddToSelectionTool(),this.clearGraphics(),this.mapView.clearSelectedFeatures(),this.clearChart()},this.clearGraphics=()=>{this.drawingLayer&&this.drawingLayer.removeAll(),this.nextPossibleSelectionLayer&&this.nextPossibleSelectionLayer.removeAll(),this.bufferLayer&&this.bufferLayer.removeAll(),this.intersectionHighlightLayer&&this.intersectionHighlightLayer.removeAll(),this.hideChartPosition()},this.clearChart=()=>{this.setState({profileResult:null,noFeaturesError:!1},(()=>{var e;this.buildStatsValuesAsOutput(this.state.profileResult,null===(e=this.props.outputDataSources)||void 0===e?void 0:e[0],"","",!1)}))},this.activateToolForNewProfile=()=>{this.clearAll(),this.setState({initialStage:!1,resultStage:!0},(()=>{this.activateDrawOrSelectTool()}))},this.onDoneButtonCLicked=()=>{let e=!1;return this._defaultViewModel.stop(),"created"!==this._defaultViewModel.state&&"selected"!==this._defaultViewModel.state||(e=!0),e?this.stopFurtherSelectingLines():this.activateDrawOrSelectTool(),e},this.stopFurtherSelectingLines=()=>{this._deActivateAddToSelectionTool(),this.nextPossibleSelectionLayer&&this.nextPossibleSelectionLayer.removeAll()},this.highlightChartPosition=e=>{this._defaultViewModel&&(this._defaultViewModel.hoveredChartPosition=e)},this.hideChartPosition=()=>{this._defaultViewModel&&(this._defaultViewModel.hoveredChartPosition=null)},this.renderFrontLandingPage=()=>{var s,o;return(0,t.jsx)("div",{tabIndex:-1,className:"h-100 w-100 d-flex align-items-center mainSection"},(0,t.jsx)("div",{tabIndex:-1,className:"adjust-cards"},(0,t.jsx)(i.Card,{tabIndex:0,"aria-label":this.nls("selectLinesDesc"),button:!0,"data-testid":"selectButton",className:(0,t.classNames)("front-cards mt-3 mb-3 shadow","default"===this.state.currentDatasource||this.state.lineLayersNotFound?"hidden":"front-section"),onClick:this.onSelectButtonClicked,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.onSelectButtonClicked()}},(0,t.jsx)(i.CardBody,{className:"w-100 h-100 p-3"},(0,t.jsx)("h5",{className:"text-truncate",style:{textAlign:"center"}},this.nls("selectLinesLabel")),(0,t.jsx)("p",{title:this.nls("selectLinesDesc"),className:"m-3 userGuideInfo"},this.nls("selectLinesDesc")),(0,t.jsx)("div",{style:{textAlign:"center"}},(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("selectButtonLabel"),title:this.nls("selectButtonLabel"),size:"default",type:"secondary",className:"text-break"},(null===(s=this.props.config.generalSettings)||void 0===s?void 0:s.buttonStyle)===e.IconText&&(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)(i.Icon,{size:"12",icon:fe.selectIcon}),this.nls("selectButtonLabel")))))),(0,t.jsx)(i.Card,{tabIndex:0,"aria-label":this.nls("drawProfileDesc"),button:!0,"data-testid":"drawButton",className:(0,t.classNames)("front-cards front-section mt-3 mb-3 shadow","default"===this.state.currentDatasource||this.state.lineLayersNotFound?"h-100 ":""),onClick:this.onDrawButtonClicked,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.onDrawButtonClicked()}},(0,t.jsx)(i.CardBody,{className:"w-100 h-100 p-3"},(0,t.jsx)("h5",{className:"text-truncate",style:{textAlign:"center"}},this.nls("drawProfileLabel")),(0,t.jsx)("p",{title:this.nls("drawProfileDesc"),className:"m-3 userGuideInfo"},this.nls("drawProfileDesc")),(0,t.jsx)("div",{style:{textAlign:"center"}},(0,t.jsx)(i.Button,{role:"button","aria-label":this.nls("drawButtonLabel"),title:this.nls("drawButtonLabel"),size:"default",type:"secondary",className:"text-break"},(null===(o=this.props.config.generalSettings)||void 0===o?void 0:o.buttonStyle)===e.IconText&&(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)(i.Icon,{size:"12",icon:fe.drawIcon}),this.nls("drawButtonLabel"))))))))},this.resetToDefault=()=>{var e,t;this.buildStatsValuesAsOutput(null,null===(e=this.props.outputDataSources)||void 0===e?void 0:e[0],this.state.selectedElevationUnit,this.state.selectedLinearUnit,!1),(this.state.drawModeActive||this.state.selectModeActive)&&(null===(t=this.state.currentSketchVM)||void 0===t||t.cancel()),this._defaultViewModel&&this._defaultViewModel.clear(),this.clearGraphics(),this._displayDefaultCursor()},this.defaultConfig=this.createDefaultConfigForDataSource(),this.newFeatureSelection=!1,this.widgetOpenedWithSelection=!1,this.createDrawingLayers(),this.activeCurrentDs="default",this.selectableLayersAtRuntime=[],this.intersectingLayersAtRuntime=[];const c=this.props.config.configInfo[this.props.config.activeDataSource];this.selectedUnit=F(c,this.props.portalSelf),this.bufferGraphics=null,this.state={initialStage:!0,resultStage:!1,selectModeActive:null===(o=this.props.config.generalSettings)||void 0===o?void 0:o.isSelectToolActive,addToSelectionTool:!1,drawModeActive:null===(n=this.props.config.generalSettings)||void 0===n?void 0:n.isDrawToolActive,onDrawingComplete:!1,currentDatasource:this.props.config.activeDataSource,currentSketchVM:null,jimuMapView:null,startChartRendering:!1,groundColor:null===(a=null==c?void 0:c.profileChartSettings)||void 0===a?void 0:a.groundColor,graphicsHighlightColor:null===(r=null==c?void 0:c.profileChartSettings)||void 0===r?void 0:r.graphicsHighlightColor,chartColorRender:"",customElevationLayer:null===(d=null==c?void 0:c.profileChartSettings)||void 0===d?void 0:d.isCustomElevationLayer,elevationLayer:null===(h=null==c?void 0:c.profileChartSettings)||void 0===h?void 0:h.elevationLayerURL,profileResult:null,selectedLinearUnit:this.selectedUnit[1],selectedElevationUnit:this.selectedUnit[0],noFeaturesError:!1,profileLineLayers:[],lineLayersNotFound:!(this.canShowSelectAndDrawOptions(c)&&this.canShowProfilingForBackward(c)&&0!==c.profileSettings.layers.length||this.canShowSelectAndDrawOptions(c)&&!this.canShowProfilingForBackward(c)),viewModelErrorState:!1,profileErrorMsg:"",noGraphicAfterFirstSelection:!1,onWidgetLoadShowLoadingIndicator:!0,loadingIndicator:!1,nextPossibleloadingIndicator:!1,selectedFeatureRecord:null,intersectionResult:null,chartDataUpdateTime:0}}render(){var e,n;const a=this.renderFrontLandingPage();let r;const l=this.props.useMapWidgetIds&&this.props.useMapWidgetIds[0];return this.props.config.useMapWidget&&this.props.hasOwnProperty("useMapWidgetIds")&&this.props.useMapWidgetIds&&1===this.props.useMapWidgetIds.length&&(r=(0,t.jsx)(s.JimuMapViewComponent,{useMapWidgetId:this.props.useMapWidgetIds[0],onActiveViewChange:this.activeViewChangeHandler.bind(this)})),l?(0,t.jsx)("div",{css:o(this.props.theme),className:"jimu-widget"},(0,t.jsx)("div",{className:"widget-elevation-profile"},this.state.onWidgetLoadShowLoadingIndicator&&(0,t.jsx)(i.Loading,{type:i.LoadingType.Secondary}),r,!this.state.onWidgetLoadShowLoadingIndicator&&this.state.initialStage&&a,!this.state.onWidgetLoadShowLoadingIndicator&&this.state.resultStage&&(0,t.jsx)(oe,{theme:this.props.theme,intl:this.props.intl,widgetId:this.props.id,displayLoadingIndicator:this.state.loadingIndicator||this.state.nextPossibleloadingIndicator,activeDataSource:this.state.currentDatasource,commonDsGeneralSettings:this.props.config.generalSettings,defaultConfig:this.defaultConfig,activeDatasourceConfig:this.props.config.configInfo[this.state.currentDatasource],profileResult:this.state.profileResult,intersectionResult:this.state.intersectionResult,visibleGroundProfileStats:null===(n=null===(e=this._defaultViewModel)||void 0===e?void 0:e.visibleProfiles)||void 0===n?void 0:n[0],selectMode:this.state.selectModeActive,drawMode:this.state.drawModeActive,onDrawingComplete:this.state.onDrawingComplete,isNewSegmentsForSelection:this.state.addToSelectionTool,noGraphicAfterFirstSelection:this.state.noGraphicAfterFirstSelection,chartRender:this.state.startChartRendering,chartColorRender:this.state.chartColorRender,noFeaturesFoundError:this.state.noFeaturesError,onNavBack:this.onBackClick,doneClick:this.onDoneButtonCLicked,activateDrawSelectToolForNewProfile:this.activateToolForNewProfile,selectableLayersRuntime:this.selectableLayersAvailableAtRuntime,intersectingLayersRuntime:this.intersectingLayersAvailableAtRuntime,chartPosition:this.highlightChartPosition,hideChartPosition:this.hideChartPosition,buildOutputStatistics:this.buildOutputStatistics,intersectingBufferRuntime:this.onBufferChange,drawingLayer:this.drawingLayer,intersectionHighlightLayer:this.intersectionHighlightLayer,jimuMapView:this.state.jimuMapView,viewModelErrorState:this.state.viewModelErrorState,profileErrorMsg:this.state.profileErrorMsg,chartDataUpdateTime:this.state.chartDataUpdateTime}))):(this.resetToDefault(),(0,t.jsx)(i.WidgetPlaceholder,{icon:fe.elevationIcon,widgetId:this.props.id,"data-testid":"widgetPlaceholder",message:this.props.intl.formatMessage({id:"_widgetLabel",defaultMessage:this.nls("_widgetLabel")})}))}}function Se(e){M.p=e}ye.mapExtraStateProps=(e,t)=>{var i,s;return{appMode:null===(i=e.appRuntimeInfo)||void 0===i?void 0:i.appMode,selectedFeatureRecords:null===(s=null==t?void 0:t.mutableStateProps)||void 0===s?void 0:s.selectedFeatureRecords}}})(),D})())}}}));